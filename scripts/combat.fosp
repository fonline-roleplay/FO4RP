                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        

bool LocIsModoc(uint locPid)
{
	return(locPid<=(6));
}

bool LocIsCity(uint locPid)
{
	return(locPid<=(25)||locPid==(40)||locPid==(42)||locPid==26||locPid==27||locPid==29||locPid>=96);
}

bool LocIsMasked(uint locPid)
{
	return(locPid==(41));
}

bool LocIsHidden(uint locPid)
{
	return false;
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 

const int[]CriticalTable=
{    
	
	4,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000800,2,0,0x00000001,5002,5003,5,0x00000800,2,-3,0x00000001,5002,5003,5,0x00000802,2,-3,0x00000001,5004,5003,6,0x00000801,6,0,0x00000040,5005,5006,6,0x00000080,-1,0,0x00000000,5007,5000,
	3,0x00000000,-1,0,0x00000000,5008,5000,3,0x00008000,-1,0,0x00000000,5009,5000,4,0x00000000,2,-3,0x00000010,5010,5011,4,0x00000810,-1,0,0x00000000,5012,5000,4,0x00000810,-1,0,0x00000000,5012,5000,4,0x00000810,-1,0,0x00000000,5013,5000,
	3,0x00000000,-1,0,0x00000000,5008,5000,3,0x00008000,-1,0,0x00000000,5009,5000,4,0x00000000,2,-3,0x00000020,5014,5000,4,0x00000820,-1,0,0x00000000,5015,5000,4,0x00000820,-1,0,0x00000000,5015,5000,4,0x00000820,-1,0,0x00000000,5013,5000,
	3,0x00000000,-1,0,0x00000000,5016,5000,3,0x00000800,-1,0,0x00000000,5017,5000,4,0x00000802,-1,0,0x00000000,5019,5000,4,0x00000802,-1,0,0x00000000,5019,5000,6,0x00000801,-1,0,0x00000000,5020,5000,6,0x00000080,-1,0,0x00000000,5021,5000,
	3,0x00000002,-1,0,0x00000000,5023,5000,3,0x00000002,2,0,0x00000008,5023,5024,4,0x00000002,2,-3,0x00000008,5023,5024,4,0x0000080A,-1,0,0x00000000,5025,5000,4,0x0000080A,2,0,0x00000001,5025,5026,4,0x00000809,-1,0,0x00000000,5026,5000,
	3,0x00000002,-1,0,0x00000000,5023,5000,3,0x00000002,2,0,0x00000004,5023,5024,4,0x00000002,2,-3,0x00000004,5023,5024,4,0x00000806,-1,0,0x00000000,5025,5000,4,0x00000806,2,0,0x00000001,5025,5026,4,0x00000805,-1,0,0x00000000,5026,5000,
	4,0x00000000,6,4,0x00000040,5027,5028,4,0x00000800,6,3,0x00000040,5029,5028,6,0x00000800,6,2,0x00000040,5029,5028,6,0x00008840,-1,0,0x00000000,5030,5000,8,0x00000841,-1,0,0x00000000,5031,5000,8,0x00000080,-1,0,0x00000000,5032,5000,
	3,0x00000000,-1,0,0x00000000,5033,5000,3,0x00000800,2,-3,0x00000002,5034,5035,3,0x00000002,2,-3,0x00000001,5035,5036,3,0x00000001,-1,0,0x00000000,5036,5000,4,0x00000802,2,0,0x00000001,5035,5036,4,0x00000801,-1,0,0x00000000,5037,5000,
	3,0x00000000,-1,0,0x00000000,5016,5000,3,0x00000800,-1,0,0x00000000,5017,5000,4,0x00000000,-1,0,0x00000000,5018,5000,4,0x00000802,-1,0,0x00000000,5019,5000,6,0x00000801,-1,0,0x00000000,5020,5000,6,0x00000080,-1,0,0x00000000,5021,5000,
	
	4,0x00000000,-1,0,0x00000000,5101,5100,4,0x00000800,2,0,0x00000001,5102,5103,6,0x00000800,2,-3,0x00000001,5102,5103,6,0x00000802,2,-3,0x00000001,5104,5103,6,0x00000801,6,0,0x00000040,5105,5106,6,0x00000080,-1,0,0x00000000,5107,5000,
	3,0x00000000,-1,0,0x00000000,5108,5100,3,0x00008000,-1,0,0x00000000,5109,5100,4,0x00000000,2,-2,0x00000010,5110,5111,4,0x00000000,2,-4,0x00000010,5110,5111,4,0x00000810,-1,0,0x00000000,5112,5100,4,0x00000810,-1,0,0x00000000,5113,5100,
	3,0x00000000,-1,0,0x00000000,5108,5100,3,0x00008000,-1,0,0x00000000,5109,5100,4,0x00000000,2,-2,0x00000020,5114,5100,4,0x00000000,2,-4,0x00000020,5114,5100,4,0x00000820,-1,0,0x00000000,5115,5100,4,0x00000820,-1,0,0x00000000,5113,5100,
	3,0x00000000,-1,0,0x00000000,5116,5100,3,0x00000800,-1,0,0x00000000,5117,5100,4,0x00000802,-1,0,0x00000000,5119,5100,4,0x00000802,-1,0,0x00000000,5119,5100,6,0x00000801,-1,0,0x00000000,5120,5100,6,0x00000080,-1,0,0x00000000,5121,5100,
	3,0x00000002,-1,0,0x00000000,5123,5100,4,0x00000002,2,0,0x00000008,5123,5124,4,0x00000002,2,-3,0x00000008,5123,5124,4,0x0000080A,-1,0,0x00000000,5125,5100,4,0x0000080A,2,0,0x00000001,5125,5126,4,0x00000809,-1,0,0x00000000,5126,5100,
	3,0x00000002,-1,0,0x00000000,5123,5100,4,0x00000002,2,0,0x00000004,5123,5124,4,0x00000002,2,-3,0x00000004,5123,5124,4,0x00000806,-1,0,0x00000000,5125,5100,4,0x00000806,2,0,0x00000001,5125,5126,4,0x00000805,-1,0,0x00000000,5126,5100,
	4,0x00000000,6,4,0x00000040,5127,5128,4,0x00000800,6,3,0x00000040,5129,5128,6,0x00000800,6,2,0x00000040,5129,5128,6,0x00008840,-1,0,0x00000000,5130,5100,8,0x00000841,-1,0,0x00000000,5131,5100,8,0x00000080,-1,0,0x00000000,5132,5100,
	3,0x00000000,-1,0,0x00000000,5133,5100,3,0x00000000,2,0,0x00000002,5133,5134,3,0x00000002,2,0,0x00000001,5134,5135,3,0x00000001,-1,0,0x00000000,5135,5100,4,0x00000802,2,0,0x00000001,5134,5135,4,0x00000801,-1,0,0x00000000,5135,5100,
	3,0x00000000,-1,0,0x00000000,5116,5100,3,0x00000800,-1,0,0x00000000,5117,5100,4,0x00000802,-1,0,0x00000000,5119,5100,4,0x00000802,-1,0,0x00000000,5119,5100,6,0x00000801,-1,0,0x00000000,5120,5100,6,0x00000080,-1,0,0x00000000,5121,5100,
	
	4,0x00000000,2,0,0x00000001,5200,5201,4,0x00000800,2,-2,0x00000001,5202,5203,4,0x00000800,2,-2,0x00000001,5202,5203,6,0x00000801,-1,0,0x00000000,5203,5000,6,0x00000801,-1,0,0x00000000,5203,5000,6,0x00000080,-1,0,0x00000000,5204,5000,
	3,0x00000000,-1,0,0x00000000,5205,5000,4,0x00008000,2,0,0x00000010,5206,5207,4,0x00008000,2,-2,0x00000010,5206,5207,4,0x00000810,-1,0,0x00000000,5208,5000,4,0x00000810,-1,0,0x00000000,5208,5000,4,0x00000810,-1,0,0x00000000,5208,5000,
	3,0x00000000,-1,0,0x00000000,5209,5000,4,0x00008000,2,0,0x00000020,5206,5207,4,0x00008000,2,-2,0x00000020,5206,5207,4,0x00000820,-1,0,0x00000000,5208,5000,4,0x00000820,-1,0,0x00000000,5208,5000,4,0x00000820,-1,0,0x00000000,5208,5000,
	3,0x00000000,-1,0,0x00000000,5210,5000,4,0x00000800,-1,0,0x00000000,5211,5000,4,0x00000802,-1,0,0x00000000,5212,5000,4,0x00000802,-1,0,0x00000000,5212,5000,4,0x00000801,-1,0,0x00000000,5213,5000,6,0x00000080,-1,0,0x00000000,5214,5000,
	3,0x00000000,-1,0,0x00000000,5215,5000,3,0x0000000A,-1,0,0x00000000,5216,5000,3,0x0000000A,-1,0,0x00000000,5216,5000,4,0x0000080A,-1,0,0x00000000,5217,5000,4,0x0000080A,-1,0,0x00000000,5217,5000,4,0x0000080A,-1,0,0x00000000,5217,5000,
	3,0x00000000,-1,0,0x00000000,5215,5000,3,0x00000006,-1,0,0x00000000,5216,5000,3,0x00000006,-1,0,0x00000000,5216,5000,4,0x00000806,-1,0,0x00000000,5217,5000,4,0x00000806,-1,0,0x00000000,5217,5000,4,0x00000806,-1,0,0x00000000,5217,5000,
	4,0x00000000,6,5,0x00000040,5218,5219,4,0x00000800,6,2,0x00000040,5220,5221,6,0x00000800,6,-1,0x00000040,5220,5221,6,0x00008840,-1,0,0x00000000,5222,5000,8,0x00000841,-1,0,0x00000000,5223,5000,8,0x00000080,-1,0,0x00000000,5224,5000,
	3,0x00000000,-1,0,0x00000000,5225,5000,3,0x00000000,-1,0,0x00000000,5225,5000,3,0x00000002,-1,0,0x00000000,5226,5000,3,0x00000002,-1,0,0x00000000,5226,5000,3,0x00000002,-1,0,0x00000000,5226,5000,4,0x00000002,-1,0,0x00000000,5226,5000,
	3,0x00000000,-1,0,0x00000000,5210,5000,3,0x00000800,-1,0,0x00000000,5211,5000,4,0x00000800,-1,0,0x00000000,5211,5000,4,0x00000802,-1,0,0x00000000,5212,5000,4,0x00000801,-1,0,0x00000000,5213,5000,6,0x00000080,-1,0,0x00000000,5214,5000,
	
	4,0x00000000,-1,0,0x00000000,5300,5000,4,0x00000800,2,-1,0x00000002,5301,5302,5,0x00000800,2,-4,0x00000002,5301,5302,5,0x00000802,2,-3,0x00000001,5302,5303,6,0x00000802,2,0,0x00000001,5302,5303,6,0x00000080,-1,0,0x00000000,5304,5000,
	3,0x00000000,-1,0,0x00000000,5300,5000,3,0x00000000,5,0,0x00008000,5300,5306,4,0x00008800,2,-1,0x00000010,5307,5308,4,0x00008800,2,-3,0x00000010,5307,5308,4,0x00000810,-1,0,0x00000000,5308,5000,4,0x00000810,-1,0,0x00000000,5308,5000,
	3,0x00000000,-1,0,0x00000000,5300,5000,3,0x00000000,5,0,0x00008000,5300,5306,4,0x00008800,2,-1,0x00000020,5307,5309,4,0x00008800,2,-3,0x00000020,5307,5309,4,0x00000820,-1,0,0x00000000,5309,5000,4,0x00000820,-1,0,0x00000000,5309,5000,
	3,0x00000000,-1,0,0x00000000,5300,5000,3,0x00000800,-1,0,0x00000000,5301,5000,4,0x00000802,-1,0,0x00000000,5302,5000,4,0x00000802,-1,0,0x00000000,5302,5000,4,0x00000801,-1,0,0x00000000,5310,5000,6,0x00000080,-1,0,0x00000000,5311,5000,
	3,0x00000000,-1,0,0x00000000,5300,5000,3,0x00000000,5,0,0x00000002,5300,5312,4,0x00000002,2,-3,0x00000008,5312,5313,4,0x0000000A,-1,0,0x00000000,5313,5000,4,0x0000080A,-1,0,0x00000000,5314,5000,4,0x00000809,-1,0,0x00000000,5315,5000,
	3,0x00000000,-1,0,0x00000000,5300,5000,3,0x00000000,5,0,0x00000002,5300,5312,4,0x00000002,2,-3,0x00000004,5312,5313,4,0x00000006,-1,0,0x00000000,5313,5000,4,0x00000806,-1,0,0x00000000,5314,5000,4,0x00000805,-1,0,0x00000000,5315,5000,
	4,0x00000000,-1,0,0x00000000,5300,5000,4,0x00000800,6,5,0x00000040,5316,5317,6,0x00000800,6,3,0x00000040,5316,5317,6,0x00008800,6,0,0x00000040,5318,5319,8,0x00000841,-1,0,0x00000000,5320,5000,8,0x00000080,-1,0,0x00000000,5321,5000,
	3,0x00000000,-1,0,0x00000000,5300,5000,3,0x00000000,6,0,0x00000800,5300,5017,3,0x00000800,2,-2,0x00000002,5301,5302,3,0x00000002,-1,0,0x00000000,5312,5000,4,0x00000802,2,0,0x00000001,5302,5303,4,0x00000801,-1,0,0x00000000,5303,5000,
	3,0x00000000,-1,0,0x00000000,5300,5000,3,0x00000800,-1,0,0x00000000,5301,5000,4,0x00000802,-1,0,0x00000000,5302,5000,4,0x00000802,-1,0,0x00000000,5302,5000,4,0x00000801,-1,0,0x00000000,5310,5000,6,0x00000080,-1,0,0x00000000,5311,5000,
	
	4,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000800,2,0,0x00000001,5400,5003,5,0x00000800,2,-1,0x00000001,5400,5003,5,0x00000802,2,-2,0x00000001,5004,5005,6,0x00000801,0,0,0x00000000,5005,5000,6,0x00000080,-1,0,0x00000000,5401,5000,
	3,0x00000000,-1,0,0x00000000,5016,5000,3,0x00000000,5,0,0x0000C000,5001,5402,4,0x0000C000,2,0,0x00000010,5402,5012,4,0x0000C800,2,0,0x00000010,5403,5404,4,0x00004810,-1,0,0x00000000,5404,5000,4,0x00004810,-1,0,0x00000000,5404,5000,
	3,0x00000000,-1,0,0x00000000,5016,5000,3,0x00000000,5,0,0x0000C000,5001,5402,4,0x0000C000,2,0,0x00000020,5402,5015,4,0x0000C800,2,0,0x00000020,5403,5404,4,0x00004820,-1,0,0x00000000,5404,5000,4,0x00004820,-1,0,0x00000000,5404,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000800,-1,0,0x00000000,5017,5000,3,0x00000000,-1,0,0x00000000,5018,5000,4,0x00000802,-1,0,0x00000000,5004,5000,4,0x00000801,-1,0,0x00000000,5003,5000,6,0x00000080,-1,0,0x00000000,5007,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,5,0,0x00000002,5001,5023,4,0x00000002,2,0,0x00000008,5023,5024,4,0x0000000A,-1,0,0x00000000,5024,5000,4,0x0000080A,2,0,0x00000001,5024,5026,4,0x00000809,-1,0,0x00000000,5026,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,5,0,0x00000002,5001,5023,4,0x00000002,2,0,0x00000004,5023,5024,4,0x00000006,-1,0,0x00000000,5024,5000,4,0x00000806,2,0,0x00000001,5024,5026,4,0x00000805,-1,0,0x00000000,5026,5000,
	4,0x00000000,6,3,0x00000040,5001,5405,4,0x00000800,6,0,0x00000040,5406,5407,6,0x00000800,6,-3,0x00000040,5406,5407,6,0x00008840,-1,0,0x00000000,5030,5000,8,0x00000841,-1,0,0x00000000,5031,5000,8,0x00000080,-1,0,0x00000000,5408,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,6,0,0x00000800,5001,5033,3,0x00000800,2,0,0x00000002,5033,5035,3,0x00000002,-1,0,0x00000000,5004,5000,4,0x00000802,2,0,0x00000001,5035,5036,4,0x00000801,-1,0,0x00000000,5036,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000800,-1,0,0x00000000,5017,5000,3,0x00000000,-1,0,0x00000000,5018,5000,4,0x00000802,-1,0,0x00000000,5004,5000,4,0x00000801,-1,0,0x00000000,5003,5000,6,0x00000080,-1,0,0x00000000,5007,5000,
	
	4,0x00000000,-1,0,0x00000000,5016,5000,4,0x00000000,-1,0,0x00000000,5016,5000,5,0x00000000,2,2,0x00000002,5016,5500,5,0x00000000,2,-1,0x00000002,5016,5500,6,0x00000001,0,0,0x00000000,5501,5000,6,0x00000080,-1,0,0x00000000,5502,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,2,0,0x00000004,5016,5503,4,0x00000000,2,0,0x00000004,5016,5503,4,0x00000004,-1,0,0x00000000,5503,5000,4,0x00000004,-1,0,0x00000000,5503,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,2,0,0x00000008,5016,5503,4,0x00000000,2,0,0x00000008,5016,5503,4,0x00000008,-1,0,0x00000000,5503,5000,4,0x00000008,-1,0,0x00000000,5503,5000,
	3,0x00000000,-1,0,0x00000000,5504,5000,3,0x00000000,-1,0,0x00000000,5504,5000,4,0x00000000,-1,0,0x00000000,5504,5000,4,0x00000800,-1,0,0x00000000,5505,5000,4,0x00000800,-1,0,0x00000000,5505,5000,6,0x00000080,-1,0,0x00000000,5506,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,2,0,0x00000008,5016,5503,4,0x00000000,2,0,0x00000008,5016,5503,4,0x00000008,-1,0,0x00000000,5503,5000,4,0x00000008,-1,0,0x00000000,5503,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,2,0,0x00000004,5016,5503,4,0x00000000,2,0,0x00000004,5016,5503,4,0x00000004,-1,0,0x00000000,5503,5000,4,0x00000004,-1,0,0x00000000,5503,5000,
	4,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000800,6,0,0x00000040,5029,5507,6,0x00000800,6,-3,0x00000040,5029,5507,6,0x00008840,-1,0,0x00000000,5508,5000,8,0x00000841,-1,0,0x00000000,5509,5000,8,0x00000080,-1,0,0x00000000,5510,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000800,-1,0,0x00000000,5511,5000,3,0x00000800,-1,0,0x00000000,5511,5000,4,0x00000800,-1,0,0x00000000,5512,5000,4,0x00000800,-1,0,0x00000000,5512,5000,6,0x00000800,-1,0,0x00000000,5513,5000,
	3,0x00000000,-1,0,0x00000000,5504,5000,3,0x00000000,-1,0,0x00000000,5504,5000,4,0x00000000,-1,0,0x00000000,5504,5000,4,0x00000800,-1,0,0x00000000,5505,5000,4,0x00000800,-1,0,0x00000000,5505,5000,6,0x00000080,-1,0,0x00000000,5506,5000,
	
	4,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,2,3,0x00000002,5001,5600,5,0x00000000,2,0,0x00000002,5001,5600,5,0x00000000,2,-3,0x00000002,5001,5600,6,0x00000002,-1,0,0x00000000,5600,5000,6,0x00000080,-1,0,0x00000000,5601,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,-1,0,0x00000000,5016,5000,4,0x00000000,2,0,0x00000010,5016,5602,4,0x00000010,-1,0,0x00000000,5602,5000,4,0x00000010,-1,0,0x00000000,5602,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,-1,0,0x00000000,5016,5000,4,0x00000000,2,2,0x00000020,5016,5603,4,0x00000000,2,0,0x00000020,5016,5603,4,0x00000020,-1,0,0x00000000,5603,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000800,-1,0,0x00000000,5604,5000,4,0x00000000,-1,0,0x00000000,5016,5000,4,0x00000800,-1,0,0x00000000,5605,5000,4,0x00000800,5,0,0x00000002,5605,5606,4,0x00000080,-1,0,0x00000000,5607,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,5,2,0x00000000,5001,5600,4,0x00000002,2,0,0x00000008,5600,5608,4,0x00000808,-1,0,0x00000000,5609,5000,4,0x0000080A,-1,0,0x00000000,5608,5000,4,0x0000080A,-1,0,0x00000000,5608,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,5,2,0x00000000,5001,5600,4,0x00000002,2,0,0x00000004,5600,5008,4,0x00000804,-1,0,0x00000000,5609,5000,4,0x00000806,-1,0,0x00000000,5608,5000,4,0x00000806,-1,0,0x00000000,5608,5000,
	4,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,5,3,0x00000040,5001,5610,6,0x00000000,5,0,0x00000040,5016,5610,6,0x00000000,5,-3,0x00000040,5016,5610,8,0x00000000,5,-3,0x00000040,5611,5612,8,0x00000080,-1,0,0x00000000,5613,5000,
	3,0x00000000,-1,0,0x00000000,5614,5000,3,0x00000000,-1,0,0x00000000,5614,5000,4,0x00000000,-1,0,0x00000000,5614,5000,4,0x00000001,-1,0,0x00000000,5615,5000,4,0x00000001,-1,0,0x00000000,5615,5000,4,0x00000080,-1,0,0x00000000,5616,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000800,-1,0,0x00000000,5604,5000,4,0x00000000,-1,0,0x00000000,5016,5000,4,0x00000800,-1,0,0x00000000,5605,5000,4,0x00000800,5,0,0x00000002,5605,5606,4,0x00000080,-1,0,0x00000000,5607,5000,
	
	4,0x00000800,-1,0,0x00000000,5700,5000,4,0x00000800,-1,0,0x00000000,5700,5000,4,0x00000080,-1,0,0x00000000,5701,5000,4,0x00000080,-1,0,0x00000000,5701,5000,6,0x00000080,-1,0,0x00000000,5701,5000,6,0x00000080,-1,0,0x00000000,5701,5000,
	3,0x00000010,-1,0,0x00000000,5703,5000,3,0x00000010,-1,0,0x00000000,5703,5000,3,0x00000010,-1,0,0x00000000,5703,5000,4,0x00000010,-1,0,0x00000000,5703,5000,4,0x00000010,-1,0,0x00000000,5703,5000,4,0x00000010,-1,0,0x00000000,5703,5000,
	3,0x00000020,-1,0,0x00000000,5705,5000,3,0x00000020,-1,0,0x00000000,5705,5000,3,0x00000020,-1,0,0x00000000,5705,5000,4,0x00000020,-1,0,0x00000000,5705,5000,4,0x00000020,-1,0,0x00000000,5705,5000,4,0x00000020,-1,0,0x00000000,5705,5000,
	3,0x00000000,-1,0,0x00000000,5706,5000,3,0x00000002,-1,0,0x00000000,5707,5000,3,0x00000002,-1,0,0x00000000,5707,5000,4,0x00000002,-1,0,0x00000000,5707,5000,4,0x00000002,-1,0,0x00000000,5707,5000,4,0x00000080,-1,0,0x00000000,5708,5000,
	3,0x00000008,-1,0,0x00000000,5709,5000,3,0x00000008,-1,0,0x00000000,5709,5000,3,0x00000008,-1,0,0x00000000,5709,5000,4,0x00000008,-1,0,0x00000000,5709,5000,4,0x00000008,-1,0,0x00000000,5709,5000,4,0x00000008,-1,0,0x00000000,5709,5000,
	3,0x00000004,-1,0,0x00000000,5710,5000,3,0x00000004,-1,0,0x00000000,5710,5000,3,0x00000004,-1,0,0x00000000,5710,5000,4,0x00000004,-1,0,0x00000000,5710,5000,4,0x00000004,-1,0,0x00000000,5710,5000,4,0x00000004,-1,0,0x00000000,5710,5000,
	4,0x00000800,-1,0,0x00000000,5711,5000,4,0x00000080,-1,0,0x00000000,5712,5000,4,0x00000080,-1,0,0x00000000,5712,5000,6,0x00000080,-1,0,0x00000000,5712,5000,6,0x00000080,-1,0,0x00000000,5712,5000,6,0x00000080,-1,0,0x00000000,5712,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000800,-1,0,0x00000000,5711,5000,4,0x00000800,-1,0,0x00000000,5711,5000,6,0x00000080,-1,0,0x00000000,5712,5000,6,0x00000080,-1,0,0x00000000,5712,5000,
	3,0x00000000,-1,0,0x00000000,5706,5000,3,0x00000002,-1,0,0x00000000,5707,5000,3,0x00000002,-1,0,0x00000000,5707,5000,4,0x00000002,-1,0,0x00000000,5707,5000,4,0x00000002,-1,0,0x00000000,5707,5000,4,0x00000080,-1,0,0x00000000,5708,5000,
	
	4,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,5,0,0x00000002,5001,5800,5,0x00000000,5,-3,0x00000002,5016,5800,5,0x00000002,2,0,0x00000001,5800,5801,6,0x00000002,2,-3,0x00000001,5800,5801,6,0x00000080,-1,0,0x00000000,5802,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,2,0,0x00008000,5001,5803,4,0x00000000,2,-2,0x00008000,5001,5803,3,0x00008800,-1,0,0x00000000,5804,5000,4,0x00008800,-1,0,0x00000000,5804,5000,4,0x00000080,-1,0,0x00000000,5805,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,2,0,0x00008000,5001,5803,4,0x00000000,2,-2,0x00008000,5001,5803,3,0x00008800,-1,0,0x00000000,5804,5000,4,0x00008800,-1,0,0x00000000,5804,5000,4,0x00000080,-1,0,0x00000000,5805,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,5,0,0x00000002,5001,5800,3,0x00000000,5,-2,0x00000002,5001,5800,4,0x00000002,-1,0,0x00000000,5800,5000,4,0x00000802,-1,0,0x00000000,5804,5000,4,0x00000080,-1,0,0x00000000,5805,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,5,1,0x00000002,5001,5800,4,0x00000000,5,-1,0x00000002,5001,5800,4,0x00000002,2,-1,0x0000000C,5800,5806,4,0x00000802,2,-3,0x0000000C,5804,5806,6,0x00000480,-1,0,0x00000000,5807,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,-1,0,0x00000000,5001,5000,4,0x00008000,-1,0,0x00000000,5803,5000,4,0x00008000,-1,0,0x00000000,5803,5000,4,0x00008030,-1,0,0x00000000,5808,5000,4,0x00008030,-1,0,0x00000000,5808,5000,
	4,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000800,-1,0,0x00000000,5809,5000,5,0x00000000,2,0,0x00000040,5016,5810,5,0x00000800,2,-3,0x00000040,5809,5810,6,0x00000840,-1,0,0x00000000,5810,5000,6,0x00000842,-1,0,0x00000000,5801,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,2,0,0x00000002,5001,5800,3,0x00000000,2,-3,0x00000002,5001,5800,3,0x00000802,-1,0,0x00000000,5800,5000,3,0x00000802,-1,0,0x00000000,5800,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,5,0,0x00000002,5001,5800,3,0x00000000,5,-2,0x00000002,5001,5800,4,0x00000002,-1,0,0x00000000,5800,5000,4,0x00000802,-1,0,0x00000000,5804,5000,4,0x00000080,-1,0,0x00000000,5805,5000,
	
	4,0x00000000,-1,0,0x00000000,5016,5000,4,0x00000000,2,0,0x00008002,5016,5900,5,0x00000000,2,-3,0x00008002,5016,5900,5,0x00000800,2,-3,0x00008002,5901,5900,6,0x00000800,2,-3,0x00008002,5901,5900,6,0x00000080,-1,0,0x00000000,5902,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,2,0,0x00008000,5016,5903,4,0x00000000,2,0,0x00000010,5016,5904,4,0x00000010,-1,0,0x00000000,5904,5000,4,0x00000810,-1,0,0x00000000,5905,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,2,0,0x00008000,5016,5903,4,0x00000000,2,0,0x00000020,5016,5904,4,0x00000020,-1,0,0x00000000,5904,5000,4,0x00000820,-1,0,0x00000000,5905,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000800,-1,0,0x00000000,5901,5000,4,0x00000800,2,2,0x00000000,5901,5900,5,0x00000802,-1,0,0x00000000,5900,5000,5,0x00000080,-1,0,0x00000000,5902,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000002,-1,0,0x00000000,5900,5000,4,0x00000002,2,0,0x00000008,5900,5906,4,0x0000000A,-1,0,0x00000000,5906,5000,4,0x0000000A,-1,0,0x00000000,5906,5000,4,0x0000800A,-1,0,0x00000000,5907,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000002,-1,0,0x00000000,5900,5000,4,0x00000002,2,0,0x00000004,5900,5906,4,0x00000006,-1,0,0x00000000,5906,5000,4,0x00000006,-1,0,0x00000000,5906,5000,4,0x00008006,-1,0,0x00000000,5907,5000,
	4,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,2,1,0x00000040,5001,5908,6,0x00000800,2,-1,0x00000040,5901,5908,6,0x00008840,-1,0,0x00000000,5909,5000,8,0x00000841,-1,0,0x00000000,5910,5000,8,0x00000080,-1,0,0x00000000,5911,5000,
	2,0x00000000,-1,0,0x00000000,5912,5000,2,0x00000000,-1,0,0x00000000,5912,5000,2,0x00000000,-1,0,0x00000000,5912,5000,2,0x00000000,-1,0,0x00000000,5912,5000,2,0x00000000,-1,0,0x00000000,5912,5000,2,0x00000000,-1,0,0x00000000,5912,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000800,-1,0,0x00000000,5901,5000,4,0x00000800,2,2,0x00000000,5901,5900,5,0x00000802,-1,0,0x00000000,5900,5000,5,0x00000080,-1,0,0x00000000,5902,5000,
	
	4,0x00000000,-1,0,0x00000000,6000,5000,4,0x00000000,-1,0,0x00000000,6000,5000,5,0x00000000,-1,0,0x00000000,6000,5000,5,0x00000002,-1,0,0x00000000,6001,5000,6,0x00000802,-1,0,0x00000000,6002,5000,6,0x00000080,-1,0,0x00000000,6003,5000,
	3,0x00000000,-1,0,0x00000000,6000,5000,3,0x00000000,-1,0,0x00000000,6000,5000,3,0x00000000,2,0,0x00000010,6000,6004,3,0x00000000,2,-3,0x00000010,6000,6004,4,0x00000010,-1,0,0x00000000,6004,5000,4,0x00000010,2,0,0x00000020,6004,6005,
	3,0x00000000,-1,0,0x00000000,6000,5000,3,0x00000000,-1,0,0x00000000,6000,5000,3,0x00000000,2,0,0x00000020,6000,6004,3,0x00000000,2,-3,0x00000020,6000,6004,4,0x00000020,-1,0,0x00000000,6004,5000,4,0x00000020,2,0,0x00000010,6004,6005,
	3,0x00000000,-1,0,0x00000000,6000,5000,3,0x00000800,-1,0,0x00000000,6006,5000,4,0x00000000,-1,0,0x00000000,6007,5000,4,0x00000800,-1,0,0x00000000,6008,5000,6,0x00000800,-1,0,0x00000000,6009,5000,6,0x00000080,-1,0,0x00000000,6010,5000,
	3,0x00000000,-1,0,0x00000000,6000,5000,4,0x00000000,-1,0,0x00000000,6007,5000,3,0x00000000,2,0,0x00000008,6000,6004,4,0x00000000,2,-4,0x00000008,6007,6004,4,0x00000008,2,0,0x00000002,6004,6011,4,0x00000008,2,-3,0x00000006,6004,6012,
	3,0x00000000,-1,0,0x00000000,6000,5000,4,0x00000000,-1,0,0x00000000,6007,5000,3,0x00000000,2,0,0x00000004,6000,6004,4,0x00000000,2,-4,0x00000004,6007,6004,4,0x00000004,2,0,0x00000002,6004,6011,4,0x00000004,2,-3,0x0000000A,6004,6012,
	3,0x00000000,-1,0,0x00000000,6000,5000,3,0x00000000,2,0,0x00000040,6000,6013,3,0x00000000,2,-2,0x00000040,6000,6013,3,0x00000000,2,-4,0x00000040,6000,6013,3,0x00000000,2,-6,0x00000040,6000,6013,3,0x00000040,-1,0,0x00000000,6013,5000,
	3,0x00000000,-1,0,0x00000000,6000,5000,3,0x00000000,-1,0,0x00000000,6000,5000,3,0x00000000,2,-1,0x00008002,6000,6002,3,0x00000000,2,-4,0x00008002,6000,6002,3,0x00008002,2,0,0x00200000,6002,6003,3,0x00008002,2,-4,0x00200000,6002,6003,
	3,0x00000000,-1,0,0x00000000,6000,5000,3,0x00000800,-1,0,0x00000000,6006,5000,4,0x00000000,-1,0,0x00000000,6007,5000,4,0x00000800,-1,0,0x00000000,6008,5000,6,0x00000800,-1,0,0x00000000,6009,5000,6,0x00000080,-1,0,0x00000000,6010,5000,
	
	4,0x00000000,-1,0,0x00000000,5016,5000,4,0x00000000,2,0,0x00000002,5016,6100,4,0x00000000,2,-3,0x00000002,5016,6100,4,0x00000000,2,-6,0x00000030,5016,6101,4,0x00000002,2,-3,0x00000001,6100,6102,4,0x00000080,-1,0,0x00000000,6103,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,2,-1,0x00000004,5001,6104,3,0x00000000,2,-3,0x00000004,5001,6104,3,0x00000000,2,-5,0x00000006,5001,6105,3,0x00000004,5,-1,0x00000002,6104,6105,3,0x00000006,-1,0,0x00000000,6105,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,2,-1,0x00000008,5001,6104,3,0x00000000,2,-3,0x00000008,5001,6104,3,0x00000000,2,-5,0x0000000A,5001,6105,3,0x00000008,5,-1,0x00000002,6104,6105,3,0x0000000A,-1,0,0x00000000,6105,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,5,-1,0x00000002,5001,6100,4,0x00000000,-1,0,0x00000000,5016,5000,4,0x00000000,5,-3,0x00000002,5016,6100,4,0x00000002,-1,0,0x00000000,6100,5000,6,0x00000080,-1,0,0x00000000,6103,5000,
	3,0x00000000,2,1,0x00000008,5001,6104,3,0x00000000,2,0,0x00000008,5001,6104,3,0x00000000,2,-2,0x00000008,5001,6104,3,0x00000000,2,-4,0x0000000A,5001,6105,3,0x00000008,5,-1,0x00000002,6104,6105,3,0x0000000A,-1,0,0x00000000,6105,5000,
	3,0x00000000,2,1,0x00000004,5001,6104,3,0x00000000,2,0,0x00000004,5001,6104,3,0x00000000,2,-2,0x00000004,5001,6104,3,0x00000000,2,-4,0x00000006,5001,6105,3,0x00000004,5,-1,0x00000002,6104,6105,3,0x00000006,-1,0,0x00000000,6105,5000,
	4,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000800,-1,0,0x00000000,5018,5000,6,0x00000800,-1,0,0x00000000,5018,5000,6,0x00000800,2,3,0x00000040,5018,6106,8,0x00000800,2,0,0x00000040,5018,6106,8,0x00000080,-1,0,0x00000000,6107,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,5,-2,0x00000002,5001,6100,4,0x00000000,-1,0,0x00000000,5016,5000,4,0x00000000,5,-5,0x00000002,5016,6100,4,0x00000002,-1,0,0x00000000,6100,5000,6,0x00000080,-1,0,0x00000000,6103,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,5,-1,0x00000002,5001,6100,4,0x00000000,-1,0,0x00000000,5016,5000,4,0x00000000,5,-3,0x00000002,5016,6100,4,0x00000002,-1,0,0x00000000,6100,5000,6,0x00000080,-1,0,0x00000000,6103,5000,
	
	4,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,2,0,0x00000002,5001,6200,5,0x00000000,2,-3,0x00000002,5016,6200,5,0x00000002,2,-1,0x00000001,6200,6201,6,0x00000002,2,-3,0x00000001,6200,6201,6,0x00000080,-1,0,0x00000000,6202,5000,
	3,0x00000000,2,0,0x00000010,5001,6203,3,0x00000000,2,0,0x00000010,5001,6203,3,0x00000000,2,-2,0x00000010,5001,6203,4,0x00000000,2,-4,0x00000010,5016,6203,4,0x00000000,2,-4,0x00000010,5016,6203,4,0x00008010,-1,0,0x00000000,6204,5000,
	3,0x00000000,2,0,0x00000020,5001,6203,3,0x00000000,2,0,0x00000020,5001,6203,3,0x00000000,2,-2,0x00000020,5001,6203,4,0x00000000,2,-4,0x00000020,5016,6203,4,0x00000000,2,-4,0x00000020,5016,6203,4,0x00008020,-1,0,0x00000000,6204,5000,
	3,0x00000000,-1,0,0x00000000,1000,5000,3,0x00000000,2,0,0x00000800,5001,6205,3,0x00000000,2,-2,0x00000800,5001,6205,4,0x00000000,2,-2,0x00000800,5016,6205,4,0x00000000,2,-4,0x00000800,5016,6205,6,0x00000080,-1,0,0x00000000,6206,5000,
	3,0x00000000,5,0,0x00000002,5001,6201,3,0x00000000,5,-2,0x00000002,5001,6201,4,0x00000000,5,-4,0x00000002,5001,6201,3,0x00000002,2,0,0x00000008,6201,6203,4,0x00000002,2,-3,0x00000008,6201,6203,4,0x0000000A,-1,0,0x00000000,6207,5000,
	3,0x00000000,5,0,0x00000002,5001,6201,3,0x00000000,5,-3,0x00000002,5001,6201,3,0x00000002,2,-2,0x00000004,6201,6208,3,0x00000002,2,-2,0x00000004,6201,6208,3,0x00000002,2,-5,0x00000004,6201,6208,3,0x00000006,-1,0,0x00000000,6208,5000,
	4,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000800,2,0,0x00008000,6205,6209,6,0x00000800,2,-3,0x00008000,6205,6209,6,0x00008800,2,-3,0x00000040,6209,6210,8,0x00008802,2,-3,0x00000040,6209,6210,8,0x00000080,-1,0,0x00000000,6202,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000800,-1,0,0x00000000,6205,5000,4,0x00000000,-1,0,0x00000000,5016,5000,4,0x00000000,-1,0,0x00000000,5016,5000,4,0x00000802,-1,0,0x00000000,6209,5000,
	3,0x00000000,-1,0,0x00000000,1000,5000,3,0x00000000,2,0,0x00000800,5001,6205,3,0x00000000,2,-2,0x00000800,5001,6205,4,0x00000000,2,-2,0x00000800,5016,6205,4,0x00000000,2,-4,0x00000800,5016,6205,6,0x00000080,-1,0,0x00000000,6206,5000,
	
	4,0x00000000,-1,0,0x00000000,5016,5000,4,0x00000000,2,0,0x00000002,5016,5023,5,0x00000000,2,-3,0x00000002,5016,5023,5,0x00000000,2,-5,0x00000002,5016,5023,6,0x00000000,2,-4,0x00008002,5016,5004,6,0x00000000,2,-5,0x00008002,5016,5004,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,2,0,0x00000010,5001,5011,3,0x00000000,2,-2,0x00000010,5001,5011,3,0x00000000,2,-4,0x00000010,5001,5011,3,0x00000000,2,-6,0x00000010,5001,5011,3,0x00000000,2,-8,0x00000010,5001,5011,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,2,0,0x00000020,5001,5014,3,0x00000000,2,-2,0x00000020,5001,5014,3,0x00000000,2,-4,0x00000020,5001,5014,3,0x00000000,2,-6,0x00000020,5001,5014,3,0x00000000,2,-8,0x00000020,5001,5014,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,2,-1,0x00000800,5001,6300,4,0x00000000,-1,0,0x00000000,5016,5000,4,0x00000000,2,-1,0x00000800,5016,6300,5,0x00000802,-1,0,0x00000000,5004,5000,5,0x00008802,-1,0,0x00000000,5005,5000,
	3,0x00000000,5,0,0x00000002,5001,5004,3,0x00000000,2,0,0x00000008,5001,5004,3,0x00000002,2,-2,0x00000008,5001,5004,4,0x00000002,2,-4,0x00000008,5016,5022,4,0x00000002,2,-5,0x00000008,5023,5024,4,0x00000002,2,-6,0x00000008,5023,5024,
	3,0x00000000,5,0,0x00000002,5001,5004,3,0x00000000,2,0,0x00000008,5001,5004,3,0x00000002,2,-2,0x00000008,5001,5004,4,0x00000002,2,-4,0x00000008,5016,5022,4,0x00000002,2,-5,0x00000008,5023,5024,4,0x00000002,2,-6,0x00000008,5023,5024,
	4,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,2,-3,0x00008000,5001,6301,6,0x00000800,2,-6,0x00008000,6300,6301,6,0x00000800,2,-2,0x00000040,6301,6302,8,0x00000840,-1,0,0x00000000,6302,5000,8,0x00000840,-1,0,0x00000000,6302,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,-1,0,0x00000000,5016,5000,5,0x00000000,5,0,0x00000002,5016,5004,5,0x00000000,5,-3,0x00000002,5016,5004,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,2,-1,0x00000800,5001,6300,4,0x00000000,-1,0,0x00000000,5016,5000,4,0x00000000,2,-1,0x00000800,5016,6300,5,0x00000802,-1,0,0x00000000,5004,5000,5,0x00008802,-1,0,0x00000000,5005,5000,
	
	4,0x00000000,-1,0,0x00000000,6405,5000,4,0x00000800,-1,0,0x00000000,6400,5000,5,0x00000000,-1,0,0x00000000,6401,5000,5,0x00000800,-1,0,0x00000000,6402,5000,6,0x00000800,2,-3,0x00008000,6402,6403,6,0x00000800,2,-6,0x00008000,6402,6403,
	3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,
	3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,
	3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000800,-1,0,0x00000000,6400,5000,4,0x00000000,-1,0,0x00000000,6401,5000,4,0x00000000,-1,0,0x00000000,6401,5000,4,0x00000800,-1,0,0x00000000,6402,5000,
	3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,
	3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,
	4,0x00000000,-1,0,0x00000000,6405,5000,4,0x00000800,-1,0,0x00000000,6400,5000,5,0x00000000,-1,0,0x00000000,6401,5000,5,0x00000800,-1,0,0x00000000,6402,5000,6,0x00000800,2,-4,0x00000040,6402,6406,6,0x00000840,-1,0,0x00000000,6406,6404,
	3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,4,0x00000800,-1,0,0x00000000,6402,5000,4,0x00000800,-1,0,0x00000000,6402,5000,5,0x00000800,2,-3,0x00008000,6402,6403,5,0x00000800,2,-6,0x00008000,6402,6403,
	3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000000,-1,0,0x00000000,6405,5000,3,0x00000800,-1,0,0x00000000,6400,5000,4,0x00000000,-1,0,0x00000000,6401,5000,4,0x00000000,-1,0,0x00000000,6401,5000,4,0x00000800,-1,0,0x00000000,6402,5000,
	
	4,0x00000000,-1,0,0x00000000,6701,5000,4,0x00000800,2,0,0x00000001,6700,5003,5,0x00000800,2,-3,0x00000001,6700,5003,5,0x00000802,2,-3,0x00000001,6700,5003,6,0x00000801,6,0,0x00000040,6700,5006,6,0x00000080,-1,0,0x00000000,6700,5000,
	3,0x00000000,-1,0,0x00000000,6702,5000,3,0x00008000,-1,0,0x00000000,6702,5000,4,0x00000000,2,-3,0x00000010,6702,5011,4,0x00000810,-1,0,0x00000000,6702,5000,4,0x00000810,-1,0,0x00000000,6702,5000,4,0x00000810,-1,0,0x00000000,6702,5000,
	3,0x00000000,-1,0,0x00000000,6702,5000,3,0x00008000,-1,0,0x00000000,6702,5000,4,0x00000000,2,-3,0x00000020,6702,5000,4,0x00000820,-1,0,0x00000000,6702,5000,4,0x00000820,-1,0,0x00000000,6702,5000,4,0x00000820,-1,0,0x00000000,6702,5000,
	3,0x00000000,-1,0,0x00000000,6701,5000,3,0x00000800,-1,0,0x00000000,6701,5000,4,0x00000802,-1,0,0x00000000,6704,5000,4,0x00000802,-1,0,0x00000000,6704,5000,6,0x00000801,-1,0,0x00000000,6704,5000,6,0x00000080,-1,0,0x00000000,6704,5000,
	3,0x00000002,-1,0,0x00000000,6705,5000,3,0x00000002,2,0,0x00000008,6705,5024,4,0x00000002,2,-3,0x00000008,6705,5024,4,0x0000080A,-1,0,0x00000000,6705,5000,4,0x0000080A,2,0,0x00000001,6705,5026,4,0x00000809,-1,0,0x00000000,6705,5000,
	3,0x00000002,-1,0,0x00000000,6705,5000,3,0x00000002,2,0,0x00000004,6705,5024,4,0x00000002,2,-3,0x00000004,6705,5024,4,0x00000806,-1,0,0x00000000,6705,5000,4,0x00000806,2,0,0x00000001,6705,5026,4,0x00000805,-1,0,0x00000000,6705,5000,
	4,0x00000000,6,4,0x00000040,6700,5028,4,0x00000800,6,3,0x00000040,6700,5028,6,0x00000800,6,2,0x00000040,6700,5028,6,0x00008840,-1,0,0x00000000,6700,5000,8,0x00000841,-1,0,0x00000000,6700,5000,8,0x00000080,-1,0,0x00000000,6700,5000,
	3,0x00000000,-1,0,0x00000000,6703,5000,3,0x00000800,2,-3,0x00000002,6703,5035,3,0x00000002,2,-3,0x00000001,6703,5036,3,0x00000001,-1,0,0x00000000,6703,5000,4,0x00000802,2,0,0x00000001,6703,5036,4,0x00000801,-1,0,0x00000000,6703,5000,
	3,0x00000000,-1,0,0x00000000,6700,5000,3,0x00000800,-1,0,0x00000000,6700,5000,4,0x00000000,-1,0,0x00000000,6700,5000,4,0x00000802,-1,0,0x00000000,6700,5000,6,0x00000801,-1,0,0x00000000,6700,5000,6,0x00000080,-1,0,0x00000000,6700,5000,
	
	4,0x00000000,-1,0,0x00000000,6801,5000,4,0x00000800,2,0,0x00000001,6800,5003,5,0x00000800,2,-3,0x00000001,6800,5003,5,0x00000802,2,-3,0x00000001,6803,5003,6,0x00000801,6,0,0x00000040,6804,5006,6,0x00000080,-1,0,0x00000000,6804,5000,
	3,0x00000000,-1,0,0x00000000,6806,5000,3,0x00008000,-1,0,0x00000000,6806,5000,4,0x00000000,2,-3,0x00000010,6806,5011,4,0x00000810,-1,0,0x00000000,6806,5000,4,0x00000810,-1,0,0x00000000,6806,5000,4,0x00000810,-1,0,0x00000000,6806,5000,
	3,0x00000000,-1,0,0x00000000,6806,5000,3,0x00008000,-1,0,0x00000000,6806,5000,4,0x00000000,2,-3,0x00000020,6806,5000,4,0x00000820,-1,0,0x00000000,6806,5000,4,0x00000820,-1,0,0x00000000,6806,5000,4,0x00000820,-1,0,0x00000000,6806,5000,
	3,0x00000000,-1,0,0x00000000,6800,5000,3,0x00000800,-1,0,0x00000000,6800,5000,4,0x00000802,-1,0,0x00000000,6800,5000,4,0x00000802,-1,0,0x00000000,6800,5000,6,0x00000801,-1,0,0x00000000,6800,5000,6,0x00000080,-1,0,0x00000000,6800,5000,
	3,0x00000002,-1,0,0x00000000,6805,5000,3,0x00000002,2,0,0x00000008,6805,5024,4,0x00000002,2,-3,0x00000008,6805,5024,4,0x0000080A,-1,0,0x00000000,6805,5000,4,0x0000080A,2,0,0x00000001,6805,5026,4,0x00000809,-1,0,0x00000000,6805,5000,
	3,0x00000002,-1,0,0x00000000,6805,5000,3,0x00000002,2,0,0x00000004,6805,5024,4,0x00000002,2,-3,0x00000004,6805,5024,4,0x00000806,-1,0,0x00000000,6805,5000,4,0x00000806,2,0,0x00000001,6805,5026,4,0x00000805,-1,0,0x00000000,6805,5000,
	4,0x00000000,6,4,0x00000040,6803,5028,4,0x00000800,6,3,0x00000040,6803,5028,6,0x00000800,6,2,0x00000040,6803,5028,6,0x00008840,-1,0,0x00000000,6803,5000,8,0x00000841,-1,0,0x00000000,6803,5000,8,0x00000080,-1,0,0x00000000,6804,5000,
	3,0x00000000,-1,0,0x00000000,6801,5000,3,0x00000800,2,-3,0x00000002,6801,5035,3,0x00000002,2,-3,0x00000001,6801,5036,3,0x00000001,-1,0,0x00000000,6801,5000,4,0x00000802,2,0,0x00000001,6804,5036,4,0x00000801,-1,0,0x00000000,6804,5000,
	3,0x00000000,-1,0,0x00000000,6800,5000,3,0x00000800,-1,0,0x00000000,6800,5000,4,0x00000000,-1,0,0x00000000,6800,5000,4,0x00000802,-1,0,0x00000000,6800,5000,6,0x00000801,-1,0,0x00000000,6800,5000,6,0x00000080,-1,0,0x00000000,6800,5000,
	
	4,0x00000000,-1,0,0x00000000,6901,5000,4,0x00000800,2,0,0x00000001,6901,5003,5,0x00000800,2,-3,0x00000001,6902,5003,5,0x00000802,2,-3,0x00000001,6902,5003,6,0x00000801,6,0,0x00000040,6902,5006,6,0x00000080,-1,0,0x00000000,6902,5000,
	3,0x00000000,-1,0,0x00000000,6906,5000,3,0x00008000,-1,0,0x00000000,6906,5000,4,0x00000000,2,-3,0x00000010,6906,5011,4,0x00000810,-1,0,0x00000000,6906,5000,4,0x00000810,-1,0,0x00000000,6906,5000,4,0x00000810,-1,0,0x00000000,6906,5000,
	3,0x00000000,-1,0,0x00000000,6906,5000,3,0x00008000,-1,0,0x00000000,6906,5000,4,0x00000000,2,-3,0x00000020,6906,5000,4,0x00000820,-1,0,0x00000000,6906,5000,4,0x00000820,-1,0,0x00000000,6906,5000,4,0x00000820,-1,0,0x00000000,6906,5000,
	3,0x00000000,-1,0,0x00000000,6900,5000,3,0x00000800,-1,0,0x00000000,6900,5000,4,0x00000802,-1,0,0x00000000,6904,5000,4,0x00000802,-1,0,0x00000000,6904,5000,6,0x00000801,-1,0,0x00000000,6904,5000,6,0x00000080,-1,0,0x00000000,6904,5000,
	3,0x00000002,-1,0,0x00000000,6905,5000,3,0x00000002,2,0,0x00000008,6905,5024,4,0x00000002,2,-3,0x00000008,6905,5024,4,0x0000080A,-1,0,0x00000000,6905,5000,4,0x0000080A,2,0,0x00000001,6905,5026,4,0x00000809,-1,0,0x00000000,6905,5000,
	3,0x00000002,-1,0,0x00000000,6905,5000,3,0x00000002,2,0,0x00000004,6905,5024,4,0x00000002,2,-3,0x00000004,6905,5024,4,0x00000806,-1,0,0x00000000,6905,5000,4,0x00000806,2,0,0x00000001,6905,5026,4,0x00000805,-1,0,0x00000000,6905,5000,
	4,0x00000000,6,4,0x00000040,6900,5028,4,0x00000800,6,3,0x00000040,6906,5028,6,0x00000800,6,2,0x00000040,6901,5028,6,0x00008840,-1,0,0x00000000,6901,5000,8,0x00000841,-1,0,0x00000000,6901,5000,8,0x00000080,-1,0,0x00000000,6901,5000,
	3,0x00000000,-1,0,0x00000000,6900,5000,3,0x00000800,2,-3,0x00000002,6900,5035,3,0x00000002,2,-3,0x00000001,6900,5036,3,0x00000001,-1,0,0x00000000,6903,5000,4,0x00000802,2,0,0x00000001,6903,5036,4,0x00000801,-1,0,0x00000000,6903,5000,
	3,0x00000000,-1,0,0x00000000,6900,5000,3,0x00000800,-1,0,0x00000000,6900,5000,4,0x00000000,-1,0,0x00000000,6904,5000,4,0x00000802,-1,0,0x00000000,6904,5000,6,0x00000801,-1,0,0x00000000,6904,5000,6,0x00000080,-1,0,0x00000000,6904,5000,
	
	3,0x00000000,-1,0,0x00000000,7101,7100,3,0x00000000,-1,0,0x00000000,7102,7103,4,0x00000000,-1,0,0x00000000,7102,7103,4,0x00008000,-1,0,0x00000000,7104,7103,5,0x00000002,6,0,0x00000040,7105,7106,6,0x00000002,-1,0,0x00000000,7105,7100,
	3,0x00000000,-1,0,0x00000000,7106,7100,3,0x00000000,-1,0,0x00000000,7106,7100,3,0x00008000,-1,0,0x00000000,7106,7011,4,0x00008000,-1,0,0x00000000,7106,7100,4,0x00000010,-1,0,0x00000000,7106,7100,4,0x00000010,-1,0,0x00000000,7106,7100,
	3,0x00000000,-1,0,0x00000000,7106,7100,3,0x00000000,-1,0,0x00000000,7106,7100,3,0x00008000,-1,0,0x00000000,7106,7100,4,0x00008000,-1,0,0x00000000,7106,7100,4,0x00000020,-1,0,0x00000000,7106,7100,4,0x00000020,-1,0,0x00000000,7106,7100,
	3,0x00000000,-1,0,0x00000000,7106,7100,3,0x00000000,-1,0,0x00000000,7106,7100,3,0x00000000,-1,0,0x00000000,7106,7100,4,0x00000000,-1,0,0x00000000,7106,7100,4,0x00000002,-1,0,0x00000000,7106,7100,5,0x00000002,-1,0,0x00000000,7106,7100,
	3,0x00000002,-1,0,0x00000000,7106,7100,3,0x00000002,2,0,0x00000008,7106,7106,3,0x00000002,2,-3,0x00000008,7060,7106,4,0x0000000A,-1,0,0x00000000,7106,7100,4,0x0000000A,-1,0,0x00000000,7106,7106,4,0x00000008,-1,0,0x00000000,7106,7100,
	3,0x00000002,-1,0,0x00000000,7106,7100,3,0x00000002,2,0,0x00000004,7106,7024,3,0x00000002,2,-3,0x00000004,7106,7024,4,0x00000006,-1,0,0x00000000,7106,7100,4,0x00000006,-1,0,0x00000000,7106,7106,4,0x00000004,-1,0,0x00000000,7106,7100,
	3,0x00000000,-1,0,0x00000000,7106,7106,3,0x00000000,-1,0,0x00000000,7106,7106,4,0x00000000,6,2,0x00000040,7106,7106,4,0x00008000,-1,0,0x00000000,7106,7100,5,0x00008040,-1,0,0x00000000,7106,7100,5,0x00008040,-1,0,0x00000000,7106,7100,
	3,0x00000000,-1,0,0x00000000,7106,7100,3,0x00000000,2,-3,0x00000002,7106,7106,3,0x00000002,-1,0,0x00000000,7106,7106,3,0x00000002,-1,0,0x00000000,7106,7100,4,0x00000000,-1,0,0x00000000,7106,7106,4,0x00000002,-1,0,0x00000000,7106,7100,
	3,0x00000000,-1,0,0x00000000,7106,7100,3,0x00000000,-1,0,0x00000000,7106,7100,4,0x00000000,-1,0,0x00000000,7106,7100,4,0x00000000,-1,0,0x00000000,7106,7100,5,0x00000002,-1,0,0x00000000,7106,7100,5,0x00000002,-1,0,0x00000000,7106,7100,
	
	4,0x00000000,-1,0,0x00000000,5016,5000,4,0x00000000,2,0,0x00000002,5016,5023,5,0x00000000,2,-3,0x00000002,5016,5023,5,0x00000000,2,-5,0x00000002,5016,5023,6,0x00000000,2,-4,0x00008002,5016,5004,6,0x00000000,2,-5,0x00008002,5016,5004,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,2,0,0x00000010,5001,7300,3,0x00000000,2,-2,0x00000010,5001,7300,3,0x00000000,2,-4,0x00000010,5001,7300,3,0x00000000,2,-6,0x00000010,5001,7300,3,0x00000000,2,-8,0x00000010,5001,7300,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,2,0,0x00000020,5001,7301,3,0x00000000,2,-2,0x00000020,5001,7301,3,0x00000000,2,-4,0x00000020,5001,7301,3,0x00000000,2,-6,0x00000020,5001,7301,3,0x00000000,2,-8,0x00000020,5001,7301,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,2,-1,0x00000800,5001,7302,4,0x00000000,-1,0,0x00000000,5016,5000,4,0x00000000,2,-1,0x00000800,5016,7302,5,0x00000802,-1,0,0x00000000,5004,5000,5,0x00008802,-1,0,0x00000000,5005,5000,
	3,0x00000000,5,0,0x00000002,5001,5004,3,0x00000000,2,0,0x00000008,5001,5004,3,0x00000002,2,-2,0x00000008,5001,5004,4,0x00000002,2,-4,0x00000008,5016,5022,4,0x00000002,2,-5,0x00000008,5023,7307,4,0x00000002,2,-6,0x00000008,5023,7307,
	3,0x00000000,5,0,0x00000002,5001,5004,3,0x00000000,2,0,0x00000008,5001,5004,3,0x00000002,2,-2,0x00000008,5001,5004,4,0x00000002,2,-4,0x00000008,5016,5022,4,0x00000002,2,-5,0x00000004,5023,7308,4,0x00000002,2,-6,0x00000008,5023,7308,
	4,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,2,-3,0x00008000,5001,7303,6,0x00000800,2,-6,0x00008000,7300,7303,6,0x00000800,2,-2,0x00000040,7302,7306,8,0x00000840,-1,0,0x00000000,7309,5000,8,0x00000840,-1,0,0x00000000,7309,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,-1,0,0x00000000,5016,5000,5,0x00000000,5,0,0x00000002,5016,5004,5,0x00000000,5,-3,0x00000002,5016,5004,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,2,-1,0x00000800,5001,7302,4,0x00000000,-1,0,0x00000000,5016,5000,4,0x00000000,2,-1,0x00000800,5016,7302,5,0x00000802,-1,0,0x00000000,5004,5000,5,0x00008802,-1,0,0x00000000,5005,5000,
	
	4,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000000,5,0,0x00000002,5001,7200,5,0x00000000,5,-3,0x00000002,5016,7200,5,0x00000002,2,0,0x00000001,7200,7204,6,0x00000002,2,-3,0x00000001,7201,7204,6,0x00000080,-1,0,0x00000000,7210,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,2,0,0x00008000,5001,7201,4,0x00000000,2,-2,0x00008000,5001,7201,3,0x00008800,-1,0,0x00000000,7205,5000,4,0x00008800,-1,0,0x00000000,7205,5000,4,0x00000080,-1,0,0x00000000,7210,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,2,0,0x00008000,5001,7201,4,0x00000000,2,-2,0x00008000,5001,7201,3,0x00008800,-1,0,0x00000000,7205,5000,4,0x00008800,-1,0,0x00000000,7205,5000,4,0x00000080,-1,0,0x00000000,7210,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,5,0,0x00000002,5001,7200,3,0x00000000,5,-2,0x00000002,5001,7200,4,0x00000002,-1,0,0x00000000,7200,5000,4,0x00000802,-1,0,0x00000000,7204,5000,4,0x00000080,-1,0,0x00000000,7210,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,5,1,0x00000002,5001,7200,4,0x00000000,5,-1,0x00000002,5001,7200,4,0x00000002,2,-1,0x0000000C,7200,7206,4,0x00000802,2,-3,0x0000000C,7204,7208,6,0x00000080,-1,0,0x00000000,7210,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,-1,0,0x00000000,5001,5000,4,0x00008000,-1,0,0x00000000,7201,5000,4,0x00008000,-1,0,0x00000000,7201,5000,4,0x00008030,-1,0,0x00000000,7208,5000,4,0x00008030,-1,0,0x00000000,5808,5000,
	4,0x00000000,-1,0,0x00000000,5001,5000,4,0x00000800,-1,0,0x00000000,7202,5000,5,0x00000000,2,0,0x00000040,5016,7803,5,0x00000800,2,-3,0x00000040,7202,7207,6,0x00000840,-1,0,0x00000000,7207,5000,6,0x00000842,-1,0,0x00000000,7209,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,2,0,0x00000002,5001,7200,3,0x00000000,2,-3,0x00000002,5001,7200,3,0x00000802,-1,0,0x00000000,7200,5000,3,0x00000802,-1,0,0x00000000,7204,5000,
	3,0x00000000,-1,0,0x00000000,5001,5000,3,0x00000000,5,0,0x00000002,5001,7200,3,0x00000000,5,-2,0x00000002,5001,7200,4,0x00000002,-1,0,0x00000000,7200,5000,4,0x00000802,-1,0,0x00000000,7204,5000,4,0x00000080,-1,0,0x00000000,7210,5000,
	
	3,0x00000000,-1,0,0x00000000,6500,5000,3,0x00000800,2,3,0x00000002,6501,6503,3,0x00000800,2,0,0x00000002,6501,6503,3,0x00000802,2,2,0x00000001,6503,6502,3,0x00000801,6,2,0x00000040,6502,6504,6,0x00000800,2,-2,0x00000080,6501,6505,
	2,0x00000000,-1,0,0x00000000,6506,5000,2,0x00008000,-1,0,0x00000000,6507,5000,3,0x00000000,2,0,0x00000010,6508,6509,3,0x00000800,-1,0,0x00000000,6501,5000,3,0x00000810,-1,0,0x00000000,6510,5000,3,0x00000810,-1,0,0x00000000,6510,5000,
	2,0x00000000,-1,0,0x00000000,6506,5000,2,0x00008000,-1,0,0x00000000,6507,5000,3,0x00000000,2,0,0x00000020,6508,6509,3,0x00000800,-1,0,0x00000000,6501,5000,3,0x00000820,-1,0,0x00000000,6511,5000,3,0x00000820,-1,0,0x00000000,6511,5000,
	3,0x00000000,-1,0,0x00000000,6512,5000,3,0x00000000,-1,0,0x00000000,6512,5000,3,0x00000800,-1,0,0x00000000,6508,5000,3,0x00000802,-1,0,0x00000000,6503,5000,4,0x00000802,-1,0,0x00000000,6503,5000,4,0x00000802,6,2,0x00000080,6503,6513,
	3,0x00000000,-1,0,0x00000000,6512,5000,3,0x00000002,-1,0,0x00000000,6514,5000,3,0x00000002,2,0,0x00000008,6514,6515,4,0x0000080A,-1,0,0x00000000,6516,5000,4,0x0000080A,-1,0,0x00000000,6516,5000,4,0x00000809,-1,0,0x00000000,6517,5000,
	3,0x00000000,-1,0,0x00000000,6512,5000,3,0x00000002,-1,0,0x00000000,6514,5000,3,0x00000002,2,0,0x00000004,6514,6515,4,0x00000806,-1,0,0x00000000,6516,5000,4,0x00000806,-1,0,0x00000000,6516,5000,4,0x00000805,-1,0,0x00000000,6517,5000,
	3,0x00000000,-1,0,0x00000000,6518,5000,3,0x00000000,6,3,0x00000040,6518,6519,3,0x00000800,6,3,0x00000040,6501,6519,4,0x00008800,-1,0,0x00000000,6520,5000,4,0x00008840,-1,0,0x00000000,6521,5000,6,0x00000080,-1,0,0x00000000,6522,5000,
	3,0x00000000,-1,0,0x00000000,6523,5000,3,0x00000000,2,0,0x00000002,6523,6524,3,0x00000002,-1,0,0x00000000,6524,5000,3,0x00000002,2,4,0x00000001,6524,6525,4,0x00000002,2,2,0x00000001,6524,6525,4,0x00000001,-1,0,0x00000000,6526,5000,
	3,0x00000000,-1,0,0x00000000,6512,5000,3,0x00000000,-1,0,0x00000000,6512,5000,3,0x00000800,-1,0,0x00000000,6508,5000,3,0x00000802,-1,0,0x00000000,6503,5000,4,0x00000802,-1,0,0x00000000,6503,5000,4,0x00000802,6,2,0x00000080,6503,6513
};  

const uint[]CriticalFailureTable=
{
	0x00000000,0x00008000,0x00008000,0x00080002,0x00200000,
	0x00000000,0x00008000,0x00004000,0x00100000,0x00010000,
	0x00000000,0x00020000,0x00004000,0x00100000,0x00002000,
	0x00008000,0x00028000,0x0000C000,0x00100000,0x00009000,
	0x00040000,0x00004000,0x00084000,0x00100000,0x00001000,
	0x00008000,0x00040000,0x00002000,0x00100000,0x00009002,
	0x00000000,0x00008000,0x00100000,0x00002000,0x00009400
};                    

class CombatRes
{
	uint[]Res;
	Critter@Crit;
	int Left;
	int Right;
	
	CombatRes()
	{
		Res.resize(1);
		Res[0]=1;
		Left=(-1);
		Right=(-1);
	}
};

void AddEff(Critter@crit,uint[]eff,CombatRes[]&combatResults)
{
	int ptr=0; 
	
	if(combatResults.length()==0)
	{
		combatResults.resize(1);
		@combatResults[0].Crit=crit;
	}
	
	while(combatResults[ptr].Crit.Id!=crit.Id)
	{
		if(crit.Id<combatResults[ptr].Crit.Id)
		{
			if(combatResults[ptr].Left!=(-1))
			ptr=combatResults[ptr].Left;
			else
			{
				uint last=combatResults.length();
				combatResults.resize(last+1);
				combatResults[ptr].Left=last;
				ptr=last;
				@combatResults[last].Crit=crit;
			}
		}
		else
		{
			if(combatResults[ptr].Right!=(-1))
			ptr=combatResults[ptr].Right;
			else
			{
				uint last=combatResults.length();
				combatResults.resize(last+1);
				combatResults[ptr].Right=last;
				ptr=last;
				@combatResults[last].Crit=crit;
			}
		}
	} 
	
	uint len=eff.length();
	combatResults[ptr].Res.resize(combatResults[ptr].Res[0]+len);
	for(uint i=0;i<len;i++)
	combatResults[ptr].Res[i+combatResults[ptr].Res[0]]=eff[i];
	
	combatResults[ptr].Res[0]+=len;
}

void runTree(CombatRes[]&combatResults,int ptr)
{
	if(ptr==0)
	if(combatResults.length()==0)
	return;    
	
	combatResults[ptr].Crit.SendCombatResult(combatResults[ptr].Res);    
	
	if(combatResults[ptr].Left!=(-1))
	runTree(combatResults,combatResults[ptr].Left);
	if(combatResults[ptr].Right!=(-1))
	runTree(combatResults,combatResults[ptr].Right);
}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     

void AI_TrySayCombatText(Critter&npc,int textType)
{
	if(not npc.IsLife())
	return;
	uint ai=npc.Stat[(105)];
	if(AIData_[(((ai)<(282)?(ai):0)*22+16)]<Random(1,500))
	return;
	
	uint start=0,end=0;
	if(textType>=(0)&&textType<=(3))
	{
		start=AIGeneralMsg_[AIData_[(((ai)<(282)?(ai):0)*22+17)]*8+textType*2];
		end=AIGeneralMsg_[AIData_[(((ai)<(282)?(ai):0)*22+17)]*8+textType*2+1];
	}
	if(textType>=(10)&&textType<=(17))
	{
		textType-=10;
		start=AIBodyMsg_[AIData_[(((ai)<(282)?(ai):0)*22+18)]*16+textType*2];
		end=AIBodyMsg_[AIData_[(((ai)<(282)?(ai):0)*22+18)]*16+textType*2+1];
	}
	else
	return;
	if(start<=end)
	npc.SayMsg((2),(5),Random(start,end)*10);
}

const int[]AIData_=
{
	
	10,15,3,1,1,(1),(3),(0),(1),(0),(4),(1),(2),(0),10,5,0,45,27,0,0,0,
	90,20,5,30,1,(0),(1),(0),(0),(0),(2),(2),0,(0),30,3,25,6,7,0,0,0,
	10,12,15,40,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),3,20,20,6,7,0,0,0,
	40,15,15,35,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),100,15,80,6,7,0,0,0,
	20,15,14,50,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),20,4,75,6,7,0,0,0,
	100,1,0,0,0,(0),(0),(6),(0),(0),(0),0,0,(0),10,10,0,45,27,0,0,0,
	10,15,0,0,0,(0),(0),(1),(0),(0),(0),(1),(2),(0),25,1000000,0,45,27,0,0,0,
	45,15,0,0,0,(0),(0),(1),(0),(0),(0),(2),0,(0),1000000,40,0,45,27,0,0,0,
	60,15,0,0,0,(0),(0),(1),(0),(0),(0),(2),0,(0),10000,10,0,45,27,0,0,0,
	40,17,0,0,0,(0),(0),(1),(0),(0),(0),(1),(2),(0),1000000,30,0,45,27,0,0,0,
	70,20,0,10,1,(0),(4),(3),(0),(0),(0),(1),(2),(0),20,15,0,45,27,0,0,0,
	20,10,30,20,1,(0),(0),(0),(0),(0),(0),(1),0,(0),10000,30,35,11,10,0,0,0,
	80,20,4,20,1,(4),(4),(4),(3),(0),(0),(1),(2),(5),5,5,30,3,2,0,0,0,
	80,10,10,40,1,(0),(2),(0),(0),(0),(0),(1),(2),(4),1000,15,15,2,2,0,0,0,
	30,10,12,34,1,(0),(4),(0),(0),(0),(0),(1),(2),(3),10000,30,10,0,0,0,0,0,
	65,35,10,10,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,30,35,45,27,0,0,0,
	65,10,10,25,1,(4),(2),(4),(1),(0),(2),(1),(2),(4),10,8,23,2,2,0,0,0,
	33,8,8,30,1,(2),(4),(0),(0),(0),(0),(1),(2),(5),5000,20,25,1,1,0,0,0,
	90,15,1,25,1,(0),(0),(0),(0),(0),(0),(2),0,(0),40,8,16,5,2,0,0,0,
	20,10,10,28,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),3,1500,30,1,1,0,0,0,
	
	70,12,8,24,1,(0),(4),(0),(0),(0),(0),(1),(2),(4),80,30,20,0,0,0,0,0,
	80,18,0,0,0,(0),(0),(1),(0),(0),(0),(2),0,(0),600,200,0,45,27,0,0,0,
	95,19,1,15,1,(4),(4),(4),(0),(0),(2),0,0,(5),10,3,25,5,2,0,0,0,
	100,25,0,0,1,(0),(0),(0),(0),(0),(0),0,0,(0),10000,3,18,4,4,0,0,0,
	60,12,10,30,1,(0),(4),(0),(3),(0),(0),(1),(2),(5),75,20,25,2,2,0,0,0,
	95,7,0,0,1,(0),(4),(0),(3),(1),(1),(1),(2),(6),5,100,20,45,27,0,0,0,
	50,10,0,0,0,(0),(0),(1),(5),(0),(0),(1),(2),(0),20,20,0,45,27,(284),(81),(103),
	95,10,0,0,0,(0),(0),(1),(0),(0),(0),(1),(2),(0),20,20,0,45,27,0,0,0,
	50,10,0,10,0,(0),(4),(1),(0),(0),(1),(1),(2),(6),20,20,10,44,4,0,0,0,
	60,10,5,30,1,(0),(4),(3),(0),(0),(1),(1),(2),(6),20,20,0,45,27,0,0,0,
	50,10,10,30,1,(0),(2),(0),(0),(0),(0),(2),0,(0),20,20,15,9,6,0,0,0,
	100,13,0,0,1,(0),(4),(0),(0),(0),(0),(2),0,(0),20,20,20,9,6,0,0,0,
	90,10,0,0,1,(2),(4),(0),(0),(0),(2),(2),0,(6),10,10,25,9,6,0,0,0,
	20,10,30,30,1,(0),(0),(0),(0),(0),(0),(2),0,(0),20,20,25,0,0,0,0,0,
	40,10,10,20,1,(0),(4),(0),(0),(0),(0),(1),(2),(6),20,20,0,45,27,0,0,0,
	50,10,10,20,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),20,20,20,10,8,0,0,0,
	80,10,10,20,1,(1),(4),(4),(0),(0),(3),(1),(2),(0),20,4,25,10,8,0,0,0,
	40,10,10,20,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),20,20,10,10,8,0,0,0,
	80,15,8,10,1,(1),(4),(2),(5),(0),(1),(1),(2),(6),33,2,15,4,4,0,0,0,
	20,10,0,25,0,(0),(0),(0),(5),(0),(0),(1),(2),(0),20,2,0,45,27,(284),(81),(103),
	
	80,10,3,10,1,(0),(0),(0),(0),(0),(0),0,0,(6),2,200000,10,43,26,0,0,0,
	20,8,20,10,1,(0),(4),(0),(0),(0),(0),(1),(2),(0),20,20,20,1,1,0,0,0,
	2,5,30,10,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),20,20,18,2,2,0,0,0,
	35,5,15,10,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),20,20000,15,1,1,0,0,0,
	35,10,15,40,1,(0),(2),(0),(0),(0),(0),(1),(2),(4),20,15,15,2,2,0,0,0,
	35,7,15,40,1,(0),(0),(0),(1),(0),(0),(1),(2),(4),20,15,15,0,0,0,0,0,
	0,3,15,40,1,(2),(2),(2),(1),(0),(2),(1),(2),(3),20,15,15,0,0,0,0,0,
	95,15,1,20,1,(0),(4),(0),(0),(1),(0),(1),(2),(0),20,15,15,31,16,0,0,0,
	87,10,0,0,0,(0),(0),(1),(0),(0),(0),(1),(2),(0),20,15,0,45,27,0,0,0,
	35,5,15,10,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),20,20000,15,0,0,0,0,0,
	75,12,0,10,0,(4),(3),(3),(4),(0),(4),(1),(2),(0),20,200,0,45,27,(81),0,0,
	95,15,7,10,1,(0),(4),(0),(0),(0),(0),(1),(2),(0),20,1,15,10,8,0,0,0,
	45,12,10,10,1,(4),(3),(3),(4),(0),(4),(1),(2),(0),20,200,0,11,10,(81),0,0,
	45,12,10,10,1,(4),(3),(3),(4),(5),(4),(1),(2),(6),10,5,25,2,2,(81),0,0,
	45,12,10,10,1,(4),(2),(4),(3),(4),(2),(1),(2),(4),10,5,25,2,2,(81),0,0,
	45,12,10,10,1,(3),(0),(4),(3),(3),(5),(1),(2),(4),10,5,25,2,2,(81),0,0,
	45,12,10,10,1,(2),(4),(0),(2),(0),(5),(1),(2),(2),10,5,25,2,2,(81),0,0,
	1,12,10,10,1,(4),(4),(4),(3),(0),(4),(1),(2),(4),10,5,25,2,2,(81),0,0,
	45,12,10,10,1,(4),(4),(0),(1),(5),(2),(1),(2),(2),10,5,25,38,23,(81),0,0,
	45,12,10,10,1,(4),(3),(0),(3),(4),(2),(1),(2),(2),10,10,25,38,23,(81),0,0,
	
	45,12,10,10,1,(4),(0),(0),(3),(3),(5),(1),(2),(2),10,10,25,38,23,(81),0,0,
	45,12,10,10,1,(2),(4),(0),(3),(0),(5),(1),(2),(1),20,200,25,38,23,(81),0,0,
	45,12,10,10,1,(4),(4),(4),(1),(0),(5),(1),(2),(2),10,10,25,38,23,(81),0,0,
	45,12,10,10,1,(2),(4),(0),(1),(5),(2),(1),(2),(6),10,5,15,42,25,(81),0,0,
	45,12,10,10,1,(2),(4),(0),(3),(4),(2),(1),(2),(5),10,10,15,42,25,(81),0,0,
	45,12,10,10,1,(3),(0),(0),(3),(3),(4),(1),(2),(4),20,200,15,42,25,(81),0,0,
	45,12,10,10,1,(2),(4),(0),(2),(0),(5),(1),(2),(3),20,200,15,42,25,(81),0,0,
	30,12,10,10,1,(4),(0),(0),(3),(0),(2),(3),0,(5),5,10,20,42,25,(81),0,0,
	45,12,10,10,1,(2),(3),(4),(3),(5),(2),(1),(2),(6),10,5,15,39,24,(81),0,0,
	45,12,10,10,1,(4),(3),(4),(3),(4),(2),(1),(2),(5),10,10,15,39,24,(81),0,0,
	45,12,10,10,1,(4),(0),(4),(3),(3),(4),(1),(2),(4),10,10,15,39,24,(81),0,0,
	45,12,10,10,1,(2),(4),(4),(2),(0),(5),(1),(2),(4),10,10,15,39,24,(81),0,0,
	45,12,10,10,1,(4),(3),(4),(3),(0),(2),(1),(2),(5),10,10,15,39,24,(81),0,0,
	45,12,10,10,1,(1),(4),(5),(4),(5),(1),(1),(2),(6),10,5,35,33,17,(81),0,0,
	45,12,10,10,1,(2),(4),(5),(3),(4),(2),(1),(2),(5),10,5,35,33,17,(81),0,0,
	45,12,10,10,1,(4),(0),(5),(3),(3),(4),(1),(2),(5),10,5,35,33,17,(81),0,0,
	45,12,10,10,1,(2),(4),(0),(2),(0),(5),(1),(2),(5),10,10,35,33,17,(81),0,0,
	75,12,10,10,1,(4),(1),(5),(3),(0),(1),(1),(2),(5),10,5,35,33,17,(81),0,0,
	45,12,10,10,1,(4),(3),(3),(4),(5),(4),(1),(2),(6),20,200,25,37,21,(81),0,0,
	45,12,10,10,1,(4),(3),(0),(3),(4),(2),(1),(2),(4),20,200,25,37,21,(81),0,0,
	
	45,12,10,10,1,(2),(0),(4),(2),(3),(4),(1),(2),(3),10,2,25,37,21,(81),0,0,
	45,12,10,10,1,(2),(2),(4),(2),(0),(4),(1),(2),(2),10,2,25,37,21,(81),0,0,
	50,12,10,10,1,(2),(2),(4),(2),(0),(4),(1),(2),(4),10,2,25,37,21,(81),0,0,
	45,12,10,10,1,(0),(4),(3),(0),(5),(1),(1),(2),(6),20,200,10,46,27,(81),0,0,
	45,12,10,10,1,(0),(4),(3),(0),(4),(1),(1),(2),(5),20,200,10,46,27,(81),0,0,
	45,12,10,10,1,(0),(0),(3),(0),(3),(4),(1),(2),(5),20,200,10,46,27,(81),0,0,
	45,12,10,10,1,(0),(2),(3),(0),(0),(2),(1),(2),(3),20,200,10,46,27,(81),0,0,
	80,12,0,10,1,(0),(0),(3),(0),(0),(4),0,0,(5),20,200,10,46,27,(81),0,0,
	45,12,10,10,1,(4),(3),(3),(4),(5),(4),(1),(2),(5),20,200,0,45,27,(81),0,0,
	45,12,10,10,1,(4),(3),(0),(3),(4),(2),(1),(2),(4),20,200,0,45,27,(81),0,0,
	45,12,10,10,1,(3),(0),(0),(3),(3),(4),(1),(2),(3),20,200,0,45,27,(81),0,0,
	45,12,10,10,1,(2),(4),(0),(2),(0),(5),(1),(2),(2),20,200,0,45,27,(81),0,0,
	45,12,10,10,1,(4),(3),(3),(4),(0),(4),(1),(2),(3),20,200,0,45,27,(81),0,0,
	45,12,10,10,1,(0),(4),(3),(3),(5),(1),(1),(2),(6),20,200,25,36,20,(81),0,0,
	45,12,10,10,1,(0),(4),(3),(3),(4),(1),(1),(2),(5),20,200,25,36,20,(81),0,0,
	45,12,10,10,1,(3),(0),(0),(3),(3),(4),(1),(2),(4),20,200,25,36,20,(81),0,0,
	45,12,10,10,1,(0),(4),(3),(2),(0),(1),(1),(2),(5),20,200,25,36,20,(81),0,0,
	45,12,10,10,1,(0),(4),(3),(3),(0),(1),(1),(2),(5),20,200,25,36,20,(81),0,0,
	45,12,10,10,1,(4),(3),(3),(4),(5),(4),(1),(2),(6),20,200,20,1,1,(81),0,0,
	45,12,10,10,1,(4),(3),(0),(3),(4),(2),(1),(2),(5),20,200,20,1,1,(81),0,0,
	
	45,12,10,10,1,(3),(0),(0),(3),(3),(4),(1),(2),(4),20,200,20,1,1,(81),0,0,
	45,12,10,10,1,(2),(4),(0),(2),(0),(5),(1),(2),(2),20,200,20,1,1,(81),0,0,
	45,12,25,10,1,(5),(2),(0),(2),(0),(2),(1),(2),(4),20,200,20,1,1,(81),0,0,
	45,12,10,10,1,(4),(3),(3),(4),(5),(4),(1),(2),(6),20,200,15,1,1,(81),0,0,
	45,12,10,10,1,(4),(3),(0),(3),(4),(2),(1),(2),(5),20,200,15,1,1,(81),0,0,
	45,12,10,10,1,(3),(0),(0),(3),(3),(4),(1),(2),(4),20,200,15,1,1,(81),0,0,
	45,12,10,10,1,(2),(4),(0),(2),(0),(5),(1),(2),(3),20,200,15,1,1,(81),0,0,
	45,12,10,10,1,(3),(0),(4),(2),(0),(4),(1),(2),(4),20,200,15,1,1,(81),0,0,
	45,12,10,10,1,(4),(3),(3),(4),(5),(4),(1),(2),(6),20,200,0,45,27,(81),0,0,
	45,12,10,10,1,(4),(3),(0),(3),(4),(2),(1),(2),(5),20,200,0,45,27,(81),0,0,
	45,12,10,10,1,(3),(0),(0),(3),(3),(4),(1),(2),(4),20,200,0,45,27,(81),0,0,
	45,12,10,10,1,(2),(4),(0),(2),(0),(5),(1),(2),(2),20,200,0,45,27,(81),0,0,
	45,12,10,10,1,(4),(1),(3),(0),(0),(1),0,0,(4),20,200,0,45,27,(81),0,0,
	45,12,10,10,1,(1),(3),(0),(0),(5),(2),(1),(2),(6),10,10,15,35,19,0,0,0,
	45,12,10,10,1,(2),(3),(0),(0),(4),(2),(1),(2),(5),10,10,15,35,19,(81),0,0,
	45,12,10,10,1,(3),(0),(4),(0),(3),(4),(1),(2),(5),10,5,15,35,19,(81),0,0,
	45,12,10,10,1,(1),(2),(3),(0),(0),(3),(1),(2),(1),10,10,15,35,19,(81),0,0,
	50,12,10,10,1,(1),(4),(3),(0),(0),(3),0,0,(0),10,10,15,35,19,(81),0,0,
	45,12,10,10,1,(4),(3),(3),(4),(5),(4),(1),(2),(5),20,200,0,45,27,(81),0,0,
	45,12,10,10,1,(4),(3),(0),(3),(4),(2),(1),(2),(4),20,200,0,45,27,(81),0,0,
	
	45,12,10,10,1,(3),(0),(0),(3),(3),(4),(1),(2),(3),20,200,0,45,27,(81),0,0,
	45,12,10,10,1,(2),(4),(0),(2),(0),(5),(1),(2),(2),20,200,0,45,27,(81),0,0,
	45,12,10,10,1,(4),(3),(3),(0),(0),(4),(1),(2),(3),20,200,0,45,27,(81),0,0,
	1,3,15,80,0,(4),(2),(3),(4),(0),(4),(1),(2),(1),20,200,0,45,27,(81),0,0,
	100,12,3,10,1,(4),(3),(4),(1),(0),(2),(1),(2),(0),5,4,35,32,2,(81),0,0,
	100,12,1,0,1,(4),(3),(3),(4),(0),(4),0,0,(0),2,20,0,2,2,(81),0,0,
	90,20,1,10,1,(0),(0),(0),(0),(0),(0),0,0,(0),3000,30000,25,2,2,0,0,0,
	90,20,1,10,1,(4),(4),(4),(3),(0),(2),0,0,(5),5,4,25,5,2,0,0,0,
	90,20,1,10,1,(4),(4),(0),(0),(0),(0),0,0,(0),3000,5,30,14,22,0,0,0,
	90,20,1,10,1,(4),(4),(4),(0),(0),(2),0,0,(0),3000,5,25,31,16,0,0,0,
	100,20,1,10,1,(0),(0),(1),(0),(0),(0),0,0,(0),300,300,0,45,27,0,0,0,
	90,20,1,10,1,(0),(2),(3),(0),(0),(0),0,0,(0),3000,30000,0,45,27,0,0,0,
	90,20,1,10,0,(0),(0),(1),(0),(0),(0),0,0,(0),3000,30000,0,45,27,0,0,0,
	90,20,1,10,0,(0),(4),(3),(0),(0),(1),0,0,(6),5,30000,0,45,27,0,0,0,
	90,10,1,10,1,(0),(0),(0),(0),(0),(0),0,0,(0),25,25,25,5,2,0,0,0,
	90,20,1,10,1,(4),(4),(4),(0),(0),(5),0,0,(0),3,3,25,13,11,0,0,0,
	90,20,1,10,1,(4),(3),(4),(0),(0),(2),0,0,(0),3,3,25,12,11,0,0,0,
	90,20,1,10,1,(0),(2),(0),(0),(0),(0),0,0,(0),3,3,0,45,27,0,0,0,
	10,10,10,10,1,(0),(4),(0),(0),(1),(1),0,0,(6),10,5000,30,17,12,0,0,0,
	10,10,10,10,1,(0),(0),(0),(0),(5),(0),0,0,(0),10,5000,30,18,12,0,0,0,
	
	10,10,10,10,1,(0),(4),(0),(0),(1),(0),0,0,(3),10,5000,15,1,1,0,0,0,
	10,10,10,10,1,(0),(0),(0),(0),(1),(0),0,0,(0),10,5000,50,26,15,0,0,0,
	10,10,0,0,1,(4),(4),(0),(0),(1),(2),0,0,(6),5,5,15,45,27,0,0,0,
	10,10,10,10,1,(0),(0),(0),(0),(1),(0),0,0,(0),10,5000,15,6,7,0,0,0,
	10,10,10,10,0,(0),(0),(4),(0),(1),(0),0,0,(0),10,5000,15,45,27,0,0,0,
	10,10,0,0,1,(0),(3),(0),(0),(1),(0),(2),0,(6),10,5000,30,41,6,0,0,0,
	10,10,0,0,0,(0),(4),(1),(0),(1),(0),0,0,(6),4,5000,30,40,27,0,0,0,
	10,10,10,10,1,(1),(4),(0),(0),(1),(0),0,0,(5),10,5000,15,2,2,0,0,0,
	10,10,10,10,1,(0),(0),(0),(0),(1),(0),0,0,(0),10,5000,15,11,10,0,0,0,
	10,10,10,10,1,(0),(0),(0),(0),(1),(0),0,0,(0),10,5000,15,45,27,0,0,0,
	10,10,10,10,1,(0),(0),(0),(0),(1),(0),0,0,(0),10,5000,15,25,13,0,0,0,
	10,10,10,10,1,(0),(0),(0),(0),(1),(0),0,0,(0),10,5000,15,24,13,0,0,0,
	10,10,10,10,1,(0),(0),(0),(0),(1),(0),0,0,(0),10,5000,15,20,14,0,0,0,
	10,10,35,10,1,(0),(4),(0),(0),(1),(0),0,0,(5),10,5000,15,22,12,0,0,0,
	10,10,10,10,1,(0),(0),(0),(0),(1),(0),0,0,(0),10,5000,15,19,14,0,0,0,
	10,10,10,10,1,(0),(2),(0),(0),(1),(0),(2),(3),(5),10,2,15,21,14,0,0,0,
	10,12,10,0,1,(4),(4),(4),(3),(1),(5),(2),0,(5),10,2,25,22,12,0,0,0,
	10,10,10,10,1,(0),(0),(0),(0),(1),(0),0,0,(0),10,5000,15,23,13,0,0,0,
	10,10,10,10,1,(0),(0),(0),(0),(1),(0),0,0,(0),10,5000,15,23,13,0,0,0,
	10,10,10,10,1,(0),(0),(0),(0),(1),(0),0,0,(0),10,5000,15,23,13,0,0,0,
	
	10,10,10,10,1,(0),(0),(0),(0),(1),(0),0,0,(0),10,5000,15,23,13,0,0,0,
	10,10,10,10,1,(3),(2),(0),(0),(1),(0),0,0,(5),5,10,15,2,14,0,0,0,
	10,10,10,10,1,(1),(4),(4),(4),(1),(1),(2),0,(6),20,6,15,8,9,(87),0,0,
	100,50,1,50,1,(1),(4),(0),(2),(1),(0),0,0,(6),10,5000,30,8,9,0,0,0,
	10,10,10,10,0,(0),(0),(3),(0),(4),(1),0,0,(6),10,5000,15,45,27,0,0,0,
	10,10,10,10,0,(0),(4),(3),(0),(5),(1),0,0,(6),10,5000,15,45,27,0,0,0,
	10,10,10,10,0,(0),(4),(3),(0),(0),(4),0,0,(4),10,5000,15,45,27,0,0,0,
	10,10,10,10,0,(0),(0),(3),(0),(0),(1),0,0,(5),10,5000,15,45,27,0,0,0,
	10,10,10,10,0,(0),(0),(0),(0),(3),(0),0,0,(0),10,5000,15,45,27,0,0,0,
	10,10,10,10,0,(0),(0),(0),(0),(1),(0),0,0,(0),10,5000,0,45,27,0,0,0,
	10,10,10,10,0,(0),(0),(0),(0),(1),(0),0,0,(0),10,5000,0,45,27,0,0,0,
	10,10,10,10,0,(0),(0),(0),(0),(1),(0),0,0,(0),10,5000,0,45,27,0,0,0,
	10,10,10,10,0,(0),(0),(0),(0),(1),(0),0,0,(0),10,5000,0,45,27,0,0,0,
	10,10,10,10,0,(0),(0),(0),(0),(1),(0),0,0,(0),10,5000,0,45,27,0,0,0,
	100,15,0,0,1,(0),(4),(0),(0),(1),(3),(2),(3),(6),1,5000,25,9,6,0,0,0,
	10,10,10,10,1,(2),(4),(4),(3),(1),(2),0,0,(5),2,3,25,5,2,(40),0,0,
	10,10,10,10,1,(0),(4),(0),(0),(0),(0),0,0,(0),10,5000,0,45,27,0,0,0,
	100,15,0,0,1,(0),(2),(0),(0),(1),(0),0,0,(6),10,5000,25,44,4,0,0,0,
	10,10,10,80,0,(0),(0),(1),(0),(1),(0),0,0,(1),10,5000,15,45,27,0,0,0,
	10,10,100,90,1,(0),(0),(0),(0),(0),(0),0,0,(1),10,5000,15,0,0,0,0,0,
	
	10,10,10,10,1,(0),(0),(0),(0),(1),(3),0,0,(6),10,5000,15,0,0,0,0,0,
	10,10,10,10,1,(0),(0),(0),(0),(0),(0),0,0,(0),10,5000,15,2,2,0,0,0,
	10,10,10,10,1,(0),(0),(0),(0),(0),(0),0,0,(0),10,5000,15,2,2,0,0,0,
	100,20,0,0,1,(1),(4),(0),(0),(1),(2),0,0,(6),10,2,25,4,4,0,0,0,
	10,10,10,10,1,(0),(0),(0),(0),(0),(0),0,0,(1),10,5000,15,6,7,0,0,0,
	100,20,0,0,1,(1),(3),(0),(4),(1),(2),(2),0,(6),10,2,25,6,7,0,0,0,
	10,10,10,10,0,(0),(0),(1),(0),(0),(0),0,0,(0),10,5000,0,45,27,0,0,0,
	10,15,3,1,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10,5,0,45,27,0,0,0,
	80,22,0,1,1,(0),(0),(0),(0),(0),(0),0,0,(0),30,3,25,50,31,0,0,0,
	10,12,12,35,1,(0),(0),(0),(0),(0),(0),(3),(2),(0),3,6,20,51,32,0,0,0,
	5,15,12,30,1,(0),(0),(0),(0),(0),(0),(1),0,(0),10000,5,0,45,27,0,0,0,
	20,15,5,1,1,(0),(0),(0),(0),(0),(0),(3),0,(0),20,4,25,0,0,0,0,0,
	1,10,15,80,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),100,100,20,55,36,0,0,0,
	10,15,10,15,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),25,8,20,47,28,0,0,0,
	40,20,1,20,1,(0),(0),(0),(0),(0),(0),(2),0,(0),10,4,25,48,29,0,0,0,
	60,12,4,10,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,10,0,45,27,0,0,0,
	40,12,10,30,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),1000000,30,20,81,62,0,0,0,
	60,12,3,15,1,(0),(0),(0),(0),(0),(0),(3),(2),(0),25,15,20,82,63,0,0,0,
	70,15,8,20,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,30,25,109,90,0,0,0,
	80,6,1,2,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,30,3,108,89,0,0,0,
	
	80,10,4,5,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,30,0,45,27,0,0,0,
	90,10,1,8,1,(0),(0),(0),(0),(0),(0),(1),0,(0),10000,30,0,45,27,0,0,0,
	70,10,6,20,1,(0),(0),(0),(0),(0),(0),(2),0,(0),10000,30,25,49,30,0,0,0,
	75,10,10,20,1,(0),(0),(0),(0),(0),(0),(3),(2),(0),15,25,23,57,38,0,0,0,
	33,10,8,30,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),50,20,25,58,39,0,0,0,
	55,12,8,20,1,(0),(0),(0),(0),(0),(0),(3),(2),(0),40,30,10,59,40,0,0,0,
	60,15,4,20,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),30,15,30,60,41,0,0,0,
	80,50,6,14,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),80,30,20,112,93,0,0,0,
	70,18,8,17,1,(0),(0),(0),(0),(0),(0),(3),(2),(0),60,20,25,112,93,0,0,0,
	78,10,3,30,1,(0),(0),(0),(0),(0),(0),0,0,(0),20,10,20,62,43,0,0,0,
	20,9,12,40,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,30,18,63,44,0,0,0,
	60,12,16,30,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),75,20,25,64,45,0,0,0,
	40,14,12,30,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10,15,20,65,46,0,0,0,
	95,12,10,5,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),100,8,30,66,47,0,0,0,
	80,10,5,15,1,(0),(0),(0),(0),(0),(0),(2),0,(0),10000,30,15,67,48,0,0,0,
	75,10,15,18,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,30,20,68,49,0,0,0,
	90,12,2,25,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),12,8,30,69,50,0,0,0,
	40,8,20,45,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),80,18,15,70,51,0,0,0,
	50,10,5,20,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),40,12,25,71,52,0,0,0,
	65,14,5,20,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,30,10,72,53,0,0,0,
	
	80,12,10,15,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),18,8,20,73,54,0,0,0,
	60,12,20,20,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,30,20,74,55,0,0,0,
	94,10,2,15,1,(0),(0),(0),(0),(0),(0),0,0,(0),10000,30,30,75,56,0,0,0,
	80,14,1,20,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,30,15,76,57,0,0,0,
	80,12,2,20,1,(0),(0),(0),(0),(0),(0),(2),0,(0),8,4,30,77,58,0,0,0,
	80,12,25,25,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),9,1,25,78,59,0,0,0,
	50,10,20,40,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10,10,25,79,60,0,0,0,
	20,7,18,50,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,30,20,80,61,0,0,0,
	40,10,12,30,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),1000000,100,15,81,62,0,0,0,
	60,12,5,15,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),1000000,1000,10,53,34,0,0,0,
	60,12,10,10,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),4,4,100,124,105,0,0,0,
	60,12,5,15,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),1000000,1000,30,53,34,0,0,0,
	60,12,5,15,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),1000000,1000,30,53,34,0,0,0,
	40,14,5,10,1,(0),(0),(0),(0),(0),(0),(3),(2),(0),10,4,25,82,63,0,0,0,
	50,14,5,25,1,(0),(0),(0),(0),(0),(0),(2),0,(0),10,4,30,54,35,0,0,0,
	90,14,1,30,1,(0),(0),(0),(0),(0),(0),0,0,(0),10,4,30,84,65,0,0,0,
	90,20,1,10,1,(0),(0),(0),(0),(0),(0),0,0,(0),6,2,20,85,66,0,0,0,
	30,10,20,5,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,30,30,86,67,0,0,0,
	30,10,8,10,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,30,15,87,68,0,0,0,
	60,10,16,20,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),75,20,20,88,69,0,0,0,
	
	50,7,13,35,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),200,50,15,89,70,0,0,0,
	70,6,1,20,1,(0),(0),(0),(0),(0),(0),0,0,(0),10000,30,0,45,27,0,0,0,
	50,10,8,45,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),1000,30,18,90,71,0,0,0,
	70,15,3,20,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,30,20,91,72,0,0,0,
	70,10,1,20,1,(0),(0),(0),(0),(0),(0),(3),(2),(0),10000,30,20,92,73,0,0,0,
	85,10,8,20,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,30,35,93,74,0,0,0,
	80,10,5,25,1,(0),(0),(0),(0),(0),(0),0,0,(0),10000,30,35,94,75,0,0,0,
	70,10,1,15,1,(0),(0),(0),(0),(0),(0),0,0,(0),4,30,20,95,76,0,0,0,
	55,12,20,10,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),16,30,20,96,77,0,0,0,
	50,12,1,20,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),40,20,20,97,78,0,0,0,
	30,12,12,20,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),200,20,15,98,79,0,0,0,
	70,10,1,15,1,(0),(0),(0),(0),(0),(0),(2),0,(0),20,10,25,99,80,0,0,0,
	80,10,1,10,1,(0),(0),(0),(0),(0),(0),(2),0,(0),10,6,8,100,81,0,0,0,
	70,14,1,10,1,(0),(0),(0),(0),(0),(0),0,0,(0),14,6,12,52,33,0,0,0,
	10,7,12,20,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,30,15,102,83,0,0,0,
	20,8,15,10,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,30,35,121,102,0,0,0,
	70,10,1,20,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,30,20,110,91,0,0,0,
	100,14,1,1,1,(0),(0),(0),(0),(0),(0),0,0,(0),4,3,20,105,86,0,0,0,
	70,10,10,20,1,(0),(0),(0),(0),(0),(0),0,0,(0),10000,8,15,104,85,0,0,0,
	73,10,15,20,1,(0),(0),(0),(0),(0),(0),(1),0,(0),10000,30,0,45,27,0,0,0,
	
	77,10,1,30,1,(0),(0),(0),(0),(0),(0),(1),0,(0),10000,30,0,45,27,0,0,0,
	70,12,10,20,1,(0),(0),(0),(0),(0),(0),0,0,(0),10000,30,5,104,85,0,0,0,
	60,10,15,25,1,(0),(0),(0),(0),(0),(0),(1),0,(0),10000,30,20,107,88,0,0,0,
	30,10,12,25,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,25,20,61,42,0,0,0,
	20,8,8,20,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,30,15,103,84,0,0,0,
	90,8,10,10,1,(0),(0),(0),(0),(0),(0),0,0,(0),10000,30,25,106,87,0,0,0,
	75,12,10,25,1,(0),(0),(0),(0),(0),(0),(2),(1),(0),10000,30,20,111,92,0,0,0,
	20,8,1,30,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),12,12,15,101,82,0,0,0,
	20,8,1,30,1,(0),(0),(0),(0),(0),(0),(3),0,(0),12,12,30,113,94,0,0,0,
	50,12,20,15,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),2,2,35,114,95,0,0,0,
	90,15,1,15,1,(0),(0),(0),(0),(0),(0),(2),0,(0),4,3,35,115,96,0,0,0,
	10,12,20,30,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),44,22,25,116,97,0,0,0,
	45,8,15,30,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),10000,30,22,117,98,0,0,0,
	80,30,10,20,1,(0),(0),(0),(0),(0),(0),(2),0,(0),8,5,30,118,99,0,0,0,
	45,6,18,35,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),100,18,25,119,100,0,0,0,
	70,8,8,20,1,(0),(0),(0),(0),(0),(0),(2),0,(0),50,12,25,120,101,0,0,0,
	100,30,15,40,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),6,4,15,56,37,0,0,0,
	100,8,0,20,1,(0),(0),(0),(0),(0),(0),0,0,(0),4,10,25,122,103,0,0,0,
	0,8,14,25,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),400000,100000,20,123,104,0,0,0,
	100,20,1,1,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),40,2,0,45,27,0,0,0,
	
	80,4,0,1,1,(0),(0),(0),(0),(0),(0),0,0,(0),25,10,0,45,27,0,0,0,
	1,18,200,100,1,(0),(0),(0),(0),(0),(0),(1),(2),(0),25,10,0,45,27,0,0,0,
};

const uint[]AIGeneralMsg_=
{
	
	2000,2019,2020,2039,2040,2059,2060,2079,
	2100,2119,2120,2139,2140,2159,2160,2172,
	2200,2219,2220,2239,2240,2259,2260,2272,
	2400,2405,2420,2427,2440,2449,2460,2465,
	2300,2319,2320,2339,2340,2359,2360,2372,
	2500,2505,2520,2525,2540,2552,2560,2565,
	2600,2606,2620,2629,2640,2651,2660,2669,
	2700,2705,2720,2727,2740,2749,2760,2765,
	2900,2905,2920,2925,2940,2950,2960,2964,
	3000,3005,3020,3025,3040,3049,3060,3065,
	3100,3119,3120,3139,3140,3159,3160,3179,
	3200,3205,3220,3226,3240,3246,3260,3265,
	12000,12006,12020,12038,12040,12049,12060,12065,
	12100,12105,12120,12125,12140,12149,12160,12165,
	12200,12205,12220,12228,12240,12249,12260,12266,
	26000,26005,26020,26025,26040,26050,26060,26060,
	26100,26105,26120,26126,26140,26149,26160,26166,
	32100,32105,32120,32128,32140,32149,32160,32165,
	32200,32205,32220,32228,32240,32249,32260,32265,
	32300,32305,32320,32325,32340,32348,32360,32365,
	
	32400,32405,32420,32428,32440,32448,32460,32465,
	32500,32505,32520,32526,32540,32549,32560,32565,
	32600,32604,32620,32626,32640,32649,32660,32665,
	32800,32805,32820,32828,32840,32847,32860,32865,
	33000,33005,33020,33028,33040,33045,33060,33064,
	33100,33105,33120,33128,33140,33149,33160,33165,
	36100,36105,36120,36124,36140,36148,36160,36165,
	36200,36205,36220,36223,36240,36249,36260,36265,
	36300,36305,36320,36323,36340,36348,36360,36365,
	36400,36405,36420,36423,36440,36449,36460,36465,
	36500,36500,36520,36523,36540,36548,36560,36565,
	36700,36705,36720,36727,36740,36749,36760,36765,
	36800,36819,36820,36839,36840,36859,36860,36879,
	40100,40119,40120,40139,40140,40159,40160,40179,
	44100,44102,44120,44100,44140,44100,44160,44100,
	44500,44507,44520,44528,44540,44549,44560,44566,
	44900,44909,44920,44939,44940,44959,44960,44979,
	41300,41319,41320,41339,41340,41359,41360,41379,
	42100,42117,42120,42133,42140,42159,42160,42177,
	40900,40912,40920,40929,40940,40959,40960,40979,
	
	10000,10000,10020,10038,10040,10058,10060,10060,
	10100,10100,10120,10139,10140,10159,10160,10160,
	41700,41719,41720,41739,41740,41759,41760,41779,
	18100,18107,18120,18127,18140,18154,18160,18177,
	14000,14009,14020,14029,14040,14049,14060,14069,
	50100,50100,50120,50120,50140,50140,50160,50160,
	60000,60000,60020,60020,60040,60041,60060,60060,
	61900,61905,61920,61911,61940,61921,61960,61900,
	62100,62105,62120,62111,62140,62121,62160,62100,
	61000,61005,61020,61011,61040,61021,61060,61000,
	61800,61805,61820,61811,61840,61821,61860,61800,
	62000,62005,62020,62011,62040,62021,62060,62000,
	62200,62205,62220,62211,62240,62221,62260,62200,
	65000,65005,65020,65011,65040,65021,65060,65000,
	65200,65205,65220,65211,65240,65221,65260,65200,
	61700,61705,61720,61711,61740,61721,61760,61700,
	68300,68300,68320,68300,68340,68300,68360,68300,
	61100,61105,61120,61111,61140,61121,61160,61100,
	61200,61205,61220,61211,61240,61224,61260,61200,
	61300,61305,61320,61311,61340,61321,61360,61300,
	
	61400,61405,61420,61411,61440,61421,61460,61400,
	61500,61505,61520,61511,61540,61521,61560,61500,
	63000,63005,63020,63011,63040,63022,63060,63000,
	63100,63105,63120,63111,63140,63121,63160,63100,
	63200,63205,63220,63211,63240,63221,63260,63200,
	63300,63305,63320,63311,63340,63321,63360,63300,
	63400,63405,63420,63411,63440,63421,63460,63400,
	63500,63505,63520,63511,63540,63521,63560,63500,
	63600,63605,63620,63611,63640,63621,63660,63600,
	63700,63705,63720,63711,63740,63721,63760,63700,
	63800,63805,63820,63811,63840,63821,63860,63800,
	63900,63905,63920,63911,63940,63921,63960,63900,
	64000,64005,64020,64011,64040,64021,64060,64000,
	64100,64105,64120,64111,64140,64121,64160,64100,
	64200,64205,64220,64211,64240,64221,64260,64200,
	64300,64305,64320,64311,64340,64321,64360,64300,
	64400,64405,64420,64411,64440,64421,64460,64400,
	64500,64505,64520,64511,64540,64521,64560,64500,
	64600,64605,64620,64611,64640,64621,64660,64600,
	64700,64705,64720,64711,64740,64721,64760,64700,
	
	64800,64805,64820,64811,64840,64821,64860,64800,
	64900,64905,64920,64911,64940,64921,64960,64900,
	65100,65105,65120,65111,65140,65121,65160,65100,
	68700,68705,68720,68711,68740,68721,68760,68700,
	65300,65305,65320,65311,65340,65321,65360,65300,
	65400,65405,65420,65411,65440,65421,65460,65400,
	65500,65505,65520,65511,65540,65521,65560,65500,
	65600,65605,65620,65611,65640,65621,65660,65600,
	65700,65705,65720,65711,65740,65721,65760,65700,
	65800,65805,65820,65811,65840,65821,65860,65800,
	65900,65905,65920,65911,65940,65921,65960,65900,
	66000,66005,66020,66011,66040,66021,66060,66000,
	66100,66105,66120,66111,66140,66121,66160,66100,
	66200,66205,66220,66211,66240,66221,66260,66200,
	66300,66305,66320,66311,66340,66321,66360,66300,
	66400,66405,66420,66411,66440,66421,66460,66400,
	66500,66505,66520,66511,66540,66521,66560,66500,
	66600,66605,66620,66611,66640,66621,66660,66600,
	66700,66705,66720,66711,66740,66721,66760,66700,
	66800,66805,66820,66811,66840,66821,66860,66800,
	
	66900,66905,66920,66911,66940,66921,66960,66900,
	67000,67005,67020,67011,67040,67021,67060,67000,
	62300,62305,62320,62311,62340,62321,62360,62300,
	62400,62405,62420,62411,62440,62421,62460,62400,
	68000,68005,68020,68011,68040,68021,68060,68000,
	62600,62605,62620,62611,62640,62621,62660,62600,
	62700,62705,62720,62711,62740,62721,62760,62700,
	68100,68105,68120,68111,68140,68121,68160,68100,
	68200,68205,68220,68211,68240,68221,68260,68200,
	61600,61605,61620,61611,61640,61621,61660,61600,
	62500,62505,62520,62511,62540,62521,62560,62500,
	62800,62805,62820,62811,62840,62821,62860,62800,
	62900,62905,62920,62911,62940,62921,62960,62900,
	67100,67105,67120,67111,67140,67121,67160,67100,
	67200,67205,67220,67211,67240,67221,67260,67200,
	67300,67305,67320,67311,67340,67321,67360,67300,
	67400,67405,67420,67411,67440,67421,67460,67400,
	67500,67505,67520,67511,67540,67521,67560,67500,
	67600,67605,67620,67611,67640,67621,67660,67600,
	67700,67705,67720,67711,67740,67721,67760,67700,
	
	67800,67805,67820,67811,67840,67821,67860,67800,
	67900,67905,67920,67911,67940,67921,67960,67900,
	68400,68402,68420,68405,68440,68408,68460,68400,
	68500,68500,68520,68502,68540,68505,68560,68500,
	68600,68605,68620,68611,68640,68621,68660,68600
};

const uint[]AIBodyMsg_=
{
	
	1000,1009,1010,1019,1020,1029,1030,1059,1060,1069,1070,1079,1080,1089,1090,1099,
	1100,1109,1110,1119,1120,1129,1130,1159,1160,1169,1170,1179,1180,1189,1190,1199,
	1200,1209,1210,1219,1220,1229,1230,1259,1260,1269,1270,1279,1280,1289,1290,1299,
	0,0,10,0,20,0,30,0,60,0,70,0,80,0,90,0,
	1300,1309,1310,1319,1320,1329,1330,1359,1360,1369,1370,1379,1380,1389,1390,1399,
	0,0,10,0,20,0,30,0,60,0,70,0,80,0,90,0,
	1400,1402,1410,1412,1420,1422,1430,1439,1460,1462,1470,1472,1480,1482,1490,1492,
	1500,1509,1510,1519,1520,1529,1530,1559,1560,1569,1570,1579,1580,1589,1590,1599,
	1600,1609,1610,1619,1620,1629,1630,1639,1660,1669,1670,1679,1680,1689,1690,1699,
	1700,1709,1710,1712,1720,1722,1730,1735,1760,1763,1770,1773,1780,1783,1790,1796,
	1800,1804,1810,1813,1820,1823,1830,1837,1860,1862,1870,1872,1880,1882,1890,1898,
	12300,12303,12310,12312,12320,12322,12330,12335,12360,12363,12370,12373,12380,12382,12390,12396,
	32000,32002,32010,32012,32020,32022,32030,32036,32060,32062,32070,32072,32080,32082,32090,32095,
	32700,32702,32710,32712,32720,32722,32730,32736,32760,32762,32770,32772,32780,32782,32790,32795,
	33200,33202,33210,33212,33220,33222,33230,33236,33260,33262,33270,33272,33280,33282,33290,33295,
	36000,36002,36010,36012,36020,36022,36030,36035,36060,36062,36070,36072,36080,36082,36090,36095,
	36600,36602,36610,36612,36620,36622,36630,36645,36660,36662,36670,36672,36680,36682,36690,36695,
	40000,40009,40010,40019,40020,40029,40030,40059,40060,40069,40070,40079,40080,40089,40090,40099,
	44000,44000,44010,44010,44020,44020,44030,44030,44060,44060,44070,44070,44080,44080,44090,44090,
	44400,44408,44410,44413,44420,44423,44430,44439,44460,44463,44470,44473,44480,44483,44490,44492,
	
	44800,44804,44810,44814,44820,44824,44830,44849,44860,44864,44870,44874,44880,44884,44890,44894,
	41200,41209,41210,41219,41220,41229,41230,41259,41260,41269,41270,41279,41280,41289,41290,41299,
	12400,12409,12410,12419,12420,12429,12430,12459,12460,12469,12470,12479,12480,12489,12490,12499,
	42000,42009,42010,42017,42020,42027,42030,42058,42060,42068,42070,42078,42080,42089,42090,42099,
	40800,40807,40810,40818,40820,40828,40830,40859,40860,40867,40870,40877,40880,40886,40890,40899,
	41600,41609,41610,41619,41620,41629,41630,41659,41660,41669,41670,41679,41680,41689,41690,41699,
	18000,18002,18010,18011,18020,18021,18030,18035,18060,18061,18070,18071,18080,18082,18090,18092,
	50000,50000,50010,50010,50020,50020,50030,50030,50060,50060,50070,50070,50080,50080,50090,50090,
	61928,61930,61938,61933,61948,61936,61958,61943,61988,61946,61998,61949,62008,61952,62018,61957,
	62128,62130,62138,62133,62148,62136,62158,62136,62188,62139,62198,62142,62208,62145,62218,62150,
	61028,61030,61038,61033,61048,61036,61058,61040,61088,61043,61098,61046,61108,61049,61118,61054,
	61828,61830,61838,61833,61848,61836,61858,61843,61888,61846,61898,61849,61908,61852,61918,61857,
	62028,62030,62038,62033,62048,62036,62058,62043,62088,62046,62098,62049,62108,62052,62118,62057,
	62228,62230,62238,62233,62248,62236,62258,62243,62288,62246,62298,62249,62308,62252,62318,62257,
	65028,65030,65038,65033,65048,65036,65058,65046,65088,65049,65098,65052,65108,65055,65118,65060,
	65228,65230,65238,65233,65248,65236,65258,65246,65288,65249,65298,65252,65308,65255,65318,65260,
	61728,61730,61738,61733,61748,61736,61758,61736,61788,61739,61798,61742,61808,61745,61818,61750,
	68302,68301,68312,68301,68322,68301,68332,68302,68362,68302,68372,68302,68382,68302,68392,68302,
	61128,61130,61138,61133,61148,61136,61158,61140,61188,61143,61198,61146,61208,61149,61218,61154,
	61231,61233,61241,61236,61251,61239,61261,61242,61291,61245,61301,61248,61311,61251,61321,61256,
	
	61328,61330,61338,61333,61348,61337,61358,61343,61388,61346,61398,61349,61408,61352,61418,61357,
	61428,61430,61438,61433,61448,61436,61458,61442,61488,61445,61498,61448,61508,61451,61518,61456,
	61528,61530,61538,61533,61548,61536,61558,61543,61588,61546,61598,61549,61608,61552,61618,61557,
	63028,63030,63038,63033,63048,63036,63058,63046,63088,63049,63098,63052,63108,63055,63118,63060,
	63128,63130,63138,63133,63148,63136,63158,63146,63188,63149,63198,63152,63208,63155,63218,63160,
	63228,63230,63238,63233,63248,63236,63258,63246,63288,63249,63298,63252,63308,63255,63318,63260,
	63328,63330,63338,63333,63348,63336,63358,63346,63388,63349,63398,63352,63408,63355,63418,63360,
	63428,63430,63438,63433,63448,63436,63458,63446,63488,63449,63498,63452,63508,63455,63518,63460,
	63528,63530,63538,63533,63548,63536,63558,63546,63588,63549,63598,63552,63608,63555,63618,63560,
	63628,63630,63638,63633,63648,63636,63658,63646,63688,63649,63698,63652,63708,63655,63718,63660,
	63728,63730,63738,63733,63748,63736,63758,63746,63788,63749,63798,63752,63808,63755,63818,63760,
	63828,63830,63838,63833,63848,63836,63858,63836,63888,63839,63898,63842,63908,63845,63918,63850,
	63928,63930,63938,63933,63948,63936,63958,63946,63988,63949,63998,63952,64008,63955,64018,63960,
	64028,64030,64038,64033,64048,64036,64058,64046,64088,64049,64098,64052,64108,64055,64118,64060,
	64128,64130,64138,64133,64148,64136,64158,64146,64188,64149,64198,64152,64208,64155,64218,64160,
	64228,64230,64238,64233,64248,64236,64258,64246,64288,64249,64298,64252,64308,64255,64318,64260,
	64328,64330,64338,64333,64348,64336,64358,64346,64388,64349,64398,64352,64408,64355,64418,64360,
	64428,64430,64438,64433,64448,64436,64458,64446,64488,64449,64498,64452,64508,64455,64518,64460,
	64528,64530,64538,64533,64548,64536,64558,64546,64588,64549,64598,64552,64608,64555,64618,64560,
	64628,64630,64638,64633,64648,64636,64658,64646,64688,64649,64698,64652,64708,64655,64718,64660,
	
	64728,64730,64738,64733,64748,64736,64758,64746,64788,64749,64798,64752,64808,64755,64818,64760,
	64828,64830,64838,64833,64848,64836,64858,64846,64888,64849,64898,64852,64908,64855,64918,64860,
	64928,64930,64938,64933,64948,64936,64958,64946,64988,64949,64998,64952,65008,64955,65018,64960,
	65128,65130,65138,65133,65148,65136,65158,65146,65188,65149,65198,65152,65208,65155,65218,65160,
	68728,68730,68738,68733,68748,68736,68758,68746,68788,68749,68798,68752,68808,68755,68818,68760,
	65328,65330,65338,65333,65348,65336,65358,65346,65388,65349,65398,65352,65408,65355,65418,65360,
	65428,65430,65438,65433,65448,65436,65458,65446,65488,65449,65498,65452,65508,65455,65518,65460,
	65528,65530,65538,65533,65548,65536,65558,65546,65588,65549,65598,65552,65608,65555,65618,65560,
	65628,65630,65638,65633,65648,65636,65658,65646,65688,65649,65698,65652,65708,65655,65718,65660,
	65728,65730,65738,65733,65748,65736,65758,65746,65788,65749,65798,65752,65808,65755,65818,65760,
	65828,65830,65838,65833,65848,65836,65858,65846,65888,65849,65898,65852,65908,65855,65918,65860,
	65928,65930,65938,65933,65948,65936,65958,65946,65988,65949,65998,65952,66008,65955,66018,65960,
	66028,66030,66038,66033,66048,66036,66058,66046,66088,66049,66098,66052,66108,66055,66118,66060,
	66128,66130,66138,66133,66148,66136,66158,66146,66188,66149,66198,66152,66208,66155,66218,66160,
	66228,66230,66238,66233,66248,66236,66258,66246,66288,66249,66298,66252,66308,66255,66318,66260,
	66328,66330,66338,66333,66348,66336,66358,66346,66388,66349,66398,66352,66408,66355,66418,66360,
	66428,66430,66438,66433,66448,66436,66458,66446,66488,66449,66498,66452,66508,66455,66518,66460,
	66528,66530,66538,66533,66548,66536,66558,66546,66588,66549,66598,66552,66608,66555,66618,66560,
	66628,66630,66638,66633,66648,66636,66658,66646,66688,66649,66698,66652,66708,66655,66718,66660,
	66728,66730,66738,66733,66748,66736,66758,66746,66788,66749,66798,66752,66808,66755,66818,66760,
	
	66828,66830,66838,66833,66848,66836,66858,66846,66888,66849,66898,66852,66908,66855,66918,66860,
	66928,66930,66938,66933,66948,66936,66958,66946,66988,66949,66998,66952,67008,66955,67018,66960,
	67028,67030,67038,67033,67048,67036,67058,67046,67088,67049,67098,67052,67108,67055,67118,67060,
	62328,62330,62338,62333,62348,62336,62358,62342,62388,62345,62398,62348,62408,62351,62418,62356,
	62428,62430,62438,62433,62448,62436,62458,62441,62488,62444,62498,62447,62508,62450,62518,62455,
	68028,68030,68038,68033,68048,68036,68058,68046,68088,68049,68098,68052,68108,68055,68118,68060,
	62628,62630,62638,62633,62648,62636,62658,62636,62688,62639,62698,62642,62708,62645,62718,62650,
	62728,62730,62738,62730,62748,62730,62758,62735,62788,62735,62798,62735,62808,62735,62818,62737,
	68128,68130,68138,68133,68148,68136,68158,68146,68188,68149,68198,68152,68208,68155,68218,68157,
	68228,68230,68238,68233,68248,68236,68258,68246,68288,68249,68298,68252,68308,68255,68318,68260,
	61628,61630,61638,61633,61648,61636,61658,61644,61688,61647,61698,61650,61708,61653,61718,61658,
	62528,62530,62538,62533,62548,62536,62558,62542,62588,62545,62598,62548,62608,62551,62618,62556,
	62828,62830,62838,62833,62848,62836,62858,62844,62888,62847,62898,62850,62908,62853,62918,62858,
	62928,62930,62938,62933,62948,62936,62958,62946,62988,62949,62998,62952,63008,62955,63018,62960,
	67128,67130,67138,67133,67148,67136,67158,67146,67188,67149,67198,67152,67208,67155,67218,67160,
	67228,67230,67238,67233,67248,67236,67258,67246,67288,67249,67298,67252,67308,67255,67318,67260,
	67328,67330,67338,67333,67348,67336,67358,67346,67388,67349,67398,67352,67408,67355,67418,67360,
	67428,67430,67438,67433,67448,67436,67458,67446,67488,67449,67498,67452,67508,67455,67518,67460,
	67528,67530,67538,67533,67548,67536,67558,67546,67588,67549,67598,67552,67608,67555,67618,67560,
	67628,67630,67638,67633,67648,67636,67658,67646,67688,67649,67698,67652,67708,67655,67718,67660,
	
	67728,67730,67738,67733,67748,67736,67758,67746,67788,67749,67798,67752,67808,67755,67818,67760,
	67828,67830,67838,67833,67848,67836,67858,67846,67888,67849,67898,67852,67908,67855,67918,67860,
	67928,67930,67938,67933,67948,67936,67958,67946,67988,67949,67998,67952,68008,67955,68018,67960,
	68411,68412,68421,68414,68431,68416,68441,68420,68471,68422,68481,68424,68491,68426,68501,68426,
	68508,68511,68518,68513,68528,68515,68538,68518,68568,68520,68578,68522,68588,68524,68598,68526,
	68628,68630,68638,68633,68648,68636,68658,68646,68688,68649,68698,68652,68708,68655,68718,68660
};                                         

import void DeteriorateItem(Critter&cr,Item&item,int deteriorateCount)from"repair";
import void AffectPoison(Critter&cr,int value)from"poison";
import void AffectRadiation(Critter&cr,int value)from"radiation";
import void QuakeScreen2(Critter&cr)from"effects";
import void QuakeScreen(Map&map)from"effects";
import void AffectParalysis(Critter&cr,int value)from"paralysis";
import void AffectPoisonByCritter(Critter&cr,int value,Critter&atacker)from"poison";
import void delmob(Critter&cr,int p0,int p1,int p2)from"debug";
import void HookAttack(Critter&cr,Critter@target,uint8 force,uint8 pull)from"handcuffs";
import void HookMeleeAttack(Critter&cr,Critter@target)from"handcuffs";
import void HookHoldAttack(Critter@target,uint8 hardness)from"handcuffs";
import void Log_Killings(Critter&player,int target,int param1,int param2,string@param3,int[]@param4)from"gm";

import void ChangeCritterSpeed(Critter&cr)from"speed";
import bool FlareGunUse(Critter&cr,Item&item)from"item";                                                                                                                                                                                                                                                                                                                                                                                                                     

import void BallAttackHandling(Critter&ball,Critter&crt,uint16 WeaponPid)from"ball_init";
import void e_BallIntoInven(Critter&ball,Critter&crt,bool SetToActiveHand)from"ball_init";
import void e_ConvertBallToCrit(Critter&attacker,Item&ball,uint16 tx,uint16 ty)from"ball_init";
import void e_ConvertBallToCrit(Item&ball,Critter&crt)from"ball_init"; 

import void ApplyFlashEff(Critter&target,uint8 dist)from"flash_grenade";  

import bool ChangeWildness(uint16 x,uint16 y,int delta)from"globalmap_group"; 

import void ChangeStatus(Critter&cr,uint16 status,uint8 value,bool set)from"critter_status";
import int GetDeteriorationProcent(Item&item)from"repair"; 

import void unsafe_log_1(Critter&cr,int locX,int locY,int type,string@message,int[]@p4)from"general_unsafe";

class AttackStruct
{
	Critter@Attacker;
	Item@RealWeapon;
	uint16 WeaponPid;
	uint16 Hx;
	uint16 Hy;
	uint8 Aim;
	bool IsBurst;
	bool BloodyMess;
	bool CombatMessage;
	bool scoreUnarmed;
	int WeaponPerk;
	uint8 WeaponSubtype;
	int DmgMin;
	int DmgMax;
	int DmgType;
	int BonusDmg;
	int DmgMul;
	int DRMod;
	int DMMod;
	int DDMod;
	uint TargetId;
	bool TargetHit;
	ProtoItem@Ammo;
	uint ForceFlags;
	bool ShowHitAnimForce;
	
	AttackStruct()
	{
		@Attacker=null;
		@RealWeapon=null;
		WeaponPid=0;
		Hx=0;
		Hy=0;
		Aim=(9);
		IsBurst=false;
		BloodyMess=false;
		CombatMessage=false;
		scoreUnarmed=false;
		WeaponPerk=-1;
		WeaponSubtype=0;
		DmgMin=0;
		DmgMax=0;
		DmgType=0;
		BonusDmg=0;
		DmgMul=2;
		DRMod=0;
		DMMod=1;
		DDMod=1;
		
		TargetId=0;
		TargetHit=false;
		@Ammo=null;
		ForceFlags=0;
		ShowHitAnimForce=false;
	}
};

void CombatAttack(Critter&cr,Critter@target,ProtoItem&weapon,uint8 weaponMode,ProtoItem@ammo,uint16 hexX,uint16 hexY)
{
	if(not(@target!=null)&&hexX==0&&hexY==0)
	return;
	
	uint yyy=0;            
	
	uint8 use=((weaponMode)&0xF);
	uint8 aim=(((weaponMode)>>4)&0xF);
	Item@realWeapon=cr.GetItem(0,(1));
	Map@map=cr.GetMap();
	int wpnMaxDist=((use)==0?weapon.Weapon_MaxDist_0:((use)==1?weapon.Weapon_MaxDist_1:((use)==2?weapon.Weapon_MaxDist_2:0)));
	int skillNum=((use)==0?weapon.Weapon_Skill_0:((use)==1?weapon.Weapon_Skill_1:((use)==2?weapon.Weapon_Skill_2:0)));
	
	if(weapon.ProtoId==(1037)&&weaponMode==1)
	{
		FlareGunUse(cr,realWeapon);
		return;
	}
	
	if(skillNum==(205))
	wpnMaxDist=(((wpnMaxDist)<(3*(((int(10))<((cr.Stat[(0)]+2*cr.Perk[(336)])))?(int(10)):((cr.Stat[(0)]+2*cr.Perk[(336)])))))?(wpnMaxDist):(3*(((int(10))<((cr.Stat[(0)]+2*cr.Perk[(336)])))?(int(10)):((cr.Stat[(0)]+2*cr.Perk[(336)])))));
	
	int skillVal=cr.Skill[skillNum];
	uint8 weaponSubtype=(skillNum==(200)||skillNum==(201)||skillNum==(202))?(4):((skillNum==(205))?(3):(skillNum==(204))?(2):(1));    
	
	if(cr.IsPlayer())
	{
		if(weaponSubtype==(4))
		{ 
			
			if(skillNum==(200)&&skillVal<(125))
			{
				
				skillVal+=cr.Skill[(201)]/3;
				
				skillVal+=cr.Skill[(202)]/2;
				
				if(skillVal>(125))
				{
					skillVal=(125);
				}
				
			}
			
			if(skillNum==(201)&&skillVal<(125))
			{
				
				skillVal+=cr.Skill[(200)]/3;
				
				skillVal+=cr.Skill[(202)]/3;
				
				if(skillVal>(125))
				{
					skillVal=(125);
				}
				
			}
			
			if(skillNum==(202)&&skillVal<(125))
			{
				
				skillVal+=cr.Skill[(200)]/2;
				
				skillVal+=cr.Skill[(201)]/3;
				
				if(skillVal>(125))
				{
					skillVal=(125);
				}
				
			}
		}
		else
		{
			
			if(skillNum==(203)&&skillVal<(125))
			{
				skillVal+=cr.Skill[(205)]/3;
				skillVal+=cr.Skill[(204)]/2;
				if(skillVal>(125))
				skillVal=(125);
			}
			
			if(skillNum==(204)&&skillVal<(125))
			{
				skillVal+=cr.Skill[(203)]/2;
				skillVal+=cr.Skill[(205)]/3;
				if(skillVal>(125))
				skillVal=(125);
			}
			
			if(skillNum==(205)&&skillVal<(125))
			{
				skillVal+=cr.Skill[(203)]/3;
				skillVal+=cr.Skill[(204)]/2;
				if(skillVal>(125))
				skillVal=(125);
			}
		}
	} 
	
	bool isRanged=(weaponSubtype==(3)||weaponSubtype==(4));
	bool isUnarmed=weapon.Weapon_IsUnarmed;
	bool isHthAttack=(weaponSubtype==(2)||weaponSubtype==(1));
	uint16 ammoRound=((use)==0?weapon.Weapon_Round_0:((use)==1?weapon.Weapon_Round_1:((use)==2?weapon.Weapon_Round_2:0)));
	bool wpnIsRemoved=((use)==0?weapon.Weapon_Remove_0:((use)==1?weapon.Weapon_Remove_1:((use)==2?weapon.Weapon_Remove_2:false)));
	uint16 hx=cr.HexX;
	uint16 hy=cr.HexY;
	uint16 tx=((@target!=null))?target.HexX:hexX;
	uint16 ty=((@target!=null))?target.HexY:hexY;
	uint16 weapPid=weapon.ProtoId;
	uint16 ammoPid=0;
	if((@ammo!=null))
	ammoPid=ammo.ProtoId;
	bool isBurst=(ammoRound>1);
	if(isBurst)
	aim=(9);
	int dmgType=((use)==0?weapon.Weapon_DmgType_0:((use)==1?weapon.Weapon_DmgType_1:((use)==2?weapon.Weapon_DmgType_2:0)));
	
	bool isGrenade=weaponSubtype==(3)&&(dmgType==(4)||dmgType==(6)||dmgType==(7)||dmgType==(3));
	
	bool isFlamethrower=(weapPid==(11))||(weapPid==(400))||(weapPid==(427))||
	((aim==(0)||aim==(4)||aim==(9))&&(weapPid==(94)||weapPid==(385)));
	
	bool isRocket=(ammoPid==(14))||(ammoPid==(37))||(ammoPid==(274))||(ammoPid==(1035));
	
	bool eyeDamage=cr.Damage[(502)]!=0;
	
	bool crIsPlayer=cr.IsPlayer();
	bool isHit=false;
	bool isCritical=false;
	bool hitRandomly=false;
	
	bool isSneak=false;
	bool useNormal=false;
	bool useHex=false;
	
	uint critfailFlags=0;
	int weaponPerk=weapon.Weapon_Perk;
	
	Critter@normalTarget;
	Critter@realTarget;
	
	CombatRes[]results;
	
	int acmod=0;    
	
	if(!map.IsTurnBased()&&map.IsTurnBasedAvailability())
	map.BeginTurnBased(cr); 
	
	if(cr.Mode[(510)]!=0&&!(weaponSubtype==(3)&&dmgType==(1)&&(@target!=null)&&!cr.IsSeenBy(target)))
	{
		if(!cr.IsPlayer()||cr.GetAccess()==(0))
		cr.ModeBase[(510)]=0;
		isSneak=true;
	}     
	
	cr.SetDir(GetDirection(hx,hy,tx,ty)); 
	
	if(aim==(7)&&(@cr!=null)&&(@target!=null)&&((cr.Dir+3)%6!=target.Dir||cr.Perk[(325)]==0))aim=(1); 
	
	if(aim==(0)&&!isHthAttack&&cr.Trait[(557)]!=0)skillVal*=0.5; 
	
	if((aim==(0)||cr.Param[(703)]==(3))&&(@cr!=null)&&(@target!=null)&&dmgType!=(3)&&dmgType!=(7))
	{
		int randomAim=Random(0,18);
		if(randomAim<=7)aim=(4);
		else if(randomAim<=9)aim=(3);
		else if(randomAim<=11)aim=(2);
		else if(randomAim<=13)aim=(5);
		else if(randomAim<=15)aim=(6);
		else if(randomAim<=17)aim=(1);
		else if(randomAim<=18)aim=(8);
	} 
	
	if((@target!=null))
	{
		if(cr.Timeout[(238)]==0)
		cr.StatBase[(186)]=0; 
		
		if(target.Timeout[(238)]==0)
		{
			if(target.StatBase[(12)]<(cr.StatBase[(12)]+Random(-15,15)))
			target.StatBase[(186)]=0;
			else
			target.StatBase[(186)]=1;
		} 
		
		if(target.GetProtoId()!=(490)&&weapPid!=(650))
		{
			if(cr.Timeout[(238)]<int(__TimeoutBattle))
			cr.TimeoutBase[(238)]=__FullSecond+__TimeoutBattle;
			if(target.Timeout[(238)]<int(__TimeoutBattle))
			target.TimeoutBase[(238)]=__FullSecond+__TimeoutBattle;
		}
	}
	else if(cr.Timeout[(238)]<int(__TimeoutBattle))
	cr.TimeoutBase[(238)]=__FullSecond+__TimeoutBattle; 
	
	cr.TimeoutBase[(243)]=(__FullSecond+(((((34-cr.Stat[(12)])>(3))?(34-cr.Stat[(12)]):(3)))*__TimeMultiplier));
	if((@target!=null))
	target.TimeoutBase[(243)]=(__FullSecond+(((((34-target.Stat[(12)])>(3))?(34-target.Stat[(12)]):(3)))*__TimeMultiplier));         
	
	if(!crIsPlayer)
	AI_TrySayCombatText(cr,(2)); 
	
	if((@target!=null))
	{
		if((target.GetProtoId()!=(490))&&(weapPid!=(650))&&weapPid!=(1523))
		target.EventAttacked(cr);
	}   
	
	int baseToHit=skillVal;
	if(cr.Param[(703)]==(4))cr.Say((11),"baseToHit= "+baseToHit);
	if((@target!=null)&&target.Param[(703)]==(4))target.Say((11),"baseToHit= "+baseToHit);
	if(eyeDamage)
	baseToHit-=25;
	if(!isUnarmed)
	{
		if(cr.Trait[(553)]!=0)
		baseToHit+=((((weapon.Flags)&((0x00000080)))!=0)?-40:20);
		
		int handlingStrength=cr.Stat[(0)];
		int reqStrength=weapon.Weapon_MinStrength;
		if(cr.Perk[(407)]!=0)
		handlingStrength+=3;
		if(handlingStrength<reqStrength)
		baseToHit-=(reqStrength-handlingStrength)*20;
		
		if(weaponPerk==(2))
		baseToHit+=20;
	} 
	
	AttackStruct attack;
	@attack.Attacker=cr;
	@attack.RealWeapon=realWeapon;
	attack.WeaponPid=weapon.ProtoId;
	attack.Hx=hx;
	attack.Hy=hy;
	attack.Aim=aim;
	attack.IsBurst=isBurst;
	attack.BloodyMess=cr.Trait[(558)]!=0;
	attack.CombatMessage=true;
	attack.scoreUnarmed=(weaponSubtype==(1));
	attack.WeaponPerk=(isUnarmed&&weapon.Weapon_UnarmedArmorPiercing)?(3):weaponPerk;
	attack.WeaponSubtype=weaponSubtype;
	attack.DmgMin=((use)==0?weapon.Weapon_DmgMin_0:((use)==1?weapon.Weapon_DmgMin_1:((use)==2?weapon.Weapon_DmgMin_2:0)));
	attack.DmgMax=((use)==0?weapon.Weapon_DmgMax_0:((use)==1?weapon.Weapon_DmgMax_1:((use)==2?weapon.Weapon_DmgMax_2:0)));
	attack.DmgType=dmgType;
	attack.BonusDmg=0;
	attack.DmgMul=2;
	@attack.Ammo=ammo;
	
	if(isHthAttack)
	{
		attack.DmgMax+=cr.Stat[(10)];
		attack.DmgMin+=cr.Stat[(10)];
	}
	if(weaponSubtype==(4))
	attack.BonusDmg+=cr.Perk[(305)]*2; 
	
	if((@ammo!=null))
	{
		attack.DRMod=ammo.Ammo_DRMod;
		attack.DMMod=ammo.Ammo_DmgMult;
		attack.DDMod=ammo.Ammo_DmgDiv;
		if(attack.DMMod==0)
		attack.DMMod=1;
		if(attack.DDMod==0)
		attack.DDMod=1;
	}
	
	if((@target!=null)) 
	
	attack.TargetId=target.Id; 
	
	int toHit=baseToHit;
	toHit-=isHthAttack?(GetHitAim(aim)/2):GetHitAim(aim); 
	
	int distmod1=2;
	int distmod2=0;
	
	if(weaponPerk==(1))
	distmod1=4;
	else if(weaponPerk==(5))
	{
		distmod1=5;
		distmod2=8;
	}
	
	int perception=cr.Stat[(1)];
	int dist=GetDistantion(hx,hy,(@target!=null)?target.HexX:hexX,(@target!=null)?target.HexY:hexY);
	int acc=dist;
	int accloss=(crIsPlayer?(perception-2)*distmod1:(perception*distmod1));
	int sharpshooter=2*cr.Perk[(315)];
	
	if(!isHthAttack)
	{
		if(dist<distmod2)
		acc+=distmod2;
		else
		acc-=accloss;
		if(-2*perception>acc)
		acc=-2*perception;
		acc-=sharpshooter;
		if(acc>0&&eyeDamage)
		acc*=3;
		acc*=-4;
		toHit+=acc;
		int blockers=map.GetCrittersPath(hx,hy,tx,ty,0.0f,dist,(0x01),null);
		if((@target!=null)&&!target.IsKnockout())
		blockers--;
		toHit-=10*blockers;
	}
	
	if(cr.Param[(703)]==(4))cr.Say((11),"ToHitAfterMods= "+toHit);
	if((@target!=null)&&target.Param[(703)]==(4))target.Say((11),"ToHitAfterMods= "+toHit);
	
	if((@target!=null))
	{
		acmod=target.Stat[(9)];
		if((@ammo!=null))
		acmod+=ammo.Ammo_ACMod;
		if(acmod>0)
		toHit-=acmod;
		
		if(cr.Param[(703)]==(4))cr.Say((11),"ToHitAfterAC= "+toHit);
		if((@target!=null)&&target.Param[(703)]==(4))target.Say((11),"ToHitAfterAC= "+toHit);  
		
		if((@cr!=null)&&(@target!=null)&&((cr.Dir+3)%6==target.Dir||(cr.Dir+4)%6==target.Dir||(cr.Dir+2)%6==target.Dir)&&
		(target.StatBase[(186)]>=1)&&(target.DamageBase[(503)]!=1)&&(target.DamageBase[(504)]!=1)&&
		(target.Param[(67)]<(5))&&(cr.Param[(67)]<(5))&&
		attack.DmgType!=(3)&&attack.DmgType!=(7))
		{
			if(!target.IsDead()||!target.IsKnockout())
			{
				uint8 dist=GetDistantion(cr.HexX,cr.HexY,target.HexX,target.HexY);
				Item@hand1=target.GetItem(0,(1));
				Item@hand2=target.GetItem(0,(2));
				Item@hand3=target.GetItem(0,(3));
				
				int itemweigh1=0;
				int itemweigh2=0;
				int itemweigh3=0;
				int aimpenalty=0;
				
				if((@hand1!=null))
				itemweigh1=hand1.Proto.Weight;
				if((@hand2!=null))
				itemweigh2=hand2.Proto.Weight;
				if((@hand3!=null))
				itemweigh3=hand3.Proto.Weight; 
				
				if(dist>4&&cr.Stat[(186)]==2)
				cr.StatBase[(186)]=0;
				if(aim==(1)&&cr.Stat[(186)]!=2)
				aimpenalty=50;
				
				uint16 h_x=target.HexX,h_y=target.HexY;
				map.MoveHexByDir(h_x,h_y,(cr.Dir+3)%6,1);
				Critter@poor_guy=map.GetCritter(h_x,h_y);
				
				if(!(map.IsHexPassed(h_x,h_y))&&dist>=2&&(Random(0,80)+aimpenalty-skillVal-(itemweigh1+itemweigh2+itemweigh3)*0.001>=0))
				{
					target.Say((6),"");
					skillVal=skillVal-Random(100,200+aimpenalty-(itemweigh1+itemweigh2+itemweigh3)*0.001);
				}
				
				if((@poor_guy!=null)&&(!poor_guy.IsDead()||!poor_guy.IsKnockout())&&dist>=2&&(Random(0,80)+aimpenalty-skillVal-(itemweigh1+itemweigh2+itemweigh3)*0.001>=0))
				{
					target.Say((6)," ");
					skillVal=skillVal-Random(100,200+aimpenalty-(itemweigh1+itemweigh2+itemweigh3)*0.001);
				}
				
				if(target.Perk[(394)]!=0&&dist>=2&&(Random(1,100)+aimpenalty+(target.Skill[(203)]-skillVal)-(itemweigh1+itemweigh2+itemweigh3)*0.001>=50))
				{
					target.Say((6),"");
					skillVal=skillVal-Random(100,120+aimpenalty+target.Skill[(203)]*0.2-(itemweigh1+itemweigh2+itemweigh3)*0.001);
					
					if(Random(0,1)==0)
					{
						target.StatBase[(186)]=0;
					}
					if(Random(0,1)==0)
					{
						aim=(2);
					}
					else
					{
						aim=(3);
					}
				}
				
				if((dist<=1||isHthAttack)&&(Random(1,200)-(cr.Stat[(6)]-5)*5+aimpenalty*2-skillVal+target.Skill[(204)]+target.Skill[(203)]-(itemweigh1+itemweigh2)*0.01>=100))
				{
					target.Say((6),"");
					skillVal=skillVal-Random(30,50+aimpenalty+target.Skill[(203)]*0.2-(itemweigh1+itemweigh2+itemweigh3)*0.001);
					
					if(isHthAttack)
					attack.DmgMul-=0.5;
					if(Random(0,2)==0||((aim==(1)||aim==(7))&&Random(0,1)==0))
					{
						target.StatBase[(186)]=2;
						target.Say((6)," ");
					}
					
					if(Random(0,1)==0)
					{
						aim=(2);
					}
					else
					{
						aim=(3);
					}
				}
			}
		} 
		
		if((@target!=null)&&target.IsRuning)
		{
			if((cr.Dir+3)%6==target.Dir)
			toHit+=20;
			else if((cr.Dir)%6!=target.Dir)
			{
				toHit-=acmod/2;
				if(aim==(1))
				toHit-=acmod/2;
			}
		}
		
		if(aim==(1))
		toHit*=0.5;
		else if(aim==(2)||aim==(3)||aim==(5)||aim==(6))
		toHit*=0.7; 
		
		if(cr.Stat[(186)]==2)
		{
			cr.StatBase[(186)]=0;
			toHit+=30;
		}
		
		if(Random(0,2)<1&&cr.Stat[(186)]==1)
		cr.StatBase[(186)]=0;
		
		if(cr.GetTimeEvents((10),null,null,null)>0)cr.EraseTimeEvents((10)); 
		
		if((@target!=null))
		{
			if(target.IsKnockout())
			toHit+=40;
			if(target.GetMultihex()>0)
			toHit+=15;
		}
	}
	
	if(cr.Param[(703)]==(4))cr.Say((11),"ToHitAfterErlTweaks= "+toHit);
	if((@target!=null)&&target.Param[(703)]==(4))target.Say((11),"ToHitAfterErlTweaks= "+toHit);
	
	toHit+=(cr.Stat[(6)]-5)*3;
	toHit=(((toHit)>(95))?(95):(((toHit)<(0))?(0):(toHit))); 
	
	bool psiShield=false;
	if((@target!=null)){
		psiShield=(target.GetTimeEvents((59),null,null,null)>0);
		if(dmgType==(1)&&psiShield){
			int psiRoll=Random(0,99);
			int psiShieldChance=(target.Skill[(214)]/4)+target.Stat[(6)]+target.Stat[(4)];
			psiShieldChance=(((psiShieldChance)>(95))?(95):(((psiShieldChance)<(5))?(5):(psiShieldChance)));
			if(psiRoll<psiShieldChance){
				target.Say((5)," ");
				toHit=0;
			}
		}
	}
	
	int margin=toHit-Random(1,100);
	
	if(cr.Param[(703)]==(4))cr.Say((11),"ToHitRoll= "+margin);
	if((@target!=null)&&target.Param[(703)]==(4))target.Say((11),"ToHitRoll= "+margin);
	
	if(margin<0)
	{
		
		if(cr.Mode[(527)]==0)
		{
			isCritical=((-margin)/10>=Random(1,100));    
			
			if(isCritical)
			{
				int roll=Random(1,100)-5*(cr.Stat[(6)]-5);
				if(roll<=20)
				roll=0;
				else if(roll<=50)
				roll=1;
				else if(roll<=75)
				roll=2;
				else if(roll<=95)
				roll=3;
				else
				roll=4;
				
				critfailFlags=CriticalFailureTable[5*weapon.Weapon_CriticalFailture+roll];
				if(critfailFlags==0)
				isCritical=false;
				hitRandomly=(((critfailFlags)&((0x00100000)))!=0);
			}
		}
	}
	else
	{
		isHit=true;
		
		uint cri_roll=Random(1,100);
		uint cri_chance=cr.Stat[(14)]+margin*0.1;
		
		if(cr.Param[(703)]==(4))cr.Say((11),"Crit_R= "+cri_roll+" , Crit_C= "+cri_chance);
		if((@target!=null)&&target.Param[(703)]==(4))target.Say((11),"Crit_R= "+cri_roll+" , Crit_C= "+cri_chance);
		
		isCritical=(cri_roll<=cri_chance);      
		
	}
	
	if(hitRandomly&&(@target!=null))
	{
		Critter@randomTarget=ChooseRandomTarget(map,cr,target,wpnMaxDist);
		if(@randomTarget!=null)
		{
			@realTarget=randomTarget;
			tx=realTarget.HexX;
			ty=realTarget.HexY;
			attack.Aim=(9);
			realTarget.ModeBase[(510)]=0;
			NotifyOops(cr,target,realTarget,results);
		}
	}
	else
	@realTarget=target;   
	
	bool isArm=(attack.WeaponPid==1000)||(attack.WeaponPid==1001)||(attack.WeaponPid==1002)||(attack.WeaponPid==1003)||(attack.WeaponPid==1010)||(attack.WeaponPid==1011)||(attack.WeaponPid==1012);
	if((@target!=null))
	{
		if((target.GetProtoId()==(490))&&(isArm))
		{
			e_BallIntoInven(target,cr,true);
			return;
		}
	}     
	
	cr.Action((6),(((!isHit&&isCritical&&!hitRandomly)?1:0)<<8)|(aim<<4)|use,realWeapon);  
	
	bool changedTarget=(hitRandomly&&(@realTarget!=null)); 
	
	if(!isHit&&isCritical&&(!hitRandomly||@realTarget==null))
	{
		CriticalFailure(cr,weapon,use,ammo,critfailFlags,results);
		return;
	} 
	
	bool criticalHit=isHit&&isCritical;
	
	if(isHthAttack)
	{
		if(isHit)
		{
			int crDir=cr.Dir;
			int tDir=realTarget.Dir;
			if(isSneak&&cr.Perk[(326)]!=0&&(crDir==tDir||((crDir+1)%6)==tDir||((crDir+5)%6)==tDir))
			attack.DmgMul*=2;
			ApplyDamage(attack,realTarget,1,criticalHit,true,results);
		}
		else
		{
			if(changedTarget)
			ApplyDamage(attack,realTarget,1,false,false,results);
			else
			NotifyMiss(cr,results);
		}
	}
	else if((weaponSubtype==(4))&&!isBurst&&!isRocket&&!isFlamethrower)
	{  
		
		if(isHit||changedTarget)
		ApplyDamage(attack,realTarget,1,criticalHit,!changedTarget,results);
		else
		{
			Critter@[]critsLine;
			attack.Aim=(9);
			baseToHit+=GetHitAim(aim);
			map.GetCrittersPath(hx,hy,tx,ty,0.0f,wpnMaxDist,(0x03),critsLine);
			int bl=0;
			bool anyHit=false;
			for(int i=0,j=critsLine.length();(i<j)&&!anyHit;i++)
			{
				if(critsLine[i].Id==realTarget.Id)
				{
					bl++;
					continue;
				} 
				
				dist=GetDistantion(hx,hy,critsLine[i].HexX,critsLine[i].HexY);
				acc=dist;
				toHit=baseToHit;
				if(dist<distmod2)
				acc+=distmod2;
				else
				acc-=accloss;
				if(-2*perception>acc)
				acc=-2*perception;
				acc-=sharpshooter;
				if(acc>0&&eyeDamage)
				acc*=3;
				acc*=-4;
				toHit+=acc;
				acmod=critsLine[i].Stat[(9)];
				if((@ammo!=null))
				acmod+=ammo.Ammo_ACMod;
				if(acmod>0)
				toHit-=acmod;
				toHit-=10*bl;
				if(critsLine[i].IsKnockout())
				toHit+=40;
				else
				bl++;
				if(critsLine[i].GetMultihex()>0)
				toHit+=15;
				toHit=(((toHit)>(95))?(95):(((toHit)<(5))?(5):(toHit)));
				toHit/=3;
				if(Random(1,100)<=toHit)
				{
					NotifyOops(cr,target,critsLine[i],results);
					@normalTarget=critsLine[i];
					useNormal=true;
					ApplyDamage(attack,normalTarget,1,false,false,results);
					anyHit=true;
				}
			}
			if(!anyHit)
			NotifyMiss(cr,results);
		}
		
	}
	else if(isFlamethrower)
	{
		
		if(changedTarget)
		{
			dist=GetDistantion(hx,hy,tx,ty);
			acc=dist;
			toHit=baseToHit;
			if(dist<distmod2)
			acc+=distmod2;
			else
			acc-=accloss;
			if(-2*perception>acc)
			acc=-2*perception;
			acc-=sharpshooter;
			if(acc>0&&eyeDamage)
			acc*=3;
			acc*=-4;
			toHit+=acc;
			acmod=realTarget.Stat[(9)];
			if((@ammo!=null))
			acmod+=ammo.Ammo_ACMod;
			if(acmod>0)
			toHit-=acmod;
			if(realTarget.IsKnockout())
			toHit+=40;
			if(realTarget.GetMultihex()>0)
			toHit+=15;
			int blockers=map.GetCrittersPath(hx,hy,tx,ty,0.0f,dist,(0x01),null);
			if(!realTarget.IsKnockout())
			blockers--;
			toHit-=10*blockers;
			toHit=(((toHit)>(95))?(95):(((toHit)<(5))?(5):(toHit)));
		} 
		
		if(criticalHit)
		toHit+=20; 
		
		Critter@[]critsHit(0);
		uint[]critsHitBullets(0);
		int len_=0;
		
		if(Random(1,100)<=toHit)
		{
			critsHit.resize(1);
			@critsHit[0]=realTarget;
			critsHitBullets.resize(1);
			critsHitBullets[0]+=1;
			len_++;
		}
		
		Critter@[]lineCentral;
		map.GetCrittersPath(hx,hy,tx,ty,0.0f,wpnMaxDist,(0x03),lineCentral);
		int bl;
		
		bool threeLines=(GetDistantion(hx,hy,lineCentral[0].HexX,lineCentral[0].HexY)>1); 
		
		for(int lineCount=0,lineMax=(threeLines?1:3);lineCount<lineMax;lineCount++)
		{ 
			
			bl=0;
			for(int i=0,j=lineCentral.length();i<j;i++)
			{
				
				toHit=baseToHit-10*bl;
				dist=GetDistantion(hx,hy,lineCentral[i].HexX,lineCentral[i].HexY);
				acc=dist;
				if(dist<distmod2)
				acc+=distmod2;
				else
				acc-=accloss;
				if(-2*perception>acc)
				acc=-2*perception;
				acc-=sharpshooter;
				if(acc>0&&eyeDamage)
				acc*=3;
				acc*=-4;
				toHit+=acc;
				acmod=lineCentral[i].Stat[(9)];
				if((@ammo!=null))
				acmod+=ammo.Ammo_ACMod;
				if(acmod>0)
				toHit-=acmod;
				if(lineCentral[i].IsKnockout())
				toHit+=40;
				else
				bl++;
				if(lineCentral[i].GetMultihex()>0)
				toHit+=15;
				toHit=(((toHit)>(95))?(95):(((toHit)<(5))?(5):(toHit)));
				if(Random(1,100)<=toHit)
				{
					int crIndex=FindCritterInArray(critsHit,lineCentral[i]);
					if(crIndex==-1)
					{
						critsHit.resize(len_+1);
						@critsHit[len_]=lineCentral[i];
						critsHitBullets.resize(len_+1);
						crIndex=len_;
						len_++;
					}
					critsHitBullets[crIndex]+=1;
				}
			}
			
		}
		
		if(threeLines)
		{  
			
			uint8 leftDir=GetOffsetDir(hx,hy,tx,ty,89.0f);
			uint16 sx=hx;
			uint16 sy=hy;
			uint16 ex=tx;
			uint16 ey=ty;
			
			map.MoveHexByDir(sx,sy,leftDir,1);
			map.MoveHexByDir(ex,ey,leftDir,1);
			
			Critter@[]lineLeft;
			map.GetCrittersPath(sx,sy,ex,ey,0.0f,wpnMaxDist-1,(0x03),lineLeft);
			int leftStart=0;
			int leftLen=lineLeft.length();
			while((leftStart<leftLen)&&(GetDistantion(hx,hy,lineLeft[leftStart].HexX,lineLeft[leftStart].HexY))<3)
			leftStart++;
			
			for(int i=leftStart,j=leftLen;i<j;i++)
			{
				
				dist=GetDistantion(hx,hy,lineLeft[i].HexX,lineLeft[i].HexY);
				bl=map.GetCrittersPath(hx,hy,lineLeft[i].HexX,lineLeft[i].HexY,0.0f,dist,(0x01),null)-1;
				toHit=baseToHit-10*bl;
				acc=dist;
				if(dist<distmod2)
				acc+=distmod2;
				else
				acc-=accloss;
				if(-2*perception>acc)
				acc=-2*perception;
				acc-=sharpshooter;
				if(acc>0&&eyeDamage)
				acc*=3;
				acc*=-4;
				toHit+=acc;
				acmod=lineLeft[i].Stat[(9)];
				if((@ammo!=null))
				acmod+=ammo.Ammo_ACMod;
				if(acmod>0)
				toHit-=acmod;
				if(lineLeft[i].IsKnockout())
				toHit+=40;
				if(lineLeft[i].GetMultihex()>0)
				toHit+=15;
				toHit=(((toHit)>(95))?(95):(((toHit)<(5))?(5):(toHit)));
				if(Random(1,100)<=toHit)
				{
					int crIndex=FindCritterInArray(critsHit,lineLeft[i]);
					if(crIndex==-1)
					{
						critsHit.resize(len_+1);
						@critsHit[len_]=lineLeft[i];
						critsHitBullets.resize(len_+1);
						crIndex=len_;
						len_++;
					}
					critsHitBullets[crIndex]+=1;
				}
			}
			
			uint8 rightDir=GetOffsetDir(hx,hy,tx,ty,-89.0f);
			sx=hx;
			sy=hy;
			ex=tx;
			ey=ty;
			
			map.MoveHexByDir(sx,sy,rightDir,1);
			map.MoveHexByDir(ex,ey,rightDir,1);
			
			Critter@[]lineRight;
			map.GetCrittersPath(sx,sy,ex,ey,0.0f,wpnMaxDist-1,(0x03),lineRight);
			int rightStart=0;
			int rightLen=lineRight.length();
			while((rightStart<rightLen)&&(GetDistantion(hx,hy,lineRight[rightStart].HexX,lineRight[rightStart].HexY))<3)
			rightStart++;
			for(int i=rightStart,j=rightLen;i<j;i++)
			{
				
				dist=GetDistantion(hx,hy,lineRight[i].HexX,lineRight[i].HexY);
				bl=map.GetCrittersPath(hx,hy,lineRight[i].HexX,lineRight[i].HexY,0.0f,dist,(0x01),null)-1;
				toHit=baseToHit-10*bl;
				acc=dist;
				if(dist<distmod2)
				acc+=distmod2;
				else
				acc-=accloss;
				if(-2*perception>acc)
				acc=-2*perception;
				acc-=sharpshooter;
				if(acc>0&&eyeDamage)
				acc*=3;
				acc*=-4;
				toHit+=acc;
				acmod=lineRight[i].Stat[(9)];
				if((@ammo!=null))
				acmod+=ammo.Ammo_ACMod;
				if(acmod>0)
				toHit-=acmod;
				if(lineRight[i].IsKnockout())
				toHit+=40;
				if(lineRight[i].GetMultihex()>0)
				toHit+=15;
				toHit=(((toHit)>(95))?(95):(((toHit)<(5))?(5):(toHit)));
				if(Random(1,100)<=toHit)
				{
					int crIndex=FindCritterInArray(critsHit,lineRight[i]);
					if(crIndex==-1)
					{
						critsHit.resize(len_+1);
						@critsHit[len_]=lineRight[i];
						critsHitBullets.resize(len_+1);
						crIndex=len_;
						len_++;
					}
					critsHitBullets[crIndex]+=1;
				}
			}
		}
		
		for(int i=0,j=len_;i<j;i++)
		ApplyDamage(attack,critsHit[i],1,(realTarget.Id==critsHit[i].Id)&&criticalHit,(cr.IsPlayer()&&!changedTarget)||(cr.IsNpc()&&critsHit[i].Id==target.Id),results);
		
		if(!changedTarget&&!attack.TargetHit)
		NotifyMiss(cr,results);
	}
	else if((weaponSubtype==(4))&&isBurst)
	{
		
		if(changedTarget)
		{
			dist=GetDistantion(hx,hy,tx,ty);
			acc=dist;
			toHit=baseToHit;
			if(dist<distmod2)
			acc+=distmod2;
			else
			acc-=accloss;
			if(-2*perception>acc)
			acc=-2*perception;
			acc-=sharpshooter;
			if(acc>0&&eyeDamage)
			acc*=3;
			acc*=-4;
			toHit+=acc;
			acmod=realTarget.Stat[(9)];
			if((@ammo!=null))
			acmod+=ammo.Ammo_ACMod;
			if(acmod>0)
			toHit-=acmod;
			if(realTarget.IsKnockout())
			toHit+=40;
			if(realTarget.GetMultihex()>0)
			toHit+=15;
			int blockers=map.GetCrittersPath(hx,hy,tx,ty,0.0f,dist,(0x01),null);
			if(!realTarget.IsKnockout())
			blockers--;
			toHit-=10*blockers;
			toHit=(((toHit)>(95))?(95):(((toHit)<(5))?(5):(toHit)));
		} 
		
		if(criticalHit)
		toHit+=20; 
		
		int rounds=ammoRound;
		if((@realWeapon!=null)&&realWeapon.AmmoCount<rounds)
		rounds=realWeapon.AmmoCount;
		Critter@[]critsHit(0);
		uint[]critsHitBullets(0);
		
		int len_=0;
		int volleyRounds=((((rounds/6))>(1))?((rounds/6)):(1));
		
		int curRounds=0;
		for(int i=0;i<volleyRounds;i++)
		{
			if((i+1)*Random(1,100)<=toHit)
			curRounds++;
		}
		if(curRounds!=0)
		{
			critsHit.resize(1);
			critsHitBullets.resize(1);
			@critsHit[0]=realTarget;
			critsHitBullets[0]=curRounds;
			len_++;
		}
		volleyRounds-=curRounds;
		
		Critter@[]lineCentral;
		map.GetCrittersPath(hx,hy,tx,ty,0.0f,wpnMaxDist,(0x03),lineCentral);
		
		int bl=0;
		curRounds=0;
		for(int i=0,j=lineCentral.length();(i<j)&&(volleyRounds>0);i++)
		{
			if(lineCentral[i].Id==realTarget.Id)
			{
				bl++;
				continue;
			}
			
			toHit=baseToHit-10*bl;
			dist=GetDistantion(hx,hy,lineCentral[i].HexX,lineCentral[i].HexY);
			acc=dist;
			if(dist<distmod2)
			acc+=distmod2;
			else
			acc-=accloss;
			if(-2*perception>acc)
			acc=-2*perception;
			acc-=sharpshooter;
			if(acc>0&&eyeDamage)
			acc*=3;
			acc*=-4;
			toHit+=acc;
			acmod=lineCentral[i].Stat[(9)];
			if((@ammo!=null))
			acmod+=ammo.Ammo_ACMod;
			if(acmod>0)
			toHit-=acmod;
			toHit=(((toHit)>(95))?(95):(((toHit)<(5))?(5):(toHit)));
			if(lineCentral[i].IsKnockout())
			toHit+=40;
			else
			bl++;
			if(lineCentral[i].GetMultihex()>0)
			toHit+=15;
			for(curRounds=0;curRounds<volleyRounds;)
			{
				if((curRounds+1)*Random(1,100)<=toHit)
				curRounds++;
				else
				break;
			}
			volleyRounds-=curRounds;
			if(curRounds>0)
			{
				int crIndex=FindCritterInArray(critsHit,lineCentral[i]);
				if(crIndex==-1)
				{
					critsHit.resize(len_+1);
					@critsHit[len_]=lineCentral[i];
					critsHitBullets.resize(len_+1);
					critsHitBullets[len_]=0;
					crIndex=len_;
					len_++;
				}
				critsHitBullets[crIndex]+=curRounds;
			}
		} 
		
		bool threeLines=(GetDistantion(hx,hy,lineCentral[0].HexX,lineCentral[0].HexY)>1)&&(ammoRound>3);  
		
		for(int lineCount=0,lineMax=(threeLines?1:3);lineCount<lineMax;lineCount++)
		{ 
			
			if(lineCount==0)
			{
				volleyRounds=rounds-(((rounds+1)/3)+(rounds/3));
				volleyRounds-=(((rounds/6)>(1))?(rounds/6):(1));
			}
			else
			{
				if(lineCount==1)
				volleyRounds=(rounds+1)/3;
				else
				volleyRounds=rounds/3;
			}
			
			if(volleyRounds==0)
			continue; 
			
			bl=0;
			for(int i=0,j=lineCentral.length();(i<j)&&(volleyRounds>0);i++)
			{
				
				toHit=baseToHit-10*bl;
				dist=GetDistantion(hx,hy,lineCentral[i].HexX,lineCentral[i].HexY);
				acc=dist;
				if(dist<distmod2)
				acc+=distmod2;
				else
				acc-=accloss;
				if(-2*perception>acc)
				acc=-2*perception;
				acc-=sharpshooter;
				if(acc>0&&eyeDamage)
				acc*=3;
				acc*=-4;
				toHit+=acc;
				acmod=lineCentral[i].Stat[(9)];
				if((@ammo!=null))
				acmod+=ammo.Ammo_ACMod;
				if(acmod>0)
				toHit-=acmod;
				if(lineCentral[i].IsKnockout())
				toHit+=40;
				if(lineCentral[i].GetMultihex()>0)
				toHit+=15;
				toHit=(((toHit)>(95))?(95):(((toHit)<(5))?(5):(toHit)));
				bl++;
				for(curRounds=0;curRounds<volleyRounds;)
				{
					if((curRounds+1)*Random(1,100)<=toHit)
					curRounds++;
					else
					break;
				}
				volleyRounds-=curRounds;
				if(curRounds>0)
				{
					int crIndex=FindCritterInArray(critsHit,lineCentral[i]);
					if(crIndex==-1)
					{
						critsHit.resize(len_+1);
						@critsHit[len_]=lineCentral[i];
						critsHitBullets.resize(len_+1);
						critsHitBullets[len_]=0;
						crIndex=len_;
						len_++;
					}
					critsHitBullets[crIndex]+=curRounds;
				}
			}
			
		}
		
		if(threeLines)
		{
			
			volleyRounds=(rounds+1)/3;
			
			if(volleyRounds>0)
			{
				uint8 leftDir=GetOffsetDir(hx,hy,tx,ty,89.0f);
				uint16 sx=hx;
				uint16 sy=hy;
				uint16 ex=tx;
				uint16 ey=ty;
				
				map.MoveHexByDir(sx,sy,leftDir,1);
				map.MoveHexByDir(ex,ey,leftDir,1);
				
				Critter@[]lineLeft;
				map.GetCrittersPath(sx,sy,ex,ey,0.0f,wpnMaxDist-1,(0x03),lineLeft);
				int leftStart=0;
				int leftLen=lineLeft.length();
				while((leftStart<leftLen)&&(GetDistantion(hx,hy,lineLeft[leftStart].HexX,lineLeft[leftStart].HexY))<3)
				leftStart++;
				
				for(int i=leftStart,j=leftLen;(i<j)&&(volleyRounds>0);i++)
				{
					
					dist=GetDistantion(hx,hy,lineLeft[i].HexX,lineLeft[i].HexY);
					bl=map.GetCrittersPath(hx,hy,lineLeft[i].HexX,lineLeft[i].HexY,0.0f,dist,(0x01),null)-1;
					toHit=baseToHit-10*bl;
					acc=dist;
					if(dist<distmod2)
					acc+=distmod2;
					else
					acc-=accloss;
					if(-2*perception>acc)
					acc=-2*perception;
					acc-=sharpshooter;
					if(acc>0&&eyeDamage)
					acc*=3;
					acc*=-4;
					toHit+=acc;
					acmod=lineLeft[i].Stat[(9)];
					if((@ammo!=null))
					acmod+=ammo.Ammo_ACMod;
					if(acmod>0)
					toHit-=acmod;
					if(lineLeft[i].IsKnockout())
					toHit+=40;
					if(lineLeft[i].GetMultihex()>0)
					toHit+=15;
					toHit=(((toHit)>(95))?(95):(((toHit)<(5))?(5):(toHit)));
					for(curRounds=0;curRounds<volleyRounds;)
					{
						if((curRounds+1)*Random(1,100)<=toHit)
						curRounds++;
						else
						break;
					}
					volleyRounds-=curRounds;
					if(curRounds>0)
					{
						int crIndex=FindCritterInArray(critsHit,lineLeft[i]);
						if(crIndex==-1)
						{
							critsHit.resize(len_+1);
							@critsHit[len_]=lineLeft[i];
							critsHitBullets.resize(len_+1);
							critsHitBullets[len_]=0;
							crIndex=len_;
							len_++;
						}
						critsHitBullets[crIndex]+=curRounds;
					}
				}
			}  
			
			volleyRounds=(rounds)/3;
			
			if(volleyRounds>0)
			{
				uint8 rightDir=GetOffsetDir(hx,hy,tx,ty,-89.0f);
				
				uint16 sx=hx;
				uint16 sy=hy;
				uint16 ex=tx;
				uint16 ey=ty;
				
				map.MoveHexByDir(sx,sy,rightDir,1);
				map.MoveHexByDir(ex,ey,rightDir,1);
				
				Critter@[]lineRight;
				map.GetCrittersPath(sx,sy,ex,ey,0.0f,wpnMaxDist-1,(0x03),lineRight);
				int rightStart=0;
				int rightLen=lineRight.length();
				while((rightStart<rightLen)&&(GetDistantion(hx,hy,lineRight[rightStart].HexX,lineRight[rightStart].HexY))<3)
				rightStart++;
				for(int i=rightStart,j=rightLen;(i<j)&&(volleyRounds>0);i++)
				{
					
					dist=GetDistantion(hx,hy,lineRight[i].HexX,lineRight[i].HexY);
					bl=map.GetCrittersPath(hx,hy,lineRight[i].HexX,lineRight[i].HexY,0.0f,dist,(0x01),null)-1;
					toHit=baseToHit-10*bl;
					acc=dist;
					if(dist<distmod2)
					acc+=distmod2;
					else
					acc-=accloss;
					if(-2*perception>acc)
					acc=-2*perception;
					acc-=sharpshooter;
					if(acc>0&&eyeDamage)
					acc*=3;
					acc*=-4;
					toHit+=acc;
					acmod=lineRight[i].Stat[(9)];
					if((@ammo!=null))
					acmod+=ammo.Ammo_ACMod;
					if(acmod>0)
					toHit-=acmod;
					if(lineRight[i].IsKnockout())
					toHit+=40;
					if(lineRight[i].GetMultihex()>0)
					toHit+=15;
					toHit=(((toHit)>(95))?(95):(((toHit)<(5))?(5):(toHit)));
					for(curRounds=0;curRounds<volleyRounds;)
					{
						if((curRounds+1)*Random(1,100)<=toHit)
						curRounds++;
						else
						break;
					}
					volleyRounds-=curRounds;
					if(curRounds>0)
					{
						int crIndex=FindCritterInArray(critsHit,lineRight[i]);
						if(crIndex==-1)
						{
							critsHit.resize(len_+1);
							@critsHit[len_]=lineRight[i];
							critsHitBullets.resize(len_+1);
							critsHitBullets[len_]=0;
							crIndex=len_;
							len_++;
						}
						critsHitBullets[crIndex]+=curRounds;
					}
				}
			}
		}
		
		for(int i=0,j=len_;i<j;i++)
		ApplyDamage(attack,critsHit[i],critsHitBullets[i],(realTarget.Id==critsHit[i].Id)&&criticalHit,(cr.IsPlayer()&&!changedTarget)||(cr.IsNpc()&&critsHit[i].Id==target.Id),results);
		
		if(!changedTarget&&!attack.TargetHit)
		NotifyMiss(cr,results);
	}
	else if(isRocket||(weaponSubtype==(3)))
	{
		bool exploding=isRocket||isGrenade;
		
		if(isHit||changedTarget)
		{
			if(exploding)
			CommenceExplosion(attack,map,tx,ty,realTarget,weapPid,criticalHit,(@realTarget!=null)?realTarget.Id:0,isRocket,results);
			else if((@realTarget!=null))
			ApplyDamage(attack,realTarget,1,criticalHit,!changedTarget,results);
		}
		else
		{
			
			attack.Aim=(9);
			baseToHit+=GetHitAim(aim);
			
			if(weaponSubtype==(3))
			sharpshooter=0;
			uint16 bx=0;
			uint16 by=0;
			uint16 pbx=0;
			uint16 pby=0; 
			
			Critter@[]critsLine;
			map.GetCrittersPath(hx,hy,tx,ty,0.0f,wpnMaxDist,(0x03),critsLine,pbx,pby,bx,by);
			
			int bl=0;
			bool anyHit=false;
			for(int i=0,j=critsLine.length();(i<j)&&!anyHit;i++)
			{
				if((@realTarget!=null)&&critsLine[i].Id==realTarget.Id)
				{
					bl++;
					continue;
				}
				
				dist=GetDistantion(hx,hy,critsLine[i].HexX,critsLine[i].HexY);
				acc=dist;
				toHit=baseToHit;
				if(dist<distmod2)
				acc+=distmod2;
				else
				acc-=accloss;
				if(-2*perception>acc)
				acc=-2*perception;
				acc-=sharpshooter;
				if(acc>0&&eyeDamage)
				acc*=3;
				acc*=-4;
				toHit+=acc;
				acmod=critsLine[i].Stat[(9)];
				if((@ammo!=null))
				acmod+=ammo.Ammo_ACMod;
				if(acmod>0)
				toHit-=acmod;
				toHit-=10*bl;
				if(critsLine[i].IsKnockout())
				toHit+=40;
				else
				bl++;
				if(critsLine[i].GetMultihex()>0)
				toHit+=15;
				toHit=(((toHit)>(95))?(95):(((toHit)<(5))?(5):(toHit)));
				toHit/=3;
				if(Random(1,100)<=toHit)
				{
					tx=critsLine[i].HexX;
					ty=critsLine[i].HexY;
					@normalTarget=critsLine[i];
					anyHit=true;
				}
			}
			
			if(anyHit)
			{
				NotifyOops(cr,target,normalTarget,results);
				useNormal=true;
				if(weapPid!=(650))
				{
					if(exploding)
					CommenceExplosion(attack,map,tx,ty,normalTarget,weapPid,false,(@realTarget!=null)?realTarget.Id:0,isRocket,results);
					else
					ApplyDamage(attack,normalTarget,1,false,false,results);
				}
			}
			else
			{
				useHex=true;
				NotifyMiss(cr,results);
				if(isGrenade||weapPid==(650))
				{
					
					tx=(@realTarget!=null)?realTarget.HexX:hexX;
					ty=(@realTarget!=null)?realTarget.HexY:hexY;
					
					int newdist=GetDistantion(hx,hy,tx,ty)+1;
					map.MoveHexByDir(tx,ty,Random(0,5),Random(1,newdist/2));
					newdist=GetDistantion(hx,hy,tx,ty);
					map.GetCrittersPath(hx,hy,tx,ty,0.0f,newdist,(0x01),null,tx,ty,bx,by);
				}
				else
				{
					if(isRocket)
					{
						tx=bx;
						ty=by;
					}
					else
					{
						tx=pbx;
						ty=pby;
					}
				}
				
				if(exploding)
				CommenceExplosion(attack,map,tx,ty,null,weapPid,false,(@realTarget!=null)?realTarget.Id:0,isRocket,results);
				
			}
		}
		
		if(weapPid==(650))
		{
			e_ConvertBallToCrit(cr,realWeapon,tx,ty);
			runTree(results,0);
			return;
		}     
		
	}
	else
	cr.Say((11),"Combat error: weapon PID="+weapPid+" not handled, please send bug report.");  
	
	runTree(results,0);   
	
	if(((use)==0?weapon.Weapon_Effect_0:((use)==1?weapon.Weapon_Effect_1:((use)==2?weapon.Weapon_Effect_2:0)))!=0)
	{
		if(useHex||not(@realTarget!=null))
		map.RunFlyEffect(((use)==0?weapon.Weapon_Effect_0:((use)==1?weapon.Weapon_Effect_1:((use)==2?weapon.Weapon_Effect_2:0))),cr,null,hx,hy,tx,ty);
		else
		map.RunFlyEffect(((use)==0?weapon.Weapon_Effect_0:((use)==1?weapon.Weapon_Effect_1:((use)==2?weapon.Weapon_Effect_2:0))),cr,(useNormal?normalTarget:realTarget),hx,hy,tx,ty);
	}
	
	if(ammoRound>0&&(@realWeapon!=null)&&cr.Mode[(522)]==0)
	{
		if(realWeapon.AmmoCount<=ammoRound)
		realWeapon.AmmoCount=0;
		else
		realWeapon.AmmoCount-=ammoRound;
		realWeapon.Update();
	}
	
	if((@realWeapon!=null))
	{
		if(realWeapon.IsDeteriorable()&&crIsPlayer)
		{
			if(realWeapon.GetProtoId()!=(595)&&realWeapon.GetProtoId()!=(596))
			{ 
				
				int wearCount=Random(50,100)-(cr.Stat[(6)]-5)*5;
				if(attack.WeaponPid==(1402)||attack.WeaponPid==(1408)||attack.WeaponPid==(1410)||attack.WeaponPid==(1412)||attack.WeaponPid==(1422))
				wearCount+=Random(50,150);
				if(((@attack.Ammo!=null)&&(@attack.Attacker!=null)&&attack.Ammo.ProtoId==(1430))||((@attack.Ammo!=null)&&(@attack.Attacker!=null)&&attack.Ammo.ProtoId==(1432))||((@attack.Ammo!=null)&&(@attack.Attacker!=null)&&attack.Ammo.ProtoId==(1433))||((@attack.Ammo!=null)&&(@attack.Attacker!=null)&&attack.Ammo.ProtoId==(1434)))
				wearCount+=Random(10,20);
				if(skillVal<100)
				wearCount+=Random(25,75);
				if(Random(0,20)==20)
				{
					if(cr.IsPlayer())
					cr.Say((11),"  -  .");
					wearCount+=Random(100,200);
				}
				
				DeteriorateItem(cr,realWeapon,wearCount/3);
			}
			
			if(realWeapon.GetProtoId()==(1034))
			{
				if((Random(0,5)+cr.Stat[(2)]+cr.Stat[(0)])<15)
				{
					if(!cr.IsDead()||!cr.IsKnockout())
					{
						cr.ToKnockout(((true)?(82):(83)),((true)?(86):(87)),((true)?(88):(89)),8,cr.HexX,cr.HexY);
						switch(Random(0,1))
						{
							case 0:
							if(cr.DamageBase[(504)]!=1)
							cr.DamageBase[(504)]=1;
							break;
							case 1:
							if(cr.DamageBase[(503)]!=1)
							cr.DamageBase[(503)]=1;
							break;
							
							default:
							break;
						}
					}
				}
			}
		} 
		
		if(wpnIsRemoved&&cr.Mode[(522)]==0)
		{
			bool placeOnHex=(skillNum==(205)&&!(isGrenade||weapPid==(939)));
			if(realWeapon.IsStackable())
			{
				
				if(placeOnHex)
				map.AddItem(tx,ty,weapPid,1); 
				
				if(realWeapon.GetCount()>1)
				realWeapon.SetCount(realWeapon.GetCount()-1);
				else
				DeleteItem(realWeapon);
			}
			else
			{
				MoveItem(realWeapon,0,map,tx,ty);
			}
		}
	} 
	
	if(!attack.TargetHit&&(@target!=null))
	{
		if(!target.IsPlayer())
		AI_TrySayCombatText(target,(3));
		target.Action((13),0,null);
	}
	
	return;
} 

void ApplyDamage(AttackStruct&attack,Critter&target,uint rounds,bool isCritical,bool intentionally,CombatRes[]&results)
{
	int dmgMul=attack.DmgMul;
	int bt=target.Stat[(67)];
	if(bt==(29))
	bt=(0);
	uint eff=0;
	uint msgEff=0;
	int weaponPerk=attack.WeaponPerk;
	Critter@attacker=attack.Attacker;
	bool validAttacker=(@attacker!=null);
	Map@map=target.GetMap();
	bool isBloodyMess=attack.BloodyMess;
	bool isCombatText=attack.CombatMessage;
	Item@realWeapon=attack.RealWeapon;
	uint aim=attack.Aim;
	uint extraMessage=0;
	uint extraMessageSelf=0;
	
	bool targetIsPlayer=target.IsPlayer();
	bool attackerIsPlayer=((@attacker!=null)?attacker.IsPlayer():false);
	
	bool isBurst=attack.IsBurst;
	
	if(target.IsDead()||not(@map!=null))
	return;
	
	if(validAttacker&&intentionally&&target.Id!=attack.TargetId)
	target.EventAttacked(attacker); 
	
	if(target.Id==attack.TargetId)
	attack.TargetHit=true; 
	
	if((@realWeapon!=null)&&realWeapon.IsDeteriorable())
	{
		if((realWeapon.Deterioration>=300*Random(50,200))&&(@attack.Ammo!=null)&&(@attack.Attacker!=null)&&
		attack.Ammo.ProtoId!=(1435)&&attack.Ammo.ProtoId!=(14)&&
		attack.Ammo.ProtoId!=(37)&&attack.Ammo.ProtoId!=(1035)&&
		attack.Ammo.ProtoId!=(32)&&attack.Ammo.ProtoId!=(382)&&
		attack.Ammo.ProtoId!=(38)&&attack.Ammo.ProtoId!=(39))
		{
			if(validAttacker)
			attacker.Say((6),"");
			
			if(Random(0,9)==0)
			{
				realWeapon.AmmoCount=0;
				realWeapon.Update();
			}
			return;
		}
		
		if(attack.WeaponPid==(1402)||
		attack.WeaponPid==(1406)||
		attack.WeaponPid==(1407)||
		attack.WeaponPid==(1408)||
		attack.WeaponPid==(1410)||
		attack.WeaponPid==(1412)||
		attack.WeaponPid==(1422))
		{
			if(Random(0,99)+(attack.Attacker.Stat[(6)]-5)*3<15)
			{
				if(validAttacker)attacker.Say((6),"");
				
				if(Random(0,4)==0&&attack.WeaponPid!=(1406)&&attack.WeaponPid!=(1408)&&attack.WeaponPid!=(1410))
				{
					realWeapon.AmmoCount=0;
					realWeapon.Update();
				}
				return;
			}
		}
		if(((@attack.Ammo!=null)&&(@attack.Attacker!=null)&&attack.Ammo.ProtoId==(1430))||
		((@attack.Ammo!=null)&&(@attack.Attacker!=null)&&attack.Ammo.ProtoId==(1432))||
		((@attack.Ammo!=null)&&(@attack.Attacker!=null)&&attack.Ammo.ProtoId==(1433))||
		((@attack.Ammo!=null)&&(@attack.Attacker!=null)&&attack.Ammo.ProtoId==(1434)))
		{
			if(Random(0,99)+(attack.Attacker.Stat[(6)]-5)*2<10)
			{
				if(validAttacker)
				attacker.Say((6),"");
				return;
			}
		}
	}                  
	
	if(attack.WeaponPid==(1010))
	{
		if(!target.IsDead()&&(Random(0,40)+attacker.StatBase[(0)]*1.5+(attacker.Stat[(6)]-5)*2-target.StatBase[(0)]*1.5)+
		(attacker.Skill[(203)]-target.Skill[(203)])+(attacker.StatBase[(72)]-target.StatBase[(72)])*0.2+
		(attacker.StatBase[(5)]-target.StatBase[(5)])>=30)
		{
			HookMeleeAttack(attacker,target);
			attacker.Say((6),"");
		}
		else
		{
			attacker.Say((6)," ");
		}
		return;
	} 
	
	if(targetIsPlayer&&attackerIsPlayer&&validAttacker&&(attacker.Mode[(514)]!=0||target.Mode[(514)]!=0))
	{
		if(validAttacker)
		attacker.Say((11),"No PvP.");
		target.Say((11),"No PvP.");
		return;
	} 
	
	if(target.GetProtoId()==(490))
	{
		BallAttackHandling(target,attacker,attack.WeaponPid);
		return;
	}
	if(target.Mode[(510)]!=0&&(!target.IsPlayer()||target.GetAccess()==(0)))
	target.ModeBase[(510)]=0; 
	
	if(attack.WeaponPid==(660))
	{
		uint8 dist=GetDistantion(attack.Hx,attack.Hy,target.HexX,target.HexY);
		
		ApplyFlashEff(target,dist);
		return;
	} 
	
	int targetTimeout=(__FullSecond+(((__TimeoutBattle-((target.Stat[(9)])*__TimeMultiplier))>(int(((12)*__TimeMultiplier))))?(__TimeoutBattle-((target.Stat[(9)])*__TimeMultiplier)):(int(((12)*__TimeMultiplier)))));
	if(target.Timeout[(238)]<targetTimeout-__FullSecond)
	target.TimeoutBase[(238)]=targetTimeout;
	target.TimeoutBase[(243)]=(__FullSecond+(((((34-target.Stat[(12)])>(3))?(34-target.Stat[(12)]):(3)))*__TimeMultiplier));
	
	if(target.Mode[(527)]!=0)
	isCritical=false;
	
	if(isCritical&&target.Perk[(420)]!=0&&(target.StatBase[(0)]+target.StatBase[(2)])*5>=Random(1,100))
	isCritical=false;
	else if(isCritical||attack.ForceFlags!=0)
	{
		if(isCritical)
		{
			int aim_=aim;
			if(aim_==(0))
			aim_=(9);
			aim_--;
			
			int MaxRoll=80+(validAttacker?(attacker.Stat[(15)]):0);
			int roll=Random(0,MaxRoll);
			if(roll<=35)
			roll=0;
			else if(roll<=70)
			roll=1;
			else if(roll<=90)
			roll=2;
			else if(roll<=95)
			roll=3;
			else if(roll<=100)
			roll=4;              
			
			uint offset=bt*9*6*7+aim_*6*7+roll*7;
			dmgMul*=CriticalTable[offset];
			dmgMul>>=1;
			eff=CriticalTable[offset+1];
			int stat=CriticalTable[offset+2];
			int statMod=CriticalTable[offset+3];
			
			uint cMessage=CriticalTable[offset+5];
			uint cFailureMessage=CriticalTable[offset+6];
			
			extraMessage=cMessage;
			
			if(stat!=-1)
			if(Random(1,10)>target.Stat[stat]+statMod)
			{
				eff|=CriticalTable[offset+4];
				extraMessage=cFailureMessage;
			}
			
			if(weaponPerk==(9))
			(eff=(eff)|((0x00000001)));
			
			if(target.Mode[(531)]!=0)
			(eff=((eff)&(~((0x00000002)))));
			else if((((eff)&((0x00000002)))!=0)&&target.Perk[(405)]!=0&&(Random(0,100)<50))
			(eff=((eff)&(~((0x00000002)))));
		}
		
		if(attack.ForceFlags!=0)
		{
			eff|=attack.ForceFlags;
			isCritical=true;
		}  
		
		if(target.Mode[(524)]!=0)
		{
			(eff=((eff)&(~(((0x00000004)|(0x00000008)|(0x00000010)|(0x00000020)|(0x00200000))))));
			msgEff=eff;
		}
		else
		{
			msgEff=eff;
			
			if((((eff)&((0x00200000)))!=0))
			{
				(eff=((eff)&(~((0x00200000)))));
				switch(Random(1,4))
				{
					case 1:
					(eff=(eff)|((0x00000004)));
					break;
					case 2:
					(eff=(eff)|((0x00000008)));
					break;
					case 3:
					(eff=(eff)|((0x00000010)));
					break;
					case 4:
					(eff=(eff)|((0x00000020)));
					break;
					default:
					break;
				}
			}
		}
		if(target.Mode[(523)]!=0)
		{
			(eff=((eff)&(~((0x00004000)))));
			(msgEff=((msgEff)&(~((0x00004000)))));
		}
		
		if(validAttacker&&attackerIsPlayer)
		attacker.AddScore((16),1);
	}
	
	if(weaponPerk==(9))
	{
		if(validAttacker)
		if(Random(1,100)<=(attacker.Stat[(0)])-8)
		(eff=(eff)|((0x00000001)));
	}
	
	int dmgType=attack.DmgType;
	int targetDR=target.Stat[(23)+dmgType-1];
	int targetDT=target.Stat[(16)+dmgType-1];
	
	if((((eff)&((0x00000800)))!=0)&&dmgType!=(6))
	{
		targetDT/=5;
		targetDR/=5;
		targetDR-=((@attacker!=null)?(attacker.Trait[(554)]!=0?30:0):0);
	}
	else if(weaponPerk==(3))
	targetDT/=5;
	
	targetDR+=(validAttacker?(attacker.Trait[(554)]!=0?30:0):0);
	targetDR+=attack.DRMod;
	targetDR=(((targetDR)>(100))?(100):(((targetDR)<(0))?(0):(targetDR)));
	int dmgMin=attack.DmgMin+attack.BonusDmg;
	;
	int dmgMax=attack.DmgMax+attack.BonusDmg;
	;
	int rawDmg;
	int totalDmg=0;
	dmgMul*=attack.DMMod;
	int dmgDiv=2*attack.DDMod;
	
	if(attack.WeaponSubtype==(2)&&attack.RealWeapon.IsDeteriorable())
	{
		dmgMin-=dmgMin*(GetDeteriorationProcent(attack.RealWeapon)*0.01);
		dmgMax-=dmgMax*(GetDeteriorationProcent(attack.RealWeapon)*0.01);
	}
	
	if(attack.Attacker.Param[(703)]==(4))attack.Attacker.Say((11),"DMin= "+dmgMin+", DMax= "+dmgMax+", dmgMul= "+dmgMul+", dmgDiv= "+dmgDiv);
	if((@target!=null)&&target.Param[(703)]==(4))target.Say((11),"DMin= "+dmgMin+", DMax= "+dmgMax+", dmgMul= "+dmgMul+", dmgDiv= "+dmgDiv);
	
	for(uint i=0;i<rounds;i++)
	{
		rawDmg=Random(dmgMin,dmgMax);
		rawDmg*=dmgMul;
		rawDmg/=dmgDiv;
		
		if(attack.Attacker.Param[(703)]==(4))attack.Attacker.Say((11),"raw= "+rawDmg);
		if((@target!=null)&&target.Param[(703)]==(4))target.Say((11),"raw= "+rawDmg); 
		
		if(targetIsPlayer)
		{
			Item@armor=target.GetItem(0,(3));
			if(aim==(1)&&(@armor!=null)&&(armor.GetProtoId()!=(17)&&armor.GetProtoId()!=(586)&&armor.GetProtoId()!=(232)&&armor.GetProtoId()!=(3)&&armor.GetProtoId()!=(239)&&armor.GetProtoId()!=(348)&&armor.GetProtoId()!=(349)&&armor.GetProtoId()!=(381)&&armor.GetProtoId()!=(951)&&armor.GetProtoId()!=(3987)&&armor.GetProtoId()!=(3988)&&armor.GetProtoId()!=(3989)&&armor.GetProtoId()!=(1223)&&armor.GetProtoId()!=(1224)))
			{
				targetDT*=0.2;
				targetDR*=0.2;
			}
			int stamina=(((target.StatBase[(190)])>(100))?(100):(((target.StatBase[(190)])<(10))?(10):(target.StatBase[(190)])));
			target.StatBase[(190)]-=rawDmg*targetDR*stamina*0.0001;
			if(target.StatBase[(190)]<0)target.StatBase[(190)]=0;
			
			rawDmg-=targetDT;
			rawDmg-=rawDmg*targetDR*stamina*0.0001;
		}
		else
		{
			rawDmg-=targetDT;
			rawDmg-=rawDmg*targetDR*0.01;
		}
		
		if(rawDmg>0)
		totalDmg+=rawDmg;
	}
	
	if(attack.Attacker.Param[(703)]==(4))attack.Attacker.Say((11),"total= "+totalDmg);
	if((@target!=null)&&target.Param[(703)]==(4))target.Say((11),"total= "+totalDmg); 
	
	if(validAttacker&&(@target!=null))
	{
		if(aim==(1))
		totalDmg+=totalDmg*0.2;
		if(aim==(8)){
			totalDmg+=totalDmg*0.2;
		}
		else if(aim==(2)||aim==(3)||aim==(5)||aim==(6))
		{
			totalDmg-=totalDmg*0.25;
		}
		
		if(attack.Attacker.Perk[(398)]!=0&&!(bt==(16)||bt==(10)))
		totalDmg+=8;
		if(attack.Attacker.Perk[(402)]!=0&&dmgType==(3))
		totalDmg+=totalDmg/5;
		if(target.Stat[(72)]<=0&&aim==(1))
		{
			attack.Attacker.StatBase[(90)]=target.Id;
			attack.Attacker.ParamBase[(95)]=3;
			attack.Attacker.ShowScreen((2),1,"answer_COUP_DE_GRACE");
			attack.Attacker.Say((18)," ?");
			attack.Attacker.Say((19+(0)),"");
		}
		if(targetIsPlayer)
		{
			if(!attack.Attacker.IsNpc()&&attack.Attacker.Param[(77)]<=3&&target.Param[(77)]>=4)totalDmg*=0.5;
			if(attack.Attacker.Param[(77)]>=4&&target.Param[(77)]<=3)totalDmg*=3;
			if(target.Perk[(420)]>0&&target.Perk[(394)]<=0)totalDmg*=0.7;
			if(target.Perk[(394)]>0&&target.Perk[(420)]<=0)totalDmg*=0.7;
			if(target.Perk[(420)]>0&&target.Perk[(394)]>0)totalDmg*=0.5;    
			
			if(dmgType==(1)&&(@attack.Ammo!=null)&&target.StatBase[(67)]!=(10)&&Random(0,1)==0&&(totalDmg>=(0.25*target.Stat[(72)]))&&!(((target.StatBase[(146)])&((0x040)))!=0))
			{
				ChangeStatus(target,(0x040),0,true);
				if(!(((target.StatBase[(146)])&((0x010)))!=0))
				ChangeStatus(target,(0x010),0,true);
			}
			if(Random(0,1)==0&&(totalDmg>=target.Stat[(72)]*0.3)&&target.StatBase[(67)]!=(10)&&!(((target.StatBase[(146)])&((0x010)))!=0))
			{
				ChangeStatus(target,(0x010),0,true);
			}     
			
			if(attack.Attacker.GetProtoId()==128&&targetIsPlayer)
			{
				if(target.Param[(703)]==(3))
				totalDmg+=40;
				if(target.Stat[(72)]<totalDmg)
				totalDmg=(((target.Stat[(72)])>0)?(target.Stat[(72)]):-(target.Stat[(72)]))+2;
			}
			
			if(attack.Attacker.Param[(703)]==(4))attack.Attacker.Say((11),"aftertotal= "+totalDmg);
			if((@target!=null)&&target.Param[(703)]==(4))target.Say((11),"aftertotal= "+totalDmg);
		}
		if(target.Stat[(67)]==(10))totalDmg*=0.7;
		if(target.StatBase[(67)]==(10)&&!(((target.StatBase[(146)])&((0x010)))!=0))
		{
			int rob=0;
			if(totalDmg>=target.StatBase[(6)]*4+target.StatBase[(7)]*0.1)
			{
				rob=2;
				if(target.IsNpc())target.Say((2),"   ");
				target.Say((11),"### 1-K###");
				totalDmg+=2;
			}
			if(rob>=2&&totalDmg>=(target.StatBase[(7)]/2)*0.4)
			{
				if(target.IsNpc())target.Say((2),"   ");
				target.Say((11),"### 2-K###");
				rob=4;
				totalDmg+=3;
			}
			if(Random(0,1)==0&&rob>=4&&totalDmg>=35)
			{
				target.Say((11),"### 3-K###");
				map.PlaySound("robot_damage1.ogg",target.HexX,target.HexY,60);
				map.RunEffect((4027),target.HexX,target.HexY,6);
				target.Say((11),"###! ###");
				target.Say((1),"#!@&#@!KO#BA&$URN@HLL#%PDR!");
				totalDmg+=20;
				ChangeStatus(target,(0x010),0,true);
			}
		}
		if(attack.Attacker.Param[(195)]>=160&&(@realWeapon!=null)&&realWeapon.AmmoCount>=1)
		{
			int roll=Random(1,20)+attack.Attacker.Stat[(4)]+attack.Attacker.Stat[(6)];
			if(roll<=20)
			{
				attack.Attacker.ParamBase[(730)]=3000;
				attack.Attacker.Say((5),"   ");
				attack.Attacker.ToDead((110),attack.Attacker);
				Log_Killings(attack.Attacker,attack.Attacker.Id,0,0,null,null);
			}
			else
			{
				attack.Attacker.Say((5)," ,     ");
			}
		}               
		
		bool canBleed=true;
		
		int bodyType=target.Stat[(67)];
		if((bodyType==(10))||(bodyType==(14)))canBleed=false;
		
		if((totalDmg>5)&&canBleed)
		{
			if(Random(0,9)==0&&target.GetTimeEvents((10),null,null,null)>0)target.EraseTimeEvents((10));
			if(Random(0,1)==0&&target.GetTimeEvents((41),null,null,null)>0)target.EraseTimeEvents((41));
			if(dmgType==(1)&&totalDmg>=target.Param[(23)]/2)
			{
				bool bleed=false;
				if(attacker.Stat[(67)]>=6)bleed=true;
				switch(attack.WeaponPid)
				{
					case(8):bleed=true;
					case(9):bleed=true;
					case(10):bleed=true;
					case(12):bleed=true;
					case(13):bleed=true;
					case(18):bleed=true;
					case(22):bleed=true;
					case(23):bleed=true;
					case(25):bleed=true;
					case(122):bleed=true;
					case(143):bleed=true;
					case(241):bleed=true;
					case(242):bleed=true;
					case(268):bleed=true;
					case(280):bleed=true;
					case(283):bleed=true;
					case(287):bleed=true;
					case(296):bleed=true;
					case(300):bleed=true;
					case(313):bleed=true;
					case(332):bleed=true;
					case(350):bleed=true;
					case(351):bleed=true;
					case(352):bleed=true;
					case(353):bleed=true;
					case(354):bleed=true;
					case(355):bleed=true;
					case(387):bleed=true;
					case(389):bleed=true;
					case(391):bleed=true;
					case(392):bleed=true;
					case(394):bleed=true;
					case(395):bleed=true;
					case(398):bleed=true;
					case(403):bleed=true;
					case(404):bleed=true;
					case(500):bleed=true;
					case(518):bleed=true;
					case(520):bleed=true;
					case(578):bleed=true;
					case(591):bleed=true;
					case(595):bleed=true;
					case(597):bleed=true;
					case(1034):bleed=true;
					case(1036):bleed=true;
					case(1039):bleed=true;
					case(1040):bleed=true;
					case(1043):bleed=true;
					case(1401):bleed=true;
					case(1402):bleed=true;
					case(1406):bleed=true;
					case(1407):bleed=true;
					case(1408):bleed=true;
					case(1409):bleed=true;
					case(1410):bleed=true;
					case(1411):bleed=true;
					case(1412):bleed=true;
					case(1415):bleed=true;
					case(1416):bleed=true;
					case(3984):bleed=true;
					case(234):bleed=true;
					case(4):bleed=true;
					case(1042):bleed=true;
					case(236):bleed=true;
					case(517):bleed=true;
					case(319):bleed=true;
					case(522):bleed=true;
					case(116):bleed=true;
					
					case(45):bleed=true;
					case(1044):bleed=true;
					
					case(1413):bleed=true;
					case(1414):bleed=true;
					case(1417):bleed=true;
					case(1418):bleed=true;
					case(1419):bleed=true;
					case(1421):bleed=true;
					
					case(1403):bleed=true;
					case(3985):bleed=true;
					case(3986):bleed=true;
					case(1400):bleed=true;
					case(94):bleed=true;
					case(385):bleed=true;
					case(1405):bleed=true;
					case(3983):bleed=true;
					default:break;
				}
				if(bleed)ChangeStatus(target,(0x001),totalDmg/1.5,true);
			}
		}
	} 
	
	if((((eff)&((0x00004000)))!=0))
	{
		Item@realWeaponTarget=target.GetItem(0,(1));
		if((@realWeaponTarget!=null))
		{
			if(realWeaponTarget.IsStackable())
			{
				Item@dropped=map.AddItem(target.HexX,target.HexY,realWeaponTarget.GetProtoId(),1);
				if(realWeaponTarget.GetCount()>1)
				realWeaponTarget.SetCount(realWeaponTarget.GetCount()-1);
				else
				DeleteItem(realWeaponTarget);
				
				if(!target.IsPlayer())
				{
					NpcPlane@plane=CreatePlane();
					NpcPlane@[]crPlanes(0);
					
					if(target.GetPlanes(crPlanes)>0)
					plane.Priority=crPlanes[0].Priority+1;
					else
					plane.Priority=70;
					
					plane.Type=(3);
					plane.Pick_HexX=dropped.HexX;
					plane.Pick_HexY=dropped.HexY;
					plane.Pick_Pid=dropped.GetProtoId();
					plane.Pick_UseItemId=0;
					plane.Pick_ToOpen=false;
					plane.Run=true;
					target.AddPlane(plane);
				}
			}
			else
			{
				MoveItem(realWeaponTarget,0,map,target.HexX,target.HexY);
				if(!target.IsPlayer())
				{
					NpcPlane@plane=CreatePlane();
					
					NpcPlane@[]crPlanes(0);
					
					if(target.GetPlanes(crPlanes)>0)
					plane.Priority=crPlanes[0].Priority+1;
					else
					plane.Priority=70;
					
					plane.Type=(3);
					plane.Pick_HexX=realWeaponTarget.HexX;
					plane.Pick_HexY=realWeaponTarget.HexY;
					plane.Pick_Pid=realWeaponTarget.GetProtoId();
					plane.Pick_UseItemId=0;
					plane.Pick_ToOpen=false;
					plane.Run=true;
					target.AddPlane(plane);
				}
			}
		}
	}
	
	bool isKo=false;
	bool knockDown=false;
	bool knockOut=false;
	bool isDead=false;
	bool loseTurn=false;
	bool isBelow=false;
	int knockDmg=totalDmg; 
	
	if(target.Mode[(527)]!=0)
	eff=0;
	
	if((((eff)&((0x00000002)))!=0))
	{
		isKo=true;
		knockDown=true;
	}
	else if(dmgType==(7)&&totalDmg>9)
	isKo=true; 
	
	if((((eff)&((0x00000004)))!=0))
	target.DamageBase[(506)]=1;
	
	if((((eff)&((0x00000008)))!=0))
	target.DamageBase[(505)]=1;
	
	if((((eff)&((0x00000010)))!=0))
	target.DamageBase[(504)]=1;
	
	if((((eff)&((0x00000020)))!=0))
	target.DamageBase[(503)]=1;
	
	if((((eff)&((0x00000040)))!=0))
	target.DamageBase[(502)]=1; 
	
	uint8 noMove=target.DamageBase[(506)]>0&&target.DamageBase[(505)]>0?1:0;
	if(!target.IsPlayer())target.ModeBase[(539)]=noMove;
	target.ModeBase[(540)]=noMove; 
	
	if((((eff)&((0x00008000)))!=0))
	{
		isKo=true;
		loseTurn=true;
	}
	
	if((((eff)&((0x00000001)))!=0))
	{
		isKo=true;
		knockOut=true;
		loseTurn=false;
	} 
	
	if((((eff)&((0x00000080)))!=0))
	if(target.Stat[(72)]>totalDmg)
	totalDmg=target.Stat[(72)];
	
	if(target.Stat[(67)]==(10)&&(((target.StatBase[(146)])&((0x010)))!=0))totalDmg*=1.2;
	bool safeMode=((@realWeapon!=null)&&(realWeapon.GetProtoId()==(292)||realWeapon.GetProtoId()==(496)));
	
	if(totalDmg>0)
	{
		if(target.Mode[(527)]==0)
		{
			int r=0;
			while(r<rounds){
				if(target.Stat[(67)]!=(10)&&target.Stat[(67)]!=(14))target.StatBase[(72)]-=totalDmg/rounds+1;
				if(isBurst){
					int randomAim=Random(0,18);
					if(randomAim<=7)aim=(4);
					else if(randomAim<=9)aim=(3);
					else if(randomAim<=11)aim=(2);
					else if(randomAim<=13)aim=(5);
					else if(randomAim<=15)aim=(6);
					else if(randomAim<=17)aim=(1);
					else if(randomAim<=18)aim=(8);
				}
				switch(aim){
					case(1):
					if(!safeMode)target.ParamBase[(730)]+=(totalDmg/rounds+1)/(safeMode?5:1);
					break;
					case(7):
					if(!safeMode)target.ParamBase[(732)]+=(totalDmg/rounds+1)/(safeMode?5:1);
					break;
					case(3):
					if(!safeMode)target.ParamBase[(734)]+=(totalDmg/rounds+1)/(safeMode?5:1);
					break;
					case(2):
					if(!safeMode)target.ParamBase[(735)]+=(totalDmg/rounds+1)/(safeMode?5:1);
					break;
					case(6):
					if(!safeMode)target.ParamBase[(737)]+=(totalDmg/rounds+1)/(safeMode?5:1);
					break;
					case(5):
					if(!safeMode)target.ParamBase[(736)]+=(totalDmg/rounds+1)/(safeMode?5:1);
					break;
					case(8):
					if(!safeMode)target.ParamBase[(733)]+=(totalDmg/rounds+1)/(safeMode?5:1);
					break;
					default:
					if((attack.DmgType==(3))||(attack.DmgType==(7))){
						int k=(730);
						while(k<=(737)){
							target.ParamBase[k]+=totalDmg/rounds+1;
							k++;
						}
					}
					else if(!safeMode)target.ParamBase[(731)]+=(totalDmg/rounds+1)/(safeMode?5:1);
					break;
				}
				r++;
			}
			bool emoteSaid=false;
			int maxHP=target.Stat[(7)];
			int i=(730);
			int currentHP=0;
			while(i<=(737)){
				currentHP=target.ParamBase[i];
				if(currentHP>0.6*maxHP){
					string painEmote;
					switch(target.Stat[(67)]){
						case(0):
						case(1):
						case(2):
						case(3):
						case(4):
						painEmote="  ";
						break;
						case(5):
						case(7):
						case(11):
						case(13):
						case(15):
						case(9):
						case(16):
						painEmote="  ";
						break;
						case(6):
						case(8):
						case(12):
						case(14):
						case(17):
						case(19):
						case(20):
						painEmote="    ";
						break;
						case(10):
						case(18):
						case(29):
						painEmote="  ";
						break;
						
					}
					switch(i){
						case(735):
						if(target.DamageBase[(504)]==0){
							target.Say((11),"     .");
							if(!emoteSaid)target.Say((5),painEmote);
							emoteSaid=true;
						}
						target.DamageBase[(504)]=1;
						break;
						case(734):
						if(target.DamageBase[(503)]==0){
							target.Say((11),"     .");
							if(!emoteSaid)target.Say((5),painEmote);
							emoteSaid=true;
						}
						target.DamageBase[(503)]=1;
						break;
						case(737):
						if(target.DamageBase[(506)]==0){
							target.Say((11),"     .");
							if(!emoteSaid)target.Say((5),painEmote);
							emoteSaid=true;
						}
						target.DamageBase[(506)]=1;
						break;
						case(736):
						if(target.DamageBase[(505)]==0){
							target.Say((11),"     .");
							if(!emoteSaid)target.Say((5),painEmote);
							emoteSaid=true;
						}
						target.DamageBase[(505)]=1;
						break;
						case(732):
						if(target.DamageBase[(502)]==0){
							target.Say((11),"  !");
							if(!emoteSaid)target.Say((5),"   ");
							emoteSaid=true;
						}
						target.DamageBase[(502)]=1;
						break;
					}
				}
				if(currentHP>maxHP-__DeadHitPoints)target.ParamBase[i]=maxHP-__DeadHitPoints+1;
				if(currentHP<0)target.ParamBase[i]=0;
				i++;
			}
			if(target.Stat[(72)]<1)
			{
				if(target.Mode[(531)]==0)
				{
					isKo=true;
					isBelow=true;
				}
			}
			if((target.ParamBase[(730)]>(target.Param[(7)])-__DeadHitPoints)||(target.ParamBase[(731)]>(target.Param[(7)])-__DeadHitPoints)){
				isDead=true;
				target.StatBase[(72)]=-30;
			}
			
			ChangeCritterSpeed(target);
		}
		
		if((attacker.Param[(77)]>=4)&&((aim==(1))||(aim==(4))||aim==(9)))
		{
			attacker.StatBase[(76)]+=totalDmg;
			
		}
		if(attacker.Param[(77)]>=1)
		{
			unsafe_log_1(attacker,0,0,0,attacker.Name+" "+attacker.Id+"  "+totalDmg+"  "+"  "+target.Name+" "+target.Id,null);
			
		}
		if(!targetIsPlayer&&attackerIsPlayer&&attacker.Param[(703)]==(3))
		target.StatBase[(187)]=1;
		
		if(attack.scoreUnarmed&&validAttacker&&attackerIsPlayer)
		attacker.AddScore((19),totalDmg);
	}
	
	bool attackFront=true;
	uint dir=GetDirection(attack.Hx,attack.Hy,target.HexX,target.HexY);
	if((dir==target.Dir||((dir+1)%6)==target.Dir||((dir+5)%6)==target.Dir))
	attackFront=false;
	
	int armorDr=target.Stat[(23)+dmgType-1];
	Item@armor=target.GetItem(0,(3));
	if((@armor!=null)&&targetIsPlayer)
	DeteriorateItem(target,armor,((100-armorDr)*rounds+totalDmg)/3); 
	
	if(isDead)
	{
		bool burst=attack.IsBurst;
		uint anim2Dead=0;
		
		if(target.IsKnockout())
		{
			if(target.Anim2Knockout==(86))
			anim2Dead=(100);
			else
			anim2Dead=(101);
		}
		else
		{
			if(attackFront)
			anim2Dead=(102);
			else
			anim2Dead=(103);
			
			switch(dmgType)
			{
				case(0):
				break;
				case(1):
				if(burst)
				{
					if(isCritical||isBloodyMess)
					anim2Dead=(111);
					else
					anim2Dead=(112);
				}
				else
				{
					if(isCritical||isBloodyMess)
					anim2Dead=(110);
				}
				break;
				case(2):
				anim2Dead=(115);
				break;
				case(3):
				if(Random(0,1)==0)
				anim2Dead=(118);
				else
				anim2Dead=(119);
				break;
				case(4):
				anim2Dead=(116);
				break;
				case(5):
				if(Random(0,1)==0)
				anim2Dead=(113);
				else
				anim2Dead=(114);
				break;
				case(7):
				anim2Dead=(117);
				break;
				default:
				break;
			}
		}
		
		if(targetIsPlayer)
		target.AddScore((5),1);
		
		if(validAttacker&&attackerIsPlayer)
		{
			attacker.AddScore((15),1);
			if(targetIsPlayer)
			{
				attacker.AddScore((7),1);
				target.StatBase[(188)]=attacker.Id;
				if(attacker.Param[(703)]!=(3)&&target.Param[(703)]!=(3))
				Log_Killings(attacker,target.Id,0,0,null,null);
			}
			else if(target.Id==attack.TargetId)
			target.AddEnemyInStack(attacker.Id);
		}
		
		if(validAttacker&&!attackerIsPlayer)
		attacker.EraseEnemyFromStack(target.Id);
		
		if((@attacker!=null)&&(attacker.Param[(703)]==(3)||target.Stat[(187)]!=1))
		{
			
			attacker.KillBase[(__KillBegin)+bt]++;
		}
		
		target.ToDead(anim2Dead,attacker);
	}
	else if(isKo)
	{
		int maxAp=target.Stat[(8)];
		int currentAp=target.Stat[(75)];
		int targetAp=currentAp;
		if(loseTurn)
		{
			targetAp=-maxAp;
			target.StatBase[(88)]=0;
		}
		if(knockOut)
		targetAp=-Random(maxAp,3*maxAp);
		if(knockDown&&!(target.IsKnockout()&&map.IsTurnBased()))
		targetAp-=(target.Perk[(403)]!=0?1:3);
		if((isBelow||knockOut||knockDown||dmgType==(7))&&!target.IsKnockout()&&target.Mode[(531)]==0)
		{
			int knockDist=knockDmg;
			if((dmgType==(7)||attack.WeaponSubtype==(2))&&target.IsCanWalk())
			{
				if(weaponPerk==(4))
				knockDist/=5;
				else
				knockDist/=10;
				if(target.Perk[(405)]!=0)
				knockDist/=2;
				knockDist--;
				if(knockDist>10)
				knockDist=10;
				uint16 knockHx=attack.Hx;
				uint16 knockHy=attack.Hy;
				if(knockDist>0)
				{
					map.GetHexCoordWall(target.HexX,target.HexY,knockHx,knockHy,180.0f,knockDist);
					target.ToKnockout(((attackFront)?(82):(83)),((attackFront)?(86):(87)),((attackFront)?(88):(89)),0,knockHx,knockHy);
				}
				else
				target.ToKnockout(((attackFront)?(82):(83)),((attackFront)?(86):(87)),((attackFront)?(88):(89)),0,target.HexX,target.HexY);
			}
			else
			target.ToKnockout(((attackFront)?(82):(83)),((attackFront)?(86):(87)),((attackFront)?(88):(89)),0,target.HexX,target.HexY);
		}
		if(targetAp<currentAp)
		target.StatBase[(75)]=100*targetAp;
	} 
	
	else if(not target.IsKnockout())
	{
		
		if(attack.ShowHitAnimForce)
		target.Action((15),attackFront?0:1,null);
		else
		target.Action((14),attackFront?0:1,null); 
		
		if(isCombatText&&dmgType!=(0)&&!targetIsPlayer)
		{
			switch(aim)
			{
				case(0):
				case(9):
				case(4):
				AI_TrySayCombatText(target,(13));
				break;
				case(7):
				AI_TrySayCombatText(target,(16));
				break;
				case(1):
				AI_TrySayCombatText(target,(10));
				break;
				case(2):
				AI_TrySayCombatText(target,(11));
				break;
				case(3):
				AI_TrySayCombatText(target,(12));
				break;
				case(8):
				AI_TrySayCombatText(target,(17));
				break;
				case(5):
				AI_TrySayCombatText(target,(14));
				break;
				case(6):
				AI_TrySayCombatText(target,(15));
				break;
				default:
				break;
			}
		}
	}
	
	bool isAimed=(aim!=(0))&&(aim!=(4))&&(aim!=(9));
	
	uint mainMsg=(4);
	uint length=3;
	
	if(isCritical)
	{
		mainMsg+=2;
		length+=2;
	}
	if(isDead)
	{
		mainMsg+=4;
		if(isCritical)
		length-=1;
	}
	if(isAimed)
	{
		mainMsg+=1;
		length+=1;
	}
	
	uint[]sendEff(length);
	sendEff[0]=mainMsg;
	sendEff[1]=target.Id;
	uint now=2;
	
	if(isAimed)
	{
		sendEff[2]=aim;
		now++;
	}
	
	sendEff[now]=totalDmg;
	now++;
	
	if(isCritical)
	{
		if(!isDead)
		{
			sendEff[now]=msgEff;
			now++;
		}
		
		sendEff[now]=extraMessage;
	}
	
	Critter@[]source={target};
	Critter@[]crits;
	
	if(@target.GetMap()!=null)
	{
		target.GetMap().GetCrittersSeeing(source,true,(0x0F)|(0x10),crits);
		
		for(int i=0,j=crits.length();i<j;i++)
		if(crits[i].Id!=target.Id)
		AddEff(crits[i],sendEff,results);
	}
	if(isCritical)
	sendEff[now]=extraMessage+1500;
	
	AddEff(target,sendEff,results); 
	
	if(validAttacker)
	{
		int poison=attacker.Stat[(64)];
		int radiation=attacker.Stat[(65)];
		if(poison!=0||radiation!=0)
		{
			if(Random(2,11)>target.Stat[(6)]&&!attackerIsPlayer)
			{
				if(poison>0)
				AffectPoison(target,Random(poison/3,poison));
				if(radiation>0)
				AffectRadiation(target,Random(radiation/3,radiation));
			}
		}
		else
		{
			int attackerBt=attacker.Stat[(67)];
			if(attackerBt==(6)||attackerBt==(8)||attackerBt==(20)||attackerBt==(16)||attackerBt==(9))
			{
				if(Random(2,11)>target.Stat[(6)])
				{
					if(attacker.IsNpc())
					{
						if(attackerBt==(6))
						AffectPoison(target,Random(3,15));
						else if(attackerBt==(8))
						AffectPoison(target,Random(10,40));
						else if(attackerBt==(20))
						AffectPoison(target,Random(10,40));
						else if(attackerBt==(16))
						AffectRadiation(target,Random(10,40));
						else if(attackerBt==(9))
						{
							AffectPoison(target,Random(10,20));
							AffectRadiation(target,Random(10,20));
						}
					}
					else
					{
						if(attackerBt==(6))
						AffectPoisonByCritter(target,Random(3,15),attacker);
						else if(attackerBt==(8))
						AffectPoisonByCritter(target,Random(10,40),attacker);
						else if(attackerBt==(20))
						AffectPoisonByCritter(target,Random(10,40),attacker);
						else if(attackerBt==(16))
						AffectRadiation(target,Random(10,40));
						else if(attackerBt==(9))
						{
							AffectPoisonByCritter(target,Random(10,20),attacker);
							AffectRadiation(target,Random(10,20));
						}
					}
				}
			}
		}
	}
	
	if(target.ParamBase[(703)]==(3)&&!target.IsDead()&&target.StatBase[(72)]<=0)
	{
		target.ToDead(dmgType,@attacker!=null?attacker:null);
		target.Action((19),0,null);
	}
	if(attacker.CountItem((1537))>=1&&target.Karma[(489)]!=0)
	{
		attacker.StatBase[(72)]-=Random(1,4);
		attacker.ToKnockout(((true)?(82):(83)),((true)?(86):(87)),((true)?(88):(89)),100,attacker.HexX,attacker.HexY);
	}
	if(target.CountItem((1542))>=1&&(!target.IsDead()||!target.IsKnockout()))
	{
		Item@package=target.GetItem((1542),0);
		MoveItem(package,0,map,target.HexX,target.HexY);
		target.ModeBase[(539)]=0;
		target.ModeBase[(540)]=0;
		target.ToKnockout((((Random(0,1)==1))?(82):(83)),(((Random(0,1)==1))?(86):(87)),(((Random(0,1)==1))?(88):(89)),2,target.HexX,target.HexY);
	}
	if((@realWeapon!=null)&&realWeapon.Val5==10)
	{
		attacker.ToKnockout(((true)?(82):(83)),((true)?(86):(87)),((true)?(88):(89)),10,attacker.HexX,attacker.HexY);
		attacker.Say((6)," ");
		DeleteItem(realWeapon);
	}
	if((@attack.Ammo!=null)&&(@attack.Attacker!=null)&&attack.Ammo.ProtoId==(907))
	AffectPoisonByCritter(target,25,attack.Attacker);
	if(attack.WeaponPid==(1042))
	AffectPoisonByCritter(target,20,attack.Attacker);
	if(attack.WeaponPid==(1043))
	AffectPoisonByCritter(target,20,attack.Attacker);
	if(attack.WeaponPid==(1044))
	AffectPoisonByCritter(target,20,attack.Attacker);
	if(attack.WeaponPid==(1045))
	AffectPoisonByCritter(target,20,attack.Attacker);
	if((@attack.Ammo!=null)&&(@attack.Attacker!=null)&&attack.Ammo.ProtoId==(1435))
	AffectRadiation(attacker,Random(0,10));
	
	if(attack.WeaponPid==(1404))
	{
		AffectRadiation(attacker,Random(20,30));
		AffectRadiation(target,Random(30,50));
	}
	if((@attack.Ammo!=null)&&attack.Ammo.ProtoId==(908))
	AffectParalysis(target,50);
	if((@attack.Ammo!=null)&&(!target.IsDead()||!target.IsKnockout())&&(aim==(2)||aim==(3))&&((@target.GetItem(0,(1))!=null))&&target.GetItem(0,(1)).GetProtoId()==(11))
	{
		if(Random(0,1)==0)
		{
			map.RunEffect((4011),target.HexX,target.HexY,1);
			map.PlaySound(Random(0,1)==0?"WHN1XXX1.ACM":"WHN1XXX2.ACM");
			QuakeScreen2(target);
			DeleteItem(target.GetItem(0,(1)));
		}
	}
	if(attack.WeaponPid==(594)&&target.ParamBase[(531)]<=0)
	{
		QuakeScreen2(target);
		if((Random(12,40)-target.Stat[(6)])>10&&(target.Timeout[(248)]<=((2)*__TimeMultiplier*60)))
		{
			int8 roll=Random(10,60)-target.Stat[(2)];
			if(roll>0)
			{
				target.ToKnockout((((Random(0,1)==1))?(82):(83)),(((Random(0,1)==1))?(86):(87)),(((Random(0,1)==1))?(88):(89)),roll,target.HexX,target.HexY);
				target.TimeoutBase[(248)]=__FullSecond+((2)*__TimeMultiplier*60)+((30)*__TimeMultiplier);
			}
		}
	}
	if((attack.WeaponPid==(1021)||attack.WeaponPid==(1022)||attack.WeaponPid==(1023)||attack.WeaponPid==1032)&&
	(aim==(5)||aim==(6))&&(target.Timeout[(248)]<=0))
	{
		if(((Random(10,30)-target.Stat[(2)]-target.Stat[(5)])>0)&&((Random(1,200)+attacker.Skill[(203)]-target.Skill[(203)])>=100)&&
		(target.Param[(67)]<(5))&&(attacker.Param[(67)]<(5))&&(!target.IsDead()||!target.IsKnockout()))
		{
			attacker.Say((6),"");
			int8 roll=Random(0,25)-target.Stat[(2)];
			if(roll>0)
			{
				target.ToKnockout((((Random(0,1)==1))?(82):(83)),(((Random(0,1)==1))?(86):(87)),(((Random(0,1)==1))?(88):(89)),roll,target.HexX,target.HexY);
				target.TimeoutBase[(248)]=__FullSecond+((10)*__TimeMultiplier);
			}
			target.StatBase[(186)]=0;
		}
	}
	if(attack.WeaponPid==(160)&&(@attack.Ammo!=null)&&(@attack.Attacker!=null)&&attack.Ammo.ProtoId!=(1435)&&(target.Timeout[(248)]<=((2)*__TimeMultiplier*60)))
	{
		QuakeScreen2(target);
		if((!target.IsDead()||!target.IsKnockout())&&(Random(13,30)-target.Stat[(6)])>10)
		{
			int8 roll=Random(13,50)-target.Stat[(2)];
			if(roll>0)
			{
				target.ToKnockout((((Random(0,1)==1))?(82):(83)),(((Random(0,1)==1))?(86):(87)),(((Random(0,1)==1))?(88):(89)),roll,target.HexX,target.HexY);
				target.TimeoutBase[(248)]=__FullSecond+((2)*__TimeMultiplier*60)+((15)*__TimeMultiplier);
			}
		}
	}
	
	if(attack.WeaponPid==(1400)&&target.ParamBase[(531)]<=0)
	{
		if(Random(0,5)!=0)
		realWeapon.AmmoCount++;
		if(!target.IsDead()||!target.IsKnockout())
		{
			uint8 dist=GetDistantion(attack.Hx,attack.Hy,target.HexX,target.HexY);
			
			Item@rope=attacker.GetItem((127),(2));
			if((target.IsRuning||Random(0,2)==0)&&dist>=2&&(@rope!=null))
			{
				HookHoldAttack(target,10);
				attacker.DeleteItem((127),1);
			}
			if(dist<=1&&dmgType!=(1))
			{
				QuakeScreen2(target);
				map.PlaySound("saw.ogg",target.HexX,target.HexY,10);
				if(aim==(2))
				target.DamageBase[(504)]=1;
				else if(aim==(3))
				target.DamageBase[(503)]=1;
				else if(aim==(5))
				target.DamageBase[(505)]=1;
				else if(aim==(6))
				target.DamageBase[(506)]=1;
				if(Random(0,10)-target.Stat[(0)]>0)
				target.ToKnockout((((Random(0,1)==1?true:false))?(82):(83)),(((Random(0,1)==1?true:false))?(86):(87)),(((Random(0,1)==1?true:false))?(88):(89)),10,target.HexX,target.HexY);
			}
		}
	}
	if(attack.WeaponPid==(1229)||attack.WeaponPid==(1232)||attack.WeaponPid==(1233)||attack.WeaponPid==(600)||attack.WeaponPid==(1520)||attack.WeaponPid==(1521))
	{
		
		if(!target.IsDead()||!target.IsKnockout())
		{
			uint8 dist=GetDistantion(attack.Hx,attack.Hy,target.HexX,target.HexY);
			bool burst=attack.IsBurst;
			
			if(!burst)
			{
				int8 roll=Random(0,3);
				if(roll==0)map.PlaySound("laser_01.ogg",attacker.HexX,attacker.HexY,0);
				else if(roll==1)map.PlaySound("laser_02.ogg",attacker.HexX,attacker.HexY,0);
				else if(roll==2)map.PlaySound("laser_03.ogg",attacker.HexX,attacker.HexY,0);
				else if(roll==3)map.PlaySound("laser_04.ogg",attacker.HexX,attacker.HexY,0);
			}
		}
	}
	if(attack.WeaponPid==(1428)||attack.WeaponPid==(1427))
	{
		Item@rope=attacker.GetItem((127),(2));
		if(!target.IsDead()&&(target.IsRuning||Random(0,2)==0)&&(@rope!=null)&&target.Timeout[(248)]<=((2)*__TimeMultiplier*60))
		{
			HookHoldAttack(target,6);
			attacker.DeleteItem((127),1);
		}
		target.AddItem((1438),1);
	}
	if(attack.WeaponPid==(7)||attack.WeaponPid==(280)||attack.WeaponPid==(1043))
	{
		uint8 dist=GetDistantion(attack.Hx,attack.Hy,target.HexX,target.HexY);
		Item@rope=attacker.GetItem((127),(2));
		if(!target.IsDead()&&(target.IsRuning||Random(0,2)==0)&&(@rope!=null)&&dist>2&&target.Timeout[(248)]<=((2)*__TimeMultiplier*60))
		{
			HookHoldAttack(target,2);
			attacker.DeleteItem((127),1);
			target.Say((6),"");
			target.TimeoutBase[(248)]=__FullSecond+((2)*__TimeMultiplier*60)+((30)*__TimeMultiplier);
		}
	}
	if(attack.WeaponPid==(1413)||attack.WeaponPid==(1414))
	{
		uint8 dist=GetDistantion(attack.Hx,attack.Hy,target.HexX,target.HexY);
		if(!target.IsDead()&&(target.IsRuning||Random(0,2)==0)&&dist>1)
		{
			HookHoldAttack(target,3);
			target.Say((6),"");
			target.TimeoutBase[(248)]=__FullSecond+((2)*__TimeMultiplier*60)+((30)*__TimeMultiplier);
		}
	}
	if(attack.WeaponPid==(1039)&&target.ParamBase[(531)]<=0)
	{
		if((!target.IsDead()||!target.IsKnockout())&&target.Timeout[(248)]<=((2)*__TimeMultiplier*60))
		{
			uint8 dist=GetDistantion(attack.Hx,attack.Hy,target.HexX,target.HexY);
			uint8 aimmod=0;
			if(aim==(1)||aim==(7))
			aimmod=50;
			else if(aim==(9)||aim==(0)||aim==(4))
			aimmod=30;
			if((attacker.Dir+3)%6==target.Dir||(attacker.Dir)%6==target.Dir)
			aimmod+=40;
			if(target.IsRuning&&target.Stat[(72)]<Random(aimmod,30+totalDmg*5+aimmod*2))
			{
				target.ToKnockout((((Random(0,1)==1?true:false))?(82):(83)),(((Random(0,1)==1?true:false))?(86):(87)),(((Random(0,1)==1?true:false))?(88):(89)),Random(1,3),target.HexX,target.HexY);
				target.TimeoutBase[(248)]=__FullSecond+((2)*__TimeMultiplier*60)+((5)*__TimeMultiplier);
			}
			else if(target.Stat[(72)]<Random(0,50+totalDmg*2+aimmod)&&dist<=2)
			{
				target.ToKnockout((((Random(0,1)==1?true:false))?(82):(83)),(((Random(0,1)==1?true:false))?(86):(87)),(((Random(0,1)==1?true:false))?(88):(89)),Random(4,10),target.HexX,target.HexY);
				target.TimeoutBase[(248)]=__FullSecond+((2)*__TimeMultiplier*60)+((15)*__TimeMultiplier);
			}
		}
	}
	if(attack.WeaponPid==(94)&&target.ParamBase[(531)]<=0)
	{
		if((!target.IsDead()||!target.IsKnockout())&&target.Timeout[(248)]<=((2)*__TimeMultiplier*60))
		{
			uint8 dist=GetDistantion(attack.Hx,attack.Hy,target.HexX,target.HexY);
			uint8 aimmod=0;
			if(aim==(1)||aim==(7))
			aimmod=50;
			else if(aim==(9)||aim==(0)||aim==(4))
			aimmod=30;
			if(target.IsRuning&&((attacker.Dir+3)%6==target.Dir||(attacker.Dir)%6==target.Dir))
			aimmod+=40;
			if(target.IsRuning&&target.Stat[(72)]<Random(aimmod,30+totalDmg*10+aimmod*2))
			{
				uint16 hx=target.HexX,hy=target.HexY;
				map.MoveHexByDir(hx,hy,attacker.Dir,1);
				target.ToKnockout((((Random(0,1)==1?true:false))?(82):(83)),(((Random(0,1)==1?true:false))?(86):(87)),(((Random(0,1)==1?true:false))?(88):(89)),Random(4,10),hx,hy);
				target.TimeoutBase[(248)]=__FullSecond+((2)*__TimeMultiplier*60)+((25)*__TimeMultiplier);
			}
			else if(target.Stat[(72)]<Random(aimmod,50+totalDmg*4+aimmod)&&dist<=3)
			{
				uint16 hx=target.HexX,hy=target.HexY;
				map.MoveHexByDir(hx,hy,attacker.Dir,1);
				target.ToKnockout((((Random(0,1)==1?true:false))?(82):(83)),(((Random(0,1)==1?true:false))?(86):(87)),(((Random(0,1)==1?true:false))?(88):(89)),Random(6,12),hx,hy);
				target.TimeoutBase[(248)]=__FullSecond+((2)*__TimeMultiplier*60)+((25)*__TimeMultiplier);
			}
		}
	}
	if(attack.WeaponPid==(385)&&target.ParamBase[(531)]<=0)
	{
		if((!target.IsDead()||!target.IsKnockout())&&target.Timeout[(248)]<=((2)*__TimeMultiplier*60))
		{
			uint8 dist=GetDistantion(attack.Hx,attack.Hy,target.HexX,target.HexY);
			uint8 aimmod=0;
			if(aim==(1)||aim==(7))
			aimmod=50;
			else if(aim==(9)||aim==(0)||aim==(4))
			aimmod=30;
			if((attacker.Dir+3)%6==target.Dir||(attacker.Dir)%6==target.Dir)
			aimmod+=40;
			if(target.IsRuning&&target.Stat[(72)]<Random(aimmod,50+totalDmg*8+aimmod*2))
			{
				uint16 hx=target.HexX,hy=target.HexY;
				map.MoveHexByDir(hx,hy,attacker.Dir,1);
				target.ToKnockout((((Random(0,1)==1?true:false))?(82):(83)),(((Random(0,1)==1?true:false))?(86):(87)),(((Random(0,1)==1?true:false))?(88):(89)),Random(10,12),hx,hy);
				target.TimeoutBase[(248)]=__FullSecond+((2)*__TimeMultiplier*60)+((30)*__TimeMultiplier);
			}
			else if(target.Stat[(72)]<Random(aimmod,70+totalDmg*4+aimmod)&&dist<=4)
			{
				target.ToKnockout((((Random(0,1)==1?true:false))?(82):(83)),(((Random(0,1)==1?true:false))?(86):(87)),(((Random(0,1)==1?true:false))?(88):(89)),Random(10,20),target.HexX,target.HexY);
				target.TimeoutBase[(248)]=__FullSecond+((2)*__TimeMultiplier*60)+((30)*__TimeMultiplier);
			}
		}
	}
	if(attack.WeaponPid==(6)&&target.ParamBase[(531)]<=0)
	{
		if((!target.IsDead()||!target.IsKnockout())&&target.Timeout[(248)]<=((2)*__TimeMultiplier*60))
		{
			int dist=GetDistantion(attack.Hx,attack.Hy,target.HexX,target.HexY);
			int aimmod=0;
			if(aim==(1)||aim==(7))
			aimmod=60;
			else if(aim==(9)||aim==(0)||aim==(4))
			aimmod=40;
			if((attacker.Dir+3)%6==target.Dir||(attacker.Dir)%6==target.Dir)
			aimmod+=40;
			if(attacker.StatBase[(0)]>=6)
			aimmod+=6+attacker.StatBase[(0)]*2;
			if(target.IsRuning)
			aimmod+=20;
			if(target.IsRuning&&target.Stat[(72)]<Random(aimmod,totalDmg*4+aimmod*2)&&dist>=3)
			{
				target.Say((5),"    ");
				target.ToKnockout((((Random(0,1)==1?true:false))?(82):(83)),(((Random(0,1)==1?true:false))?(86):(87)),(((Random(0,1)==1?true:false))?(88):(89)),Random(18,25),target.HexX,target.HexY);
				target.TimeoutBase[(248)]=__FullSecond+((2)*__TimeMultiplier*60)+((5)*__TimeMultiplier);
			}
			else if(target.Stat[(72)]<Random(aimmod,totalDmg*2+aimmod)&&dist>=3)
			{
				target.Say((5),"    ");
				target.ToKnockout((((Random(0,1)==1?true:false))?(82):(83)),(((Random(0,1)==1?true:false))?(86):(87)),(((Random(0,1)==1?true:false))?(88):(89)),Random(18,25),target.HexX,target.HexY);
				target.TimeoutBase[(248)]=__FullSecond+((2)*__TimeMultiplier*60)+((5)*__TimeMultiplier);
			}
			else if(target.Stat[(72)]<Random(aimmod,totalDmg*2+aimmod)&&dist<=2)
			{
				target.Say((5),"   ");
				target.ToKnockout((((Random(0,1)==1?true:false))?(82):(83)),(((Random(0,1)==1?true:false))?(86):(87)),(((Random(0,1)==1?true:false))?(88):(89)),Random(11,18),target.HexX,target.HexY);
				target.TimeoutBase[(248)]=__FullSecond+((2)*__TimeMultiplier*60)+((15)*__TimeMultiplier);
			}
		}
	}
	if(attack.WeaponPid==(3985)&&target.ParamBase[(531)]<=0)
	{
		if((!target.IsDead()||!target.IsKnockout())&&target.Timeout[(248)]<=((5)*__TimeMultiplier))
		{
			uint8 dist=GetDistantion(attack.Hx,attack.Hy,target.HexX,target.HexY);
			uint8 aimmod=0;
			if(aim==(1)||aim==(7))
			aimmod=50;
			if(target.Stat[(72)]>Random(0,0))
			{
				attacker.Say((4),"");
			}
		}
	}
	if(attack.WeaponPid==(3986)&&target.ParamBase[(531)]<=0)
	{
		if((!target.IsDead()||!target.IsKnockout())&&target.Timeout[(248)]<=((5)*__TimeMultiplier))
		{
			uint8 dist=GetDistantion(attack.Hx,attack.Hy,target.HexX,target.HexY);
			uint8 aimmod=0;
			if(aim==(1)||aim==(7))
			aimmod=80;
			if(target.Stat[(72)]>Random(0,0))
			{
				attacker.Say((4),"");
			}
		}
	}
	if((aim==(5)||aim==(6))&&(!target.IsDead()||!target.IsKnockout())&&target.Timeout[(248)]<=((2)*__TimeMultiplier*60))
	{
		uint8 hitmod=0;
		if(attack.WeaponSubtype==(3))
		hitmod=20;
		if(target.IsRuning&&((attacker.Dir+3)%6==target.Dir||(attacker.Dir)%6==target.Dir))
		hitmod+=40;
		if(target.IsRuning&&target.Stat[(72)]<Random(hitmod,50+totalDmg*8+hitmod*2))
		{
			target.ToKnockout((((Random(0,1)==1?true:false))?(82):(83)),(((Random(0,1)==1?true:false))?(86):(87)),(((Random(0,1)==1?true:false))?(88):(89)),Random(5,10),target.HexX,target.HexY);
			target.TimeoutBase[(248)]=__FullSecond+((2)*__TimeMultiplier*60)+((10)*__TimeMultiplier);
		}
		else if(target.Stat[(72)]<Random(hitmod,50+totalDmg*2+hitmod))
		{
			target.ToKnockout((((Random(0,1)==1?true:false))?(82):(83)),(((Random(0,1)==1?true:false))?(86):(87)),(((Random(0,1)==1?true:false))?(88):(89)),Random(2,6),target.HexX,target.HexY);
			target.TimeoutBase[(248)]=__FullSecond+((2)*__TimeMultiplier*60)+((10)*__TimeMultiplier);
		}
	}
	if(attack.WeaponPid==(27))
	{
		if(!target.IsDead()||!target.IsKnockout())
		{
			target.ToKnockout((((Random(0,1)==1?true:false))?(82):(83)),(((Random(0,1)==1?true:false))?(86):(87)),(((Random(0,1)==1?true:false))?(88):(89)),30,target.HexX,target.HexY);
		}
	}
} 

void CommenceExplosion(AttackStruct&attack,Map@map,uint16 tx,uint16 ty,Critter@target,uint weapPid,bool isCritical,uint intentionallyId,bool isRocket,CombatRes[]&results)
{
	uint radius=isRocket?3:((weapPid==(660))?7:2);
	
	if(weapPid!=(660))
	
	{
		if(weapPid==(159))
		map.RunEffect((4027),tx,ty,2);
		else if(weapPid==(25)||weapPid==(421))
		map.RunEffect((4028),tx,ty,2);
		else if(weapPid==(27))
		map.RunEffect((4008),tx,ty,2);
		else if(weapPid==(26))
		map.RunEffect((4029),tx,ty,2);
		else if(isRocket)
		map.RunEffect((4011),tx,ty,1);
		else
		map.RunEffect((4027),tx,ty,2);
		
		QuakeScreen(map);
		
	}
	Critter@[]critsHit;
	map.GetCrittersHex(tx,ty,radius,(0x03),critsHit);
	bool validTarget=(@target!=null);
	uint targetId=0;
	bool intentionally=((@attack.Attacker!=null)&&!attack.Attacker.IsNpc()||targetId==intentionallyId);
	
	if(validTarget)
	{
		targetId=target.Id;
		ApplyDamage(attack,target,1,isCritical,intentionally,results);
	}
	
	attack.Hx=tx;
	attack.Hy=ty;
	
	for(int i=0,j=critsHit.length();i<j;i++)
	{
		
		if(weapPid==(660))
		{
			uint8 DirToCrit=GetDirection(tx,ty,critsHit[i].HexX,critsHit[i].HexY);
			uint8 FlashDir,Near1,Near2;
			FlashDir=DirToCrit+3;if(FlashDir>5)
			FlashDir=FlashDir-6;;
			Near1=FlashDir+1;Near2=FlashDir-1;if(Near1>5)
			Near1=0;if(Near2<0)
			Near2=5;;
			if((critsHit[i].Dir!=FlashDir)&&(critsHit[i].Dir!=Near1)&&(critsHit[i].Dir!=Near2))
			continue;
		}
		
		if(!validTarget||targetId!=critsHit[i].Id)
		ApplyDamage(attack,critsHit[i],1,false,intentionally,results);
	}
} 

void CriticalFailure(Critter&cr,ProtoItem&weapon,uint8 weaponUse,ProtoItem@ammo,uint eff,CombatRes[]&results)
{                
	
	int totalDmg=0;
	bool tookDamage=false;
	Item@realWeapon=cr.GetItem(0,(1));
	bool wpnIsRemoved=((weaponUse)==0?weapon.Weapon_Remove_0:((weaponUse)==1?weapon.Weapon_Remove_1:((weaponUse)==2?weapon.Weapon_Remove_2:false)));
	Map@map=cr.GetMap();
	
	if(cr.Mode[(523)]!=0)
	(eff=((eff)&(~((0x00004000)))));
	
	if((((eff)&((0x00010000)))!=0)||(((eff)&((0x00001000)))!=0))
	{
		bool validAmmo=(@ammo!=null);
		int dmgType=((weaponUse)==0?weapon.Weapon_DmgType_0:((weaponUse)==1?weapon.Weapon_DmgType_1:((weaponUse)==2?weapon.Weapon_DmgType_2:0)));
		int targetDR=cr.Stat[(23)+dmgType-1];
		int targetDT=cr.Stat[(16)+dmgType-1];
		
		if(weapon.Weapon_Perk==(3))
		targetDT/=5;
		
		targetDR+=(cr.Trait[(554)]!=0?30:0);
		targetDR+=validAmmo?ammo.Ammo_DRMod:0;
		targetDR=(((targetDR)>(100))?(100):(((targetDR)<(0))?(0):(targetDR)));
		int dmgMin=((weaponUse)==0?weapon.Weapon_DmgMin_0:((weaponUse)==1?weapon.Weapon_DmgMin_1:((weaponUse)==2?weapon.Weapon_DmgMin_2:0)));
		int dmgMax=((weaponUse)==0?weapon.Weapon_DmgMax_0:((weaponUse)==1?weapon.Weapon_DmgMax_1:((weaponUse)==2?weapon.Weapon_DmgMax_2:0)));
		int dmgMul=validAmmo?ammo.Ammo_DmgMult:1;
		int dmgDiv=validAmmo?ammo.Ammo_DmgDiv:1;
		totalDmg=Random(dmgMin,dmgMax)+2*cr.Perk[(305)];
		totalDmg*=dmgMul;
		totalDmg/=dmgDiv;
		totalDmg-=targetDT;
		totalDmg-=(totalDmg*targetDR)/100;
		if(totalDmg<0)
		totalDmg=0;
		int bt=cr.Stat[(67)];
		if(cr.Perk[(398)]!=0&&!(bt==(16)||bt==(10)))
		totalDmg+=8;
		if(cr.Perk[(402)]!=0&&dmgType==(3))
		totalDmg+=5;
		tookDamage=true;
	}
	
	uint16 ammoRound=((weaponUse)==0?weapon.Weapon_Round_0:((weaponUse)==1?weapon.Weapon_Round_1:((weaponUse)==2?weapon.Weapon_Round_2:0)));
	if(ammoRound>0&&(@realWeapon!=null)&&cr.Mode[(522)]==0)
	{
		if(realWeapon.AmmoCount<=ammoRound||(((eff)&((0x00020000)))!=0))
		realWeapon.AmmoCount=0;
		else
		realWeapon.AmmoCount-=ammoRound;
		realWeapon.Update();
	}
	
	if(cr.Mode[(523)]!=0)
	(eff=((eff)&(~((0x00004000)))));
	
	if((((eff)&((0x00004000)))!=0)&&(@realWeapon!=null))
	{
		if(weapon.ProtoId==(650))
		e_ConvertBallToCrit(realWeapon,cr);
		else
		{
			if(realWeapon.IsStackable())
			{
				Item@dropped=map.AddItem(cr.HexX,cr.HexY,weapon.ProtoId,1);
				if(realWeapon.GetCount()>1)
				realWeapon.SetCount(realWeapon.GetCount()-1);
				else
				DeleteItem(realWeapon);
				
				if(!cr.IsPlayer())
				{
					NpcPlane@plane=CreatePlane();
					NpcPlane@[]crPlanes(0);
					
					if(cr.GetPlanes(crPlanes)>0)
					plane.Priority=crPlanes[0].Priority+1;
					else
					plane.Priority=70;
					
					plane.Type=(3);
					plane.Pick_HexX=dropped.HexX;
					plane.Pick_HexY=dropped.HexY;
					plane.Pick_Pid=dropped.GetProtoId();
					plane.Pick_UseItemId=0;
					plane.Pick_ToOpen=false;
					plane.Run=true;
					cr.AddPlane(plane);
				}
			}
			else
			{
				MoveItem(realWeapon,0,map,cr.HexX,cr.HexY);
				if(!cr.IsPlayer())
				{
					NpcPlane@plane=CreatePlane();
					
					NpcPlane@[]crPlanes(0);
					
					if(cr.GetPlanes(crPlanes)>0)
					plane.Priority=crPlanes[0].Priority+1;
					else
					plane.Priority=70;
					
					plane.Type=(3);
					plane.Pick_HexX=realWeapon.HexX;
					plane.Pick_HexY=realWeapon.HexY;
					plane.Pick_Pid=realWeapon.GetProtoId();
					plane.Pick_UseItemId=0;
					plane.Pick_ToOpen=false;
					plane.Run=true;
					cr.AddPlane(plane);
				}
			}
		}
		
	}
	
	if(((((eff)&((0x00002000)))!=0)||(((eff)&((0x00001000)))!=0))&&(@realWeapon!=null))
	{
		if(realWeapon.IsStackable())
		{
			if(realWeapon.GetCount()>1)
			realWeapon.SetCount(realWeapon.GetCount()-1);
			else
			DeleteItem(realWeapon);
		}
		else
		DeleteItem(realWeapon);
	}
	
	if((((eff)&((0x00080000)))!=0))
	{
		totalDmg+=Random(1,5);
		tookDamage=true;
	}
	
	if((((eff)&((0x00008000)))!=0))
	{
		cr.StatBase[(75)]=-100*cr.Stat[(8)];
		cr.StatBase[(88)]=0;
	}
	
	if((((eff)&((0x00000002)))!=0)&&!cr.IsKnockout())
	cr.ToKnockout(((true)?(82):(83)),((true)?(86):(87)),((true)?(88):(89)),cr.Perk[(403)]!=0?1:3,cr.HexX,cr.HexY);
	
	if((((eff)&((0x00200000)))!=0)&&cr.Mode[(524)]==0)
	{
		switch(Random(1,4))
		{
			case 1:
			cr.DamageBase[(506)]=1;
			break;
			case 2:
			cr.DamageBase[(505)]=1;
			break;
			case 3:
			cr.DamageBase[(504)]=1;
			break;
			case 4:
			cr.DamageBase[(503)]=1;
			break;
			default:
			break;
		}
	} 
	
	if((((eff)&((0x00001000)))!=0))
	map.RunEffect((4028),cr.HexX,cr.HexY,2);
	
	if(totalDmg>0)
	cr.StatBase[(72)]-=totalDmg;
	
	uint[]allEff={(2),cr.Id,eff}; 
	
	if(tookDamage)
	{
		allEff.resize(4);
		allEff[3]=totalDmg;
		allEff[0]=(3);
	}
	
	if(cr.Stat[(72)]<1)
	{
		if(cr.Stat[(72)]>__DeadHitPoints&&cr.Mode[(531)]==0)
		{
			if(!cr.IsKnockout())
			cr.ToKnockout(((true)?(82):(83)),((true)?(86):(87)),((true)?(88):(89)),0,cr.HexX,cr.HexY);
		}
		else
		{
			uint anim2Dead=(102);
			if(cr.IsKnockout())
			{
				if(cr.Anim2Knockout==(86))
				anim2Dead=(100);
				else
				anim2Dead=(101);
			}
			cr.ToDead(anim2Dead,null);
			allEff[2]|=(0x10000000);
		}
	}
	
	Critter@[]him={cr};
	Critter@[]crits;
	cr.GetMap().GetCrittersSeeing(him,true,(0x0F)|(0x10),crits);
	for(int i=0,j=crits.length();i<j;i++)
	AddEff(crits[i],allEff,results);
	
	runTree(results,0);
	
	return;
} 

void InjureCritter(Critter&cr,uint dmg,uint dmgType,uint8 dir,uint attackerId)
{
	if(dmgType>(7))
	{
		Log("Invalid damage type.");
		return;
	}
	
	Critter@attacker=null;
	if(attackerId!=0&&cr.Id!=attackerId)
	@attacker=GetCritter(attackerId);
	
	AttackStruct attack;
	@attack.Attacker=attacker;
	
	uint16 hx=cr.HexX;
	uint16 hy=cr.HexY;
	Map@map=cr.GetMap();
	if((@map!=null))
	map.MoveHexByDir(hx,hy,(dir+3)%6,1);
	
	attack.Hx=hx;
	attack.Hy=hy;
	attack.Aim=(9);
	attack.IsBurst=false;
	attack.BloodyMess=false;
	attack.CombatMessage=false;
	attack.WeaponPerk=-1;
	attack.WeaponSubtype=0;
	attack.DmgMin=dmg;
	attack.DmgMax=dmg;
	attack.DmgType=dmgType;
	attack.BonusDmg=0;
	attack.DmgMul=2;
	attack.DRMod=0;
	attack.DMMod=1;
	attack.DDMod=1;
	attack.TargetId=cr.Id;
	attack.ShowHitAnimForce=true;
	
	CombatRes[]results;
	ApplyDamage(attack,cr,1,false,true,results);
	
	runTree(results,0);
}

void InjureCritter(Critter&cr,uint dmg,uint dmgType,uint8 dir,uint attackerId,uint forceFlags)
{
	if(dmgType>(7))
	{
		Log("Invalid damage type.");
		return;
	}
	
	Critter@attacker=null;
	if(attackerId!=0&&cr.Id!=attackerId)
	@attacker=GetCritter(attackerId);
	
	AttackStruct attack;
	@attack.Attacker=attacker;
	
	uint16 hx=cr.HexX;
	uint16 hy=cr.HexY;
	Map@map=cr.GetMap();
	if((@map!=null))
	map.MoveHexByDir(hx,hy,(dir+3)%6,1);
	
	attack.Hx=hx;
	attack.Hy=hy;
	attack.Aim=(9);
	attack.IsBurst=false;
	attack.BloodyMess=false;
	attack.CombatMessage=false;
	attack.WeaponPerk=-1;
	attack.WeaponSubtype=0;
	attack.DmgMin=dmg;
	attack.DmgMax=dmg;
	attack.DmgType=dmgType;
	attack.BonusDmg=0;
	attack.DmgMul=2;
	attack.DRMod=0;
	attack.DMMod=1;
	attack.DDMod=1;
	attack.TargetId=cr.Id;
	attack.ForceFlags=forceFlags;
	attack.ShowHitAnimForce=true;
	
	CombatRes[]results;
	ApplyDamage(attack,cr,1,false,true,results);
	
	runTree(results,0);
}

int FindCritterInArray(Critter@[]&crits,Critter&cr)
{
	uint crId=cr.Id;
	for(uint i=0,j=crits.length();i<j;i++)
	if(crits[i].Id==crId)
	return i;
	return-1;
}

uint GetAimApCost(int hitLocation)
{
	switch(hitLocation)
	{
		case(0):
		break;
		case(9):
		break;
		case(4):
		return __ApCostAimTorso;
		case(7):
		return __ApCostAimEyes;
		case(1):
		return __ApCostAimHead;
		case(2):
		case(3):
		return __ApCostAimArms;
		case(8):
		return __ApCostAimGroin;
		case(5):
		case(6):
		return __ApCostAimLegs;
		default:
		break;
	}
	return 0;
}

uint GetHitAim(int hitLocation)
{
	switch(hitLocation)
	{
		case(0):
		break;
		case(9):
		break;
		case(4):
		return __HitAimTorso;
		case(7):
		return __HitAimEyes;
		case(1):
		return __HitAimHead;
		case(2):
		case(3):
		return __HitAimArms;
		case(8):
		return __HitAimGroin;
		case(5):
		case(6):
		return __HitAimLegs;
		default:
		break;
	}
	return 0;
}  

int RawToHit(Critter&cr,Critter&target,ProtoItem@weapon,uint8 weaponUse,ProtoItem@ammo)
{
	int skillNum=(@weapon!=null)?((weaponUse)==0?weapon.Weapon_Skill_0:((weaponUse)==1?weapon.Weapon_Skill_1:((weaponUse)==2?weapon.Weapon_Skill_2:0))):(203);
	int toHit=cr.Skill[skillNum];
	int weaponPerk=(@weapon!=null)?weapon.Weapon_Perk:0;
	int blockers=0;
	int dist=GetDistantion(cr.HexX,cr.HexY,target.HexX,target.HexY);
	if(skillNum!=(203)&&skillNum!=(204))
	{
		
		int distmod1=2;
		int distmod2=0;
		if(weaponPerk==(1))
		distmod1=4;
		else if(weaponPerk==(5))
		{
			distmod1=5;
			distmod2=8;
		}
		
		int perception=cr.Stat[(1)];
		int acc=dist;
		
		if(dist<distmod2)
		acc+=distmod2;
		else
		{
			if(cr.IsPlayer())
			acc-=(perception-2)*distmod1;
			else
			acc-=perception*distmod1;
		}
		
		if(-2*perception>acc)
		acc=-2*perception;
		
		acc-=2*cr.Perk[(315)];
		
		if(acc>=0)
		{
			if(cr.Damage[(502)]!=0)
			acc*=-12;
			else
			acc*=-4;
		}
		else
		acc*=-4;
		
		toHit+=acc;
		
		Map@map=cr.GetMap();
		blockers=map.GetCrittersPath(cr.HexX,cr.HexY,target.HexX,target.HexY,0.0f,dist,(0x01),null);
		if(!target.IsKnockout())
		blockers--;
		toHit-=10*blockers;
	}
	
	if((@weapon!=null))
	{
		if(!(weapon.Weapon_IsUnarmed)&&cr.Trait[(553)]!=0)
		toHit+=((((weapon.Flags)&((0x00000080)))!=0)?-40:20);
		
		int handlingStrength=cr.Stat[(0)];
		int reqStrength=weapon.Weapon_MinStrength;
		if(cr.Perk[(407)]!=0)
		handlingStrength+=3;
		if(handlingStrength<reqStrength)
		toHit-=(reqStrength-handlingStrength)*20;
		
		if(weaponPerk==(2))
		toHit+=20;
	}
	
	int acmod=target.Stat[(9)];
	if((@ammo!=null))
	acmod+=ammo.Ammo_ACMod;
	if(acmod>0)
	toHit-=acmod;
	
	if(cr.Damage[(502)]!=0)
	toHit-=25;
	
	if(target.IsKnockout())
	toHit+=40;
	if(target.GetMultihex()>0)
	toHit+=15;
	
	return toHit;
} 

void NotifyOops(Critter&cr,Critter@t1,Critter@t2,CombatRes[]&results)
{ 
	
	if(@t2==null)
	{
		uint[]allEff={(13),cr.Id};
		Critter@[]him={cr};
		Critter@[]crits;
		cr.GetMap().GetCrittersSeeing(him,true,(0x0F)|(0x10),crits);
		for(int i=0,j=crits.length();i<j;i++)
		AddEff(crits[i],allEff,results);
	}
	else if(@t1!=null)
	{
		uint[]allEff={(12),t1.Id,t2.Id};
		Critter@[]them={t1,t2};
		Critter@[]crits;
		t1.GetMap().GetCrittersSeeing(them,true,(0x0F)|(0x10),crits);
		for(int i=0,j=crits.length();i<j;i++)
		AddEff(crits[i],allEff,results);
	}  
	
	return;
}

void NotifyMiss(Critter@cr,CombatRes[]&results)
{
	
	uint[]allEff={(1),cr.Id};
	Critter@[]him={cr};
	Critter@[]crits;
	cr.GetMap().GetCrittersSeeing(him,true,(0x0F)|(0x10),crits);
	for(int i=0,j=crits.length();i<j;i++)
	AddEff(crits[i],allEff,results);
	
	return;
}

Critter@ChooseRandomTarget(Map&map,Critter&cr,Critter&target,uint wpnMaxDist)
{
	Critter@[]crits;
	uint16 hx=cr.HexX;
	uint16 hy=cr.HexY;
	uint n=map.GetCrittersHex(hx,hy,wpnMaxDist,(0x03),crits);
	if(n==0)
	return null;
	uint start=Random(0,n-1);
	uint16 bx=0;
	uint16 by=0;
	uint16 pbx=0;
	uint16 pby=0;
	for(uint i=start;i<n;i++)
	{
		if(!(@crits[i]!=null))
		continue;
		if(crits[i].Id==cr.Id||((@target!=null)&&crits[i].Id==target.Id))
		continue;
		
		map.GetCrittersPath(hx,hy,crits[i].HexX,crits[i].HexY,0.0f,0,(0x03),null,pbx,pby,bx,by);
		if(bx==crits[i].HexX&&by==crits[i].HexY)
		return crits[i];
	}
	for(uint i=0;i<start;i++)
	{
		if(!(@crits[i]!=null))
		continue;
		if(crits[i].Id==cr.Id||((@target!=null)&&crits[i].Id==target.Id))
		continue;
		
		map.GetCrittersPath(hx,hy,crits[i].HexX,crits[i].HexY,0.0f,0,(0x03),null,pbx,pby,bx,by);
		if(bx==crits[i].HexX&&by==crits[i].HexY)
		return crits[i];
	}
	
	return null;
}

void answer_COUP_DE_GRACE(Critter&player,uint answerI,string&answerS)
{
	Critter@targetCr=GetCritter(player.Stat[(90)]);
	if(targetCr is null)
	return;
	
	if(answerI==0&&!targetCr.IsDead()&&player.ParamBase[(95)]==3)
	{
		if(player.Param[(703)]==(2))targetCr.ToDead((102),player);
		else targetCr.ToDead((110),player);
		targetCr.StatBase[(188)]=player.Id;
		if(targetCr.IsPlayer())Log_Killings(player,targetCr.Id,0,0,null,null);
		player.Say((11),"     ");
	}
}

void telekineticExplosion(Critter&cr){
	AttackStruct telekineticDynamite;
	Map@explosionMap=cr.GetMap();
	CombatRes[]results;
	Critter@[]crits;
	Critter@[]psyonic={cr};
	@telekineticDynamite.Attacker=cr;
	telekineticDynamite.DmgMin=cr.Stat[(4)]*7;
	telekineticDynamite.DmgMax=cr.Stat[(4)]*11;
	telekineticDynamite.DmgType=(7);
	telekineticDynamite.DmgMul=1;
	cr.ModeBase[(527)]=1;
	cr.ModeBase[(531)]=1;
	CommenceExplosion(telekineticDynamite,explosionMap,cr.HexX,cr.HexY,null,(27),false,0,false,results);
	cr.ModeBase[(527)]=0;
	cr.ModeBase[(531)]=0;
	runTree(results,0);
}
